‎1D array

‎blockIndex

‎(uint32)

‎ ell count in each partition block. cnt=
C
‎blockIndex[i+1]-blockIndex[i]

Dataset

‎1D array

‎blockSize

‎4*(uint32)

‎ -element array. The 4 items represent the
4
‎block length in x-axis, block length in y-axis,
‎block count in x-axis, and block count in y‎axis, respectively.

Dataset

‎attribute

‎cell
Dataset

‎averageArea

‎Average area for cells in pixel

‎averageDnbCount

‎ verage number of mRNA-captured DNBs in
A
‎a cell

‎averageExpCount

‎Average MID count in cell

‎averageGeneCount

‎Average gene count in cell

‎maxArea

‎Maximum area for cells in pixel

‎maxDnbCount

‎ aximum number of mRNA-captured DNBs
M
‎in a cell

‎maxExpCount

‎Maximum MID count in cell

‎maxGeneCount

‎Maximum gene count in cell

‎maxX

‎ aximum x coordinate of the cell's center of
M
‎mass

‎maxY

‎ aximum y coordinate of the cell's center of
M
‎mass

‎medianArea

‎Median area for cells in pixel

‎medianDnbCount

‎ edian number of mRNA-captured DNBs in a
M
‎cell

‎medianExpCount

‎Median MID count in cell

‎medianGeneCount

‎Median gene count in cell

‎minArea

‎Minimum area for cells in pixel

‎minDnbCount

‎ inimum number of mRNA-captured DNBs in
M
‎a cell

‎minExpCount

‎Minimum MID count in cell

‎minGeneCount

‎Minimum gene count in cell

‎minX

‎ inimum x coordinate of the cell's center of
M
‎mass

‎minY

‎ inimum y coordinate of the cell's center of
M
‎mass

‎compound
‎id

‎Cell ID index, the start ID is 0

‎x

‎The x coordinate of the cell's center of mass

‎y

‎The y coordinate of the cell's center of mass

‎offset

‎ he start row index of the cell in the “/cellBin/
T
‎cellExp” dataset

‎geneCount

‎Gene count in the cell

‎expCount

‎Cell MID count

‎dnbCount

‎mRNA-captured DNBs of the cell

‎area

‎Cell area in pixel

‎cellTypeID

‎Cell type ID

‎clusterID

‎Cell cluster ID

‎attribute

‎cellBorder
Dataset

‎maxX

‎ aximum x coordinate of the bounding box
M
‎of the cell

‎maxY

‎ aximum y coordinate of the bounding box
M
‎of the cell

‎minX

‎ inimum x coordinate of the bounding box
M
‎of the cell

‎minY

‎ inimum y coordinate of the bounding box
M
‎of the cell

‎3D array (cell*32*2)

‎32*(int16,int16)

‎ list of 32 coordinates recording the
A
‎differences between cell bounding points and
‎the cell's center of mass (0,0). The real
‎coordinate of cell's center of mass (x, y) can
‎be obtained from “cell” dataset using cellID

‎attribute

‎cellBin
Group

‎cellExon
Dataset

‎maxExon

‎Maximum exon count of a gene in all cells

‎minExon

‎Minimum exon count of a gene in all cells

‎1D array
Optional

‎(uint16)

‎ xon count in a cell, the index of the array is
E
‎same to the cellID in the “cell” dataset

‎attribute
‎maxCount

‎Maximum MID count of a gene in a cell

‎compound
‎cellExp
Dataset

‎geneID

‎ ene IDs of the genes detected in the cell. ID
G
‎is the index of “gene” dataset

‎count

‎MID count for the gene

‎attribute
‎maxExon
‎cellExpExon
Dataset

‎Maximum exon count of a gene in a cell

‎1D array

Optional

‎(uint16)

‎ xon count (MID) for the gene. The index is
E
‎same to the “cellExp” dataset

‎1D array

‎cellTypeList

‎(S32)

‎ ell type, “default” stands for undefined cell
C
‎type

Dataset

‎attribute

‎maxCellCount

‎ aximum number of cells a gene can be
M
‎detected

‎maxExpCount

‎Maximum MID count of a gene

‎minCellCount

‎ inimum number of cells a gene can be
M
‎detected

‎minExpCount

‎Minimum MID count of a gene

‎compound

‎gene
Dataset

‎geneName

‎Gene name

‎offset

‎ he start row index of the gene in “/cellBin/
T
‎geneExp” dataset

‎cellcount

‎Number of cells a gene can be detected

‎expCount

‎Sum of MID count for the gene

‎maxMIDcount

‎Maximum MID count of a gene in a cell

‎attribute

‎geneExon

‎GEF (Cell Bin)

Dataset

‎maxExon

‎Maximum exon count of a gene

‎minExon

‎Minimum exon count of a gene

‎1D array

Optional

‎(uint32)

‎ otal exon count of a gene, the index of
T
‎“geneExon” dataset is same to the “gene”
‎dataset

‎attribute
‎maxCount

‎Maximum MID count of a gene

‎compound
‎geneExp
Dataset

‎cellID

‎ ellID that contains the gene whose index is
c
‎same to the index in “gene” dataset

‎count

‎ he MID count of the gene, whose index is
T
‎same to the index in “gene” dataset, in the
‎cellID

‎attribute
‎maxExon

‎geneExpExon
Dataset

‎Maximum exon expression of a gene in a cell

‎1D array

Optional

‎(uint16)

‎ xon count of a gene in a cell. The index of
E
‎“geneExpExon” dataset is same to the
‎“geneExp” dataset

‎attribute

‎info

‎ etadata of encoded precomputed data in
M
‎JSON

‎Bytes dataset
‎codedCellBlock
Group

Optional

‎0_0

‎Bytecode of the chunk

Dataset

‎...
‎n_m
Dataset

‎attribute

‎geftool_ver

‎geftool version

‎offsetX

‎Minimum x coordinate in bin 1

‎offsetY

‎Minimum y coordinate in bin 1

‎omics

‎Omics name

‎resolution

‎Physical pitch (nm) between neighbor spots

‎version

‎GEF format

‎bin_type

‎Bin type

‎Bytecode of the chunk

‎share index

‎attribute

‎expression
Dataset

‎minX

‎Minimum x coordinate in bin 1

‎minY

‎Minimum y coordinate in bin 1

‎maxX

‎Maximum x coordinate in bin 1

‎maxY

‎Maximum y coordinate in bin 1

‎maxExp

‎ aximum MID count in a spot when the bin
M
‎size is 1. Data type for “maxExp” is
‎dynamically changed for each sample

‎resolution

‎Physical pitch (nm) between neighbor spots

‎compound
‎x

‎x coordinate in bin 1

‎y

‎y coordinate in bin 1

‎count

‎ ID count at (x, y) when bin size is 1. Data
M
‎type for “count” is consistent with “maxExp”
‎in the “Attributes.”

‎attribute

‎bin1

‎maxExon

Group

‎Max exon expression in bin 1
‎share same index

‎1D array

‎exon
Dataset

‎count

‎ xon expression in bin1 at coordinate (x,y).
E
‎Data type for “count” is dynamically changed
‎for each sample.

‎compound

‎gene
Dataset

‎geneExp
‎bin10

Group

Group

‎Row count

31

Optional

31

Optional

31

Optional

‎bin500
Group

‎count

31

‎bin200
Group

‎ he starting row index in dataset “expression”
T
‎for the gene

Optional

‎bin100
Group

‎offset

31

‎bin50
Group

‎Gene name

Optional

‎bin20
Group

‎gene

31

Optional

‎attribute

‎stat
Group

‎gene
Optional

‎maxE10

‎Maximum E10 score

‎minE10

‎Minimum E10 score

‎cutoff

‎ hreshold for filtering spots that will be used
T
‎for computing E10

‎compound

Dataset

‎gene

‎Gene name

‎MIDcount

‎MID count for the gene

‎E10

‎ he spatial pattern enrichment score (E10) for
T
‎the gene

‎attribute

‎bin1
Group

‎GEF (Square Bin)

‎wholeExp
Group

Optional

‎bin10

‎number

‎Number of non-zero spots in the dense matrix

‎minX

‎Minimum x coordinate in bin 1

‎lenX

‎Length of x

‎minY

‎Minimum y coordinate in bin 1

‎lenY

‎Length of y

‎maxMID

‎Maximum MID count in a spot

‎maxGene

‎Maximum gene type count in a spot

‎resolution

‎Pitch (nm) between neighbor spots

‎compound 2D array (XxY)

‎MIDcount

‎ ID count in the spot. The spot coordinate
M
‎can be identified from the row and column
‎index of the 2D matrix plus the “minX” and
‎“minY” specified in the attributes. Data type
‎for “MIDcount” is dynamically changed for
‎each sample.

‎genecount

‎ ene count in the spot. The spot coordinate
G
‎can be identified from “Attributes” and the
‎indexes of the 2D array.

20

Group

‎bin20

20

Group

‎bin50

20

Group

‎bin100

20

Group

‎bin200

20

Group

‎bin500

20

Group

‎attribute

‎maxExon

‎ aximum exon expression count in a spot
M
‎when the bin size is 1

‎2D array (XxY)
‎bin1
Group

‎MIDCount
‎bin10

4

Group

‎wholeExpExon
Group

Optional

‎bin20

4

Group

‎bin50

4

Group

‎bin100

4

Group

‎bin200

4

Group

‎bin500
Group

‎attribute

‎geftool_ver

‎geftool version

‎omics

‎Omics name

‎version

‎GEF format

‎gef_area

‎Tissue area

‎bin_type

‎Bin type

4

‎ ID count in the spot. The spot coordinate
M
‎can be identified from the row and column
‎index of the 2D matrix plus the “minX” and
‎“minY” specified in the attributes. Data type
‎for “MIDcount” is dynamically changed for
‎each sample.

‎offset is the row index of "expression" dataset

Stereo-seq
ANALYSIS WORKFLOW
FILE FORMAT
MANUAL

Software Version: V7.0
Manual Version: A4.1

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

REVISION HISTORY
Manual Version:
Software Version:
Date:
Description:

A0
V4.1.0
Apr. 2022
Initial release

Manual Version:
Software Version:
Date:
Description:

A3.1
V6.1
May. 2023
Modification of fields in IPR and
RPI; addition of FASTQ format
description.

Manual Version:
Software Version:
Date:
Description:

A0.1
V4.1.0
Jun. 2022
Revised the data type of some
data elements in the GEF file.

Manual Version:
Software Version:
Date:
Description:

A4.1
V7.0
Oct. 2023
Updated file version of IPR
(v0.2.0); modification of fields
in RPI.

Manual Version:
Software Version:
Date:
Description:

A1
V5.1.3
Sep. 2022
Added cell bin GEF file demo
and format specification; added
IPR file format specification.

Manual Version:
Software Version:
Date:
Description:

A1.1
V5.1.3
Dec. 2022
Fixed some typos in GEF and
IPR file format.

Manual Version:
Software Version:
Date:
Description:

A2
V5.5.3 - V5.5.4
Jan. 2023
Updated visit links for
schematic diagram of GEF and
IPR.

Manual Version:
Software Version:
Date:
Description:

A3
V6.0
Mar. 2023
Updated file versions of IPR
(v0.1.0) and RPI (v0.0.2)

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

Note: Please download the latest version of the
manual and use it with the software specific for
this manual.
©2023 Beijing Genomics Institute (Shenzhen).
All rights reserved.
1. The products shall be for research use only, not
for use in diagnostic procedures.
2. The Content on this manual may be protected
in whole or in part by applicable intellectual
property laws. Beijing Genomics Institute and / or
corresponding right subjects own their intellectual
property rights according to law, including but not
limited to trademark rights, copyrights, etc.
3. Beijing Genomics Institute does not grant or
imply the right or license to use any copyrighted
content or trademark (registered or unregistered) of
us or any third party. Without our written consent,
no one shall use, modify, copy, publicly disseminate,
change, distribute, or publish the program or
Content of this manual without authorization, and
shall not use the design or use the design skills to
use or take possession of the trademarks, the logo
or other proprietary information (including images,
text, web design or form) of us or our affiliates.
4. Nothing contained herein is intended to or
shall be construed as any warranty, expression or
implication of the performance of any products
listed or described herein. Any and all warranties
applicable to any products listed herein are set
forth in the applicable terms and conditions of sale
accompanying the purchase of such product. Beijing
Genomics Institute (Shenzhen) makes no warranty
and hereby disclaims any and all warranties as to
the use of any third-party products or protocols
described herein.

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

TABLE OF CONTENTS
CHAPTER 1: OVERVIEW
1.1. About Software						
1.2. About Manual 				
			
1.3. Terminologies and Concepts		
		

2
2
2

CHAPTER 2: FILE FORMAT
2.1. FASTQ								4
2.2. BAM								5
2.3. Mapped CID List with Reads Count File			
5
2.4. Gene Expression File						
6
15
2.5. Gene Expression Matrix					
16
2.6. Image Process Record File					
2.7. Image Pyramid							22
REFERENCES

						24

CONTACT US

						25

STOMICS ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

CHAPTER 1
OVERVIEW

2

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

1.1. About Software
Stereo-seq Analysis Workflow1 (SAW) software suite is a set of pipelines that are bundled to position sequenced
reads to their spatial location on the tissue section, and quantify spatial gene expression.
SAW download (Docker Hub): https://hub.docker.com/r/stomics/saw
SAW Github: https://github.com/STOmics/SAW

1.2. About Manual
This manual includes descriptions of key files formats generated from SAW, which help users better
understand and make use of information from analysis results.

1.3. Terminologies and Concepts
Table 1-1 Terminologies and Concepts

Abbreviation

Full Name

Description

SN

Serial Number

Unique ID for Stereo-seq Chip T.

RIN

RNA Integrity
Value

RNA integrity value measures the RNA degradation degree to indicate the
integrity of RNA and evaluate the quality of the RNA sample. RIN values range
from 1 (totally degraded) to 10 (intact). In Stereo-seq analysis, only tissue
sample with a pre-measured RIN value greater than 7 should be used for
further sequencing and bioinformatics analysis.

CID

Coordinate ID

Spatial position identifier, the artificially synthesized barcode sequence
unique to each spot on the Stereo-seq Chip T.

MID

Molecular ID

Molecular identifier (same as UMI), the artificially synthesized sequence
unique to each mRNA molecule captured from the sample which helps to
differentiate the number of reads contributed by mRNA expression level due
to amplification. Two copies of native transcripts from the same molecule
captured on one DNB will result in two independent reads with the same
CID but different MID. In contrast, two reads with identical CID and MID were
originated from the same transcript but got amplified.

DNB

DNA Nanoball

DNA nanoball is the product of rolling-circle amplification (RCA) that is
linearly amplified from the original circular single-stranded DNA template.
DNB is the smallest capture unit on the Stereo-seq Chip T.

Bin

Bin (or Square Bin) is the analysis unit on the gene expression heat map.
A bin is a fixed-sized square in which the expression value in this square is
accumulated. Bins are not overlapped. The value followed by “Bin” represents
the side length of the square. For bin 1, each DNB on the Stereo-seq Chip T is
shown as a spot, which means one spot only contains the data from one DNB.
Bin N means one spot on the heat map is an aggregation of data from N×N
neighbor DNBs. For example, a spot of bin 100 covers data from 10,000 DNBs.

Cell Bin

Similar to Square Bin, a cell bin stands for a region of cell on the expression
map recognized by the algorithm (either from image or heat map). Expression
within a cell bin region is accumulated, and neighbor cell bins are not overlapped.

Bin

Cell Bin

1. OVERVIEW

STOMICS ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

CHAPTER 2
FILE FORMAT

4

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

2.1 FASTQ
FASTQ is a common format for storing sequencing reads and corresponding quality evaluation. The Stereoseq method is PE (paired-end) sequencing. Read 1 contains CID and MID information while read 2 contains
captured mRNA sequencing data. During multi-sample sequencing, an additional sequence (sample barcode)
is added to identify samples. When sequencing data is off, low-quality MID (containing N bases in MID or
having two or more bases with quality value lower than 10) filtration is performed on read 1 and paired read
2. CID and MID are added to readID of read 2 that has been filtered by MID quality, and single strands in read 2,
containing mRNA information, are written into the file in FASTQ format as the original sequencing data, where
sample barcode is removed.
Q40 FASTQ and Q4 FASTQ are two optional output formats for the original sequencing data. Q40 adopts an
evaluation system that describes the quality of sequenced bases with 41 quality values. Q4 means a similar
evaluation system but with 4 quality values. Q40 FASTQ, consists of a pair of read files,
read 1 for CID, MID information and read 2 for captured mRNA sequencing data respectively.
Example of Q40 FASTQ:
# read 1
@E100026571L1C001R00300000000/1
TGTCCAACGGAGACGGCTCCGACAAGGCACTGGCA
+
>DG;<BGH=>*EFE8*G/3E@2:F0-GBGG188F<
# read 2
@E100026571L1C001R00300000000/2
GTCTCACCATACTTTTACAAAGTTATTTCAACCCAAATCACAATTTAAGAATTATTTGTTCTACCTATGCCACACT
TTAAATAAATGTCTATTAAAACCA
+
-GFEECG?ECBFF<=@A@<E@><;FGCF=>=E53FEF5>FGF@,0ADE9CEAG2GBE@
HF3EA<CE;G2F@=G8=?@G9FBGE.EG6G2;974E*D9DE9
Q4 FASTQ is an output format with only one read file, which is split from a data set (containing 16 or 64 parts).
ReadID in the file starts with "@" and contains read name and encoded CID and MID information. The
sequence part contains captured mRNA sequencing data. Because of the combined output format and fewer
kinds of quality values, the file storage space is greatly saved.
Example of Q4 FASTQ:
@FP300000513L1C002R00400000218 CE242DF29A57 97D26
GTGTAGTGAACCCCATGGTAGTTTTCTGATTGTTGTTAAAAAAAATGACTTAACATATTACATGGACACTCAAT
AAAAATGTTTTATTTCCTGTTGAAAA
+
FFFFFFFFFFFF8F8FFFFFFFFFFFFF8FFFFFFFFF8FF8FFF8FFFFFFF,FFFFFFFFFFF8FFFFFF8F
8F,F8FFFFFF,FFFFFFFFFF,FFF

2. FILE FORMAT

5

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

2.2 BAM
The BAM2 file format is a binary format for saving sequence alignment and gene annotation data. SAW mapping
BAM adds custom tags in the BAM optional field to record reads coordinates, CID and MID information. count
BAM adds annotation information in the tag field. Custom tags are described in Table 2-1.
Table 2-1 BAM custom tags

Tag

Description

Cx:i

x coordinate of CID.

Cy:i

y coordinate of CID.

UR:Z

The hexadecimal representation of uncorrected binary-encoded MID.

XF:Z

Mapping region on the reference genome. Valid value: 0=EXONIC, 1=INTRONIC, 2=INTERGENIC.
3=rRNA

GE:Z

Annotated gene name.

GS:Z

‘+’ or ‘-’, indicating forward/reverse strand respectively.

UB:Z

The hexadecimal representation of count corrected binary-encoded MID.

Example of mapping BAM:
E100026571L1C009R00301275185
16
1
3000095 255
26M121066N74M
*
0
0
GGCTTTTTTTTTTTTTTTTTTTTTTTTTTTCTAA
ATATTGGGTTTTATTAGCACCATGATAACTGTATATTAATTTGCACTGACTGTCATAACAAAATAC
G+
:GFFGGFGFFGFFGFGGFFGFFFFFCFGFCFGGGFGGFGFFFFGGFGGFGFFFGGFFGFFFGFGFGFFGFFGF
GFFFFGFFFFFFFFGGFFGGFFGEF
NH:i:1 HI:i:1
AS:i:88 nM:i:0 Cx:i:4826
Cy:i:11598
UR:Z:6FA29
Example of count BAM:
E100026571L1C002R00703943265
1040
1
3082766 255
11M132671N89M
*
0
0
CTGCTGCAGCTTTTTTTTCTTTGAGATTTA
TTTTTATGCTATGTGTATGGGTATTTTGCCTGCATATATGTCTATGCACCATGTGTGTGCAGTGCTTGAG
FFFFFECGFDCFGDGDFEE@EEGIBFGGCGFFGACGFCGFFDGDGFFFFFFEGCDFCGFFGG@FFF=EFFDGGG
GGFDGFFFGGGFGFFGGGFFGGGDFG
NH:i:1 HI:i:1
AS:i:88 nM:i:0 Cx:i:7767
Cy:i:18052
UR:Z:7AE49
XF:i:0 GE:Z:Xkr4
GS:Z:- UB:Z:79E49

2.3 Mapped CID List with Reads Count File
mapping pipeline outputs mapped CID list file with reads counts for each CID. This file stores CID coordinates
and reads count for each coordinate. The list does not have a header. The three columns are x coordinate, y
coordinate and MID count.
Example of mapped CID list with reads count file:
14195

16619

1

19945

14450

2

14548

9438

1

2. FILE FORMAT

6

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

2.4 Gene Expression File
Gene expression file (GEF) is a data management and storage format designed to support multi-dimensional
data storage and high computation efficiency. Stereo-seq analysis workflow generates Square Bin GEF and
Cell Bin GEF files. Square Bin file format is a hierarchically structured data model that stores one or bin combined gene expression matrices in different bin sizes. Cell Bin file format stores expression information within
each cell.
Each GEF container organizes a collection of spatial gene expression matrices. It includes two primary data
objects, Group and Dataset. A dataset is a multidimensional array of data elements. Group object is analogous
to file system directory which organizes datasets and other groups in hierarchies.

2.4.1 Square Bin GEF
The first level of GEF includes four group objects: “geneExp” (required), “wholeExp” (optional),
“wholeExpExon” (optional), and “stat” (optional). Group “geneExp” contains groups of gene spatial
expression data in one or multiple bin size. Group “wholeExp” contains datasets that record expression level
and gene type count of each coordinate in one or multiple bin sizes. Group “wholeExpExon” contains datasets
that record exon level of each coordinate in one or multiple bin sizes. Group “stat” saves gene names, total
MID count and spatial pattern enrichment score of each gene. “Attributes” of the file records the version of
GEF format, software version, and omics information. “Attribute” in each dataset records the key metrics of
that dataset. Check https://github.com/STOmics/SAW/tree/main/Documents/FileFormat to get the schematic diagram of square bin GEF. The field names and field data types of Square Bin GEF are described in
Table 2-2. SAW outputs three GEF files in the whole process. Please check Table 2-3 to find the description.
Table 2-2 Square Bin Gene Expression File Text Fields Description

Attributes
File Attributes

DataType

Example

Description

version

uint32

2

Gene expression file format version.

geftool_ver

uint32[3]

0,7,11

geftool version. It can be used as an individual tool to
manipulate GEF files.

omics

S32

b’Transcriptomics’ Omics name.

gef_area

float32

4.4410855E10

Tissue or labeled tissue area in square nanometers.

bin_type

S32

bin

Bin type of the GEF file.

/geneExp/binN/expression:
Dataset “expression” is a 1D array which stores coordinates and MID counts of each gene in
the bin size of N, aggregated by gene name.
Dataset Attributes DataType

Example (bin1) Description

minX

int32

59820

Minimum x coordinate in bin N.

minY

int32

102086

Minimum y coordinate in bin N.

maxX

int32

73040

Maximum x coordinate in bin N.

maxY

int32

120539

Maximum y coordinate in bin N.

maxExp

uint32

28

Maximum MID count in a spot when the bin size is N. Data
type for “maxExp” is dynamically changed for each sample.

resolution

uint32

500

Physical pitch (nm) between neighbor spots.

Dataset DataType:
DataType
compound

Example (bin1) Description

x

int32

71032

x coordinate in bin N.

y

int32

103180

y coordinate in bin N.

count

uint8/uint16/
uint32

1

MID count at (x, y) when bin size is N. Data type for “count”
is consistent with “maxExp” in the “Attributes.”
2. FILE FORMAT

7

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

[optional] /geneExp/binN/exon:
Dataset “exon” is a 1D array which stores exon expression of each gene in the bin size of N,
aggregated by gene name.
Dataset Attributes

DataType

Example (bin1) Description

maxExon

int32

21

Dataset DataType:
1D array

DataType

Example (bin1) Description

count

uint8/uint16/
uint32

0

Max exon expression in binN.

Exon expression in binN at coordinate (x,y), the index is
same to the index in the “expression” dataset. Data type
for “count” is dynamically changed for each sample.

/geneExp/binN/gene:
Dataset “gene” is a 1D array which stores the gene names, the starting row indexes in dataset
“expression”, and row counts.
Dataset DataType:
compound

DataType

Example (bin1) Description

gene

S32

b'Gm16045'

Gene name.

offset

uint32

21

The starting row index in dataset “expression” for the
gene. In this example, the gene expression data for gene
“Gm16045” starts from row 21 in the dataset “expression.”

2

Row count.
In this example, expression data for gene “Gm16045” is
recorded in row 21 and 22 (2 rows) in the dataset “expression.”

count

uint32

[optional] /wholeExp/binN:
Dataset “binN” is a 2D array (matrix) which stores the MID count and gene type count at each
spot.
Dataset Attributes

DataType

Example (bin1) Description

number

uint64

22879557

Number of non-zero spots in the dense matrix.

minX

int32

59820

Minimum x coordinate in bin N.

lenX

int32

13221

Length of x.

minY

int32

102086

Minimum y coordinate in bin N.

lenY

int32

18454

Length of y.

maxMID

uint32

2155

Maximum MID count in a spot.

maxGene

uint32

846

Maximum gene type count in a spot.

resolution

uint32

500

Pitch (nm) between neighbor spots.

Dataset DataType:
2D array (XxY), com- DataType
pound

Example (bin1) Description

MIDcount

uint8/uint16/
uint32

1

MID count in the spot. The spot coordinate can be identified from the row and column index of the 2D matrix plus
the “minX” and “minY” specified in the attributes. Data
type for “MIDcount” is dynamically changed for each
sample.

genecount

uint16

1

Gene count in the spot. The spot coordinate can be identified from “Attributes” and the indexes of the 2D array.
2. FILE FORMAT

8

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

[optional] /wholeExpExon/binN:
Dataset “binN” in “/wholeExpExon/” Group is a 2D array (matrix) which stores the exon
expression count at each spot.
Dataset Attributes

DataType

Example (bin1) Description

maxExon

uint32

21

Dataset DataType:
DataType
2D array

Example (bin1) Description

uint8/uint16/
uint32

MIDcount

Maximum exon expression count in a spot when the bin
size is N.

0

MID count in the spot. The spot coordinate can be identified from the row and column index of the 2D matrix plus
the “minX” and “minY” specified in the attributes. Data
type for “MIDcount” is dynamically changed for each
sample.

[optional] /stat/gene:
Dataset “gene” is a 1D array which stores the MID count and spatial pattern enrichment score
(E10) of each gene. The array is order by the MID count in descending order.
Dataset Attributes

DataType

Example

Description

maxE10

float32

65.53

Maximum E10 score.

minE10

float32

0.

Minimum E10 score.

cutoff

float32

0.1

Threshold for filtering spots that will be used for computing E10.
In this example, 0.1 means that the spots whose MID
count is in the top 10% are used for calculating the spatial enrichment score.

Dataset DataType:
compound

DataType

Example

Description

gene

S32

b'Ptgds'

Gene name.

MIDcount

uint32

229502

MID count for the gene.

E10

float32

65.53

The spatial pattern enrichment score (E10) for the gene.

The distinctions of each SAW output GEF files are explained in Table 2-3.
Table 2-3 SAW Output GEF Files Description

GEF Name

SAW Pipeline

Example

Description

SN.raw.gef

count

SS200000135TL_
D1.raw.gef

count output raw GEF, it only includes geneExp Group
for the bin size of 1. The origin of expression matrix has
been calibrated to (0,0).

count

SS200000135TL_
D1.gef

count output full GEF file. It contains geneExp Group
and wholeExp Group for the bin size of 1, 10, 20,
50, 100, 200, and 500. SN.gef is also the only one that
includes stat Group. The origin of expression matrix has
been calibrated to (0,0), and its offsets are the same with
SN.raw.gef. SN.gef is the input file for visualization.

tissueCut

SS200000135TL_
D1.tissue.gef

tissueCut output GEF file for the tissue-covered region.
It only includes geneExp Group for the bin size of 1. The
coordinates in the matrix and the offsets are all same with
SN.raw.gef.

SN.gef

SN.tissue.gef

2. FILE FORMAT

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

GEF Name

SAW Pipeline

Example

tissueCut

SS200000135TL_
D1.ssDNA.gef

SN.<label>.
raw.label.gef

tissueCut

tissueCut output GEF file for the labeled ('aa' in the
B01020C2.
example) tissue-covered region. It only includes geneExp
Label01.raw.label.
Group for the bin size of 1. The coordinates in the matrix
gef
and the offsets are all the same with SN.raw.gef.

SN.<label>.
label.gef

tissueCut

B01020C2.
Label01.label.gef

SN.
<stainType>
.gef

9

Description
tissueCut output full GEF file for the tissue-covered
region. The coordinates in the matrix and the offsets are all
same with SN.tissue.gef. It contains geneExp Group and
wholeExp Group for the bin size of 1, 10, 20, 50, 100, 200,
and 500.

tissueCut output full labeled tissue-covered GEF file.

2.4.2 Cell Bin GEF
The first layer of Cell Bin GEF contains one required group “cellBin” and multiple optional datasets. The
second layer "codedCellBlock" is optional, which stores precomputed data used in the rendering of
StereoMap. “Attri-butes” of the file records the version of GEF format, software version, and omics
information. “Attribute” in each dataset records the key metrics of that dataset. Check
https://github.com/STOmics/SAW/tree/main/Documents/FileFormat to get the schematic diagram of
cell bin GEF. The field names and field data types of Cell Bin GEF are described in Table 2-4.
Table 2-4 Cell Bin Gene Expression File Text Fields Description

Attributes
File Attributes

DataType

Example

Description

geftool_ver

uint32[3]

0,7,11

geftool version. It can be used as an individual tool to
manipulate GEF files.

offsetX

int32

0

Minimum x coordinate in bin 1.

offsetY

int32

0

Minimum y coordinate in bin 1.

omics

S32

b‘Transcriptomcis’ Omics name.

resolution

uint32

500

Pitch (nm) between neighbor spots.

version

uint32

2

Gene expression file format version.

/cellBin/cell:
Dataset “cell” is a 1D array which stores basic information and indices information of cells
and expression.
Dataset Attributes

DataType

Example

Description

averageArea

float32

494.666

Average area for cells in pixel.

averageDnbCount

float32

194.299

Average number of mRNA-captured DNBs in a cell.

averageExpCount

float32

541.715

Average MID count in cell.

averageGeneCount

float32

310.157

Average gene count in cell.

maxArea

uint16

1925

Maximum area for cells in pixel.

maxDnbCount

uint16

883

Maximum number of mRNA-captured DNBs in a cell.

maxExpCount

uint16

3018

Maximum MID count in cell.

maxGeneCount

uint16

1415

Maximum gene count in cell.

maxX

int32

17658

Maximum x coordinate of the cell’s center of mass.

maxY

int32

19422

Maximum y coordinate of the cell’s center of mass.
2. FILE FORMAT

10

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/cellBin/cell:
Dataset “cell” is a 1D array which stores basic information and indices information of cells
and expression.
medianArea

float32

474.

Median area for cells in pixel.

medianDnbCount

float32

183.

Median number of mRNA-captured DNBs in a cell.

medianExpCount

float32

491.

Median MID count in cell.

medianGeneCount

float32

289.

Median gene count in cell.

minArea

uint16

2

Minimum area for cells in pixel.

minDnbCount

uint16

0

Minimum number of mRNA-captured DNBs in a cell.

minExpCount

uint16

0

Minimum MID count in cell.

minGeneCount

uint16

0

Minimum gene count in cell.

minX

int32

2933

Minimum x coordinate of the cell’s center of mass.

minY

int32

5568

Minimum y coordinate of the cell’s center of mass.

Dataset DataType:
compound

DataType

Example

Description

id

uint32

10

Cell ID index, the start ID is 0.
In the Example, 10 represent the 10th cell in the dataset.

x

int32

541

The x coordinate of the cell’s center of mass.
In the Example, the x coordinate of the 10th cell’s center
of mass is 541.

y

int32

190

The y coordinate of the cell’s center of mass.
In the Example, the x coordinate of the 10th cell’s center
of mass is 190.

494

The start row index of the cell in the “/cellBin/cellExp”
dataset.
The example represents that the gene ID index and total
MID count information of the 10th cell in the “/cellBin/
cellExp” dataset start from the 494th row.

offset

uint32

geneCount

uint16

100

Gene count in the cell.
In the example, 100 represents that the 100 rows in the
“/cellBin/cellExp”, start from the 494th to the 593th row,
contains the gene ID indices and total MID count of the
gene for the 10th cell in “/cellBin/cell” dataset.

expCount

uint16

500

Cell MID count.

dnbCount

uint16

200

mRNA-captured DNBs of the cell.

area

uint16

474

Cell area in pixel.

cellTypeID

uint32

0

Cell type ID.

clusterID

uint32

20

Cell cluster ID.

2. FILE FORMAT

11

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/cellBin/cellBorder:
Dataset “cellBorder” is a 3D array which stores the lists of points for the bounding polygons of
the cell.
Dataset Attributes

DataType

Example

Description

maxX

int32

16127

Maximum x coordinate of the bounding box of the cell.

maxY

int32

16663

Maximum y coordinate of the bounding box of the cell.

minX

int32

11129

Minimum x coordinate of the bounding box of the cell.

minY

int32

12784

Minimum y coordinate of the bounding box of the cell.

Dataset DataType:
3D array

DataType

Example

Description

-

32*(int16,int16)

[[-17,-11],[15,-5]…
[32767,32767]]

A list of 32 coordinates recording the differences between cell bounding points and the cell’s center of
mass (0,0). The real coordinate of cell’s center of mass (x,
y) can be obtained from “cell” dataset using cellID.

/cellBin/cellExp:
Dataset “cellExp” is a 1D array which stores the expression information of each cell.
Dataset Attributes

DataType

Example

Description

maxCount

uint16

336

Maximum MID count of a gene in a cell.

Dataset DataType:
compound

DataType

Example

Description

1610

Gene IDs of the genes detected in the cell. ID is the index
of “gene” dataset.
In the example, 1610 represents the 1610th item in the
“gene” dataset, and the name of the gene can be acquired in “gene” dataset.

3

MID count for the gene.
In the example, (assume this is the 0th item in the “cellExp” dataset, from the “offset” and “geneCount” record
in the “cell” dataset we can know that the 0th item in
the “cellExp” belongs to the cell whose cellID=0) the MID
count for the gene (geneID=1610) in the cell (cellID=0) is
3.

geneID

count

uint32

uint16

[optional] /cellBin/cellExon:
Dataset “cellExon” is a 1D array which stores the exon information for each cell.
Dataset Attributes

DataType

Example

Description

maxExon

uint16

5793

Maximum exon count of a gene in all cells.

minExon

uint16

0

Minimum exon count of a gene in all cells.

Dataset DataType:
DataType
1D array

Example

Description

-

16

Exon count in a cell, the index of the array is same to the
cellID in the “cell” dataset.

uint16

2. FILE FORMAT

12

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

[optional] /cellBin/cellExpExon:
Dataset “cellExpExon” is a 1D array which stores exon expression information for each cell.
Dataset Attributes

DataType

Example

Description

maxExon

uint16

336

Maximum exon count of a gene in a cell.

Example

Description

3

Exon count (MID) for the gene. The index is same to the
“cellExp” dataset.
In the example, (assume this is the 0th item in the “cellExpExon” dataset, since the index is same to “cellExp”
dataset, from the “offset” and “geneCount” record in
the “cell” dataset we can know that the 0th item in the
“cellExpExon” belongs to the cell whose cellID=0) the
exon count (MID) for the gene (geneID=1610) in the cell
(cellID=0) is 3.

Dataset DataType:
DataType
1D array

-

uint16

/cellBin/cellTypeList:
Dataset “cellTypeList” is a 1D array which stores cell types of each cell.
Dataset DataType:
1D array

DataType

Example

Description

-

S32

b'default'

Cell type, “default” stands for undefined cell type.

/cellBin/gene:
Dataset “gene” is a 1D array which stores the indices of cell and expression information of
each gene.
Dataset Attributes

DataType

Example

Description

maxCellCount

uint32

5718

Maximum number of cells a gene can be detected.

maxExpCount

uint32

55361

Maximum MID count of a gene.

minCellCount

uint32

1

Minimum number of cells a gene can be detected.

minExpCount

uint32

1

Minimum MID count of a gene.

Dataset DataType:
compound

DataType

Example

Description

geneName

S32

b'AC149090.1'

Gene name.

0

The start row index of the gene in “/cellBin/geneExp” dataset.
In the example, 0 means that start from the 0th item in “/
cellBin/geneExp” dataset records the cellIDs and total MID
count information of ”AC149090.1”.

offset

uint32

cellcount

uint32

60

Number of cells a gene can be detected.
In the example, 60 represents that start from the 0th
item to the 59th item records the information of gene
”AC149090.1”.

expCount

uint32

100

Sum of MID count for the gene.
In the example, the total MID count of ”AC149090.1” is 100.

maxMIDcount

uint16

4

Maximum MID count of a gene in a cell.
In this case, the maximum MID count of gene ”AC149090.1”
in a cell is 4.
2. FILE FORMAT

13

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/cellBin/geneExp:
Dataset “geneExp” is a 1D array which stores cell and expression information of each gene.
Dataset Attributes

DataType

Example

Description

maxCount

uint16

10

Maximum MID count of a gene.

Dataset DataType:
compound

DataType

Example

Description

1247

cellID that contains the gene whose index is same to the
index in “gene” dataset.
In the example, (assume we use the 0th item in “geneExp”
dataset) 1247 shows that the gene ”AC149090.1” appears
in the cell whose cellID is 1247.

3

The MID count of the gene, whose index is same to the
index in “gene” dataset, in the cellID.
In the example, the MID count of gene ”AC149090.1” in the
cell (cellID=1247) is 3.

cellID

count

uint32

uint16

[optional] /cellBin/geneExon:
Dataset “geneExon” is a 1D array which stores the exon expression information of each gene.
Dataset Attributes

DataType

Example

Description

maxExon

uint32

55361

Maximum exon count of a gene.

minExon

uint32

0

Minimum exon count of a gene.

Dataset DataType:
1D array

DataType

Example

Description

97

Total exon count of a gene, the index of “geneExon”
dataset is same to the “gene” dataset.
In the example, (assume this is the 0th item in the
“geneExon” dataset, and gene ”AC149090.1” is the 0th
item in the “gene” dataset) the exon count of gene
”AC149090.1” is 97.

-

uint32

[optional] /cellBin/geneExpExon:
Dataset “geneExpExon” is a 1D array which stores the exon expression information in cells of
each gene.
Dataset Attributes

DataType

Example

Description

maxExon

uint16

336

Maximum exon expression of a gene in a cell.

Dataset DataType:
1D array

DataType

Example

Description

3

Exon count of a gene in a cell. The index of “geneExpExon” dataset is same to the “geneExp” dataset.
In the example, (assume this is the 0th item in the
“geneExpExon” dataset, since the index is same to
“geneExp” dataset, from the “offset” and “cellCount”
record in the “gene” dataset we can know that the
0th item in the “geneExpExon” dataset belongs to the
gene ”AC149090.1”) 3 stands for the exon count of gene
”AC149090.1” in cell 1247 is 3.

-

uint16

2. FILE FORMAT

14

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/cellBin/bockIndex:
Dataset “bockIndex” is a 1D array which stores the matrix block partition information.
Dataset DataType:
1D array

DataType

Example

Description

-

uint32

0

Cell count in each partition block.
cnt=blockIndex[i+1]-blockIndex[i]

/cellBin/bockSize:
Dataset “bockSize” is a 1D array which stores the block size of partition.
Dataset DataType:
1D array

DataType

Example

Description

-

uint32

256, 256, 104, 104

4-element array. The 4 items represent the block length
in x-axis, block length in y-axis, block count in x-axis,

and block count in y-axis, respectively.

[optional]/codedCellBlock:
Group "codedCellBlock" stores pre-computed data for rendering in StereoMap.
Group Attributes

DataType

Example

Description

info

string

{"@type":
"neuroglancer_
annotations_v1",
...}

Metadata of encoded precomputed data in JSON.

[optional]/codedCellBlock/L0/0_1:
Dataset "0_1" is an example chunk encoded pre-computed data, including id, geometry, and
so on.
Dataset Data
Type:Bytes

DataType

Example

H5T_OPAQUE 1F 8B 08 00 ...

Description

Bytecode of the chunk.

2. FILE FORMAT

15

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

2.5 Gene Expression Matrix
Gene expression matrix stores genes spatial expression data. SAW generates multiple gene expression matrix
files in the workflow, the basic format requires four columns with a header row that shows the column names.
The four columns are gene name, x coordinate, y coordinate, and MID count. The origin of tissueCut generated gene expression matrices have been calibrated to (0, 0). The header of expression matrix for maximum
area enclosing rectangle region has six annotation rows start with “#” before the column rows. The header
field names and field types are described in Table 2-5.
Table 2-5 Gene Expression Matrix Header Fields Description

Fields

DataType

Example

Description

#FileFormat

string

GEMv0.1

Gene expression matrix file format version.

#SortedBy

string

None

Gene expression matrix sorting strategy. Valid values:
“geneID”, “x”, “y”, ”MIDCount”, “None”.

#BinType

string

Bin

Bin type of the GEM file.

#BinSize

string

1

(Please check 1.3 Terminologies and Concepts Bin)

#Omics

string

Transcriptomics

(Omics name.

#Stereo-seqChip

string

SS200000135TL_D1

Stereo-seq Chip T serial number.

#OffsetX

uint32

1

X coordinate of the origin before calibration.

#OffsetY

uint32

1

Y coordinate of the origin before calibration.

geneID

string

Cr2

Gene name.

x

uint32

16809

X coordinate of the spot.

y

uint32

8546

Y coordinate of the spot.

MIDCount

uint32

1

Number of MIDs at (x, y) for the gene in the corresponding row.

ExonCount

uint32

0

(Optional) Number of exon count at (x, y) for the gene
in the corresponding row.

CellID

uint32

55892

(Optional) CellID for (x, y).

Example of GEM:
#FileFormat=GEMv0.1
#SortedBy=None
#BinType=Bin
#BinSize=1
#Omics=Transcriptomics
#Stereo-seqqCqhqiqp
=SS200000135TL_D1
#OffsetX=0
#OffsetY=0
geneID

x

Ptgds

7585

19729

1

1

55892

Cdk8

7582

19730

2

0

55892

19730

2

2

1500011K16Rik

y

MIDCount

7585

ExonCount

CellID

55892

2. FILE FORMAT

16

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

2.6 Image Process Record File
Image process record (IPR) file is designed to record the whole-life information of a microscopic staining
image from photo-taking to processing. Each staining image (ssDNA/DAPI, IF, H&E) includes six basic groups,
“ImageInfo”, “QCInfo”, “Stitch”, “TissueSeg”, “CellSeg”, and “Register”, which are used to store microscopy
photo-taking information, image quality control information, image stitching records, tissue segmentation
records, cell segmentation records (optional), and registration records. Check https://github.com/STOmics/
SAW/tree/main/Documents/FileFormat to get the schematic diagram of IPR.
Table 2-6 IPR File Format and Text Fields Description

File Attribute & Dataset
Attributes

Description

IPRVersion

IPR file format version.

Dateset

Description

Preview

A 2D matrix merges stitched image, tissue segmentation boundary and
cell segmentation boundary.

/<stainType>/ImageInfo:
Group records basic image information.
Attributes

Description

AppFileVer

Microscope software version.

BackgroundBalance

Background balance.

BitDepth

The bit-depth of a camera sensor describes its ability to transform the
analog signal coming from the pixel array into a digital signal.

Brightness

Relative intensity affecting a person or sensor.

ChannelCount

Number of RGB channels.

ColorEnhancement

Whether enhanced image color display or not.
The difference in color and intensity of the depicted object from its
background.

Contrast
DeviceSN

Microscope device serial number.

DistortionCorrection

Whether fixed distortion or not.

ExposureTime

Exposure time in ms.

FOVHeight

Height of an individual FOV in pixel.

FOVWidth

Width of an individual FOV in pixel.

Gain

Amplification applied to the signal by the image sensor.

Gamma

The coefficient links between the human eye and the digital camera.

GammaShift

Whether adapt the digital image taken with the help of a linearly recording camera to the nonlinear perception of the human eye or not.

Illuminance

Intensity of light.

Manufacture

Microscope manufacture.

Model

Microscope model.

Overlap

Overlapping pixels between single tiles.

Pitch

Physical pitch (nm) between neighbor spots.

2. FILE FORMAT

17

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/<stainType>/ImageInfo:
Group records basic image information.
PixelSizeX

Size of pixel in x direction.

PixelSizeY

Size of pixel in y direction.

QCResultFile

Prefix of ImageQC/ImageStudio result file, the unique identifier of the
image.

ScanChannel

Fluorescence channel.

ScanCols

Number of columns scanned.

ScanObjective

Magnification power of the scan objective lens.

ScanRows

Number of rows scanned.

ScanTime

Scan date and time.

Sharpness

Degree of clarity of the edge(s) of the image.

StereoResepVersion

Stereo-resep version.

StitchedImage

Whether the corresponding image is a panorama image (true) or a set
of tiled images (false).

STOmicsChipSN

Stereo-seq Chip T serial number.

WhiteBalance

An adjustment in electronic and film imaging that corrects the color
balance of the lighting.

Dataset DataType:
1D array

Description

RGBScale

RGB color.

/<stainType>/QCInfo:
Group records the QC information of the image.
Attributes

Description

ClarityScore

Reference score for evaluating the clearness of cell boundaries.

Experimenter

Email of the experimenter who did QC for the image.

GoodFOVCount

Number of FOVs that have identified more than 3 track cross points.

ImageQCVersion

ImageQC/imageStudio version.

QCPassFlag

Whether the corresponding image passed QC.

RemarkInfo

Any remarks, notes, comments on the image.

StainType

Stain type of microscopy image.

TotalFOVCount

Total number of FOVs.

TrackLineScore

Reference score for evaluating whether the detected track lines can be
used as references for image stitching and registering with gene expression matrix. (This score only evaluate whether the program detected
track lines on the image, it does not infer the clarity of the lines or the
images).

TrackLineChannel

Shooting channel of track lines.

TrackCrossQCPassFlag

Whether the QC of the track-cross point is passed.

ScopeStitchQCScore

Score to assess the stability of microscope overlap.

ScopeStitchQCMatrix

Matrix of overlap deviation of each microscope FOV.

ScopeStitchQCPassFlag

Whether the QC of microscope stitch is passed.
2. FILE FORMAT

18

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/<stainType>/QCInfo:
Group records the QC information of the image.
Attributes

Description

TemplateValidArea

Proportion of encircled area by the detected points that match the
global track line template (within the error range of 5 pixels), to the
entire imagearea.

TemplateRecall

Proportion of detected points, which match the global track line
template (within the error range of 5 pixels), to the points derived from
the chip track line rules.

ClarityCutSize

Size of cut images (based on FOV) for clarity evaluation.

ClarityCounts

Counts of cut images in different categories.

ClarityOverlap

Overlap of cut images for clarity evaluation.

Dataset DataType:
2D array

Description

ScopeStitchQCMatrix

Matrix of overlap deviation of each microscope FOV.

CrossPoints/row_col*n

Group of datasets for each FOV that records the track cross point coordinates. (Row and col stand for the FOV row and column index number,
and n stands for number of FOVs). Each dataset is a 2D array records, (x,
y) coordinates of track cross points in each FOV.

ClarityArr

Clarity prediction of each cut image.

/<stainType>/Calibration
Group records the calibration information (only <protein>_IF).
Attributes

Description

CalibrationQCPassFlag

Whether the calibration QC of IF image is passed.

/<stainType>/Calibration/Scope
Attributes

Description

Confidence

Calibration confidence of microscope-stitched tiled image vs. IF.

OffsetX

Horizontal offset.

OffsetY

Vertical offset.

[optional]<stainType>/Calibration/BGI
Attributes

Description

Confidence

Calibration confidence of BGI-stitched image vs. IF.

OffsetX

Horizontal offset.

OffsetY

Vertical offset.

2. FILE FORMAT

19

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/<stainType>/Stitch:
Group records the stitching information.
Attributes

Description

StitchingScore

Reference score for stitching.

TemplateSource
WhichStitch

The reference FOV for deriving the template used for rotating and scaling the microscopic images.
Stitching method for tiled images, including microscope, template and
ripple stitching. Tiled image only.

Dataset DataType:
2D array

Description

TemplatePoint

Coordinates of derived global template points.

TransformTemplate

Coordinates of template points registered with expression matrix.

/<stainType>/Stitch/BGIStitch:
Group records the image stitching information processed by BGI program.
Attributes

Description

StitchedGlobalHeight

Height of stitched tiled images using BGI stitching algorithm. Tiled
image only.

StitchedGlobalWidth

Width of stitched tiled images using BGI stitching algorithm. Tiled
image only.

Dataset DataType:
2D array

Description

StitchedGlobalLoc

Coordinates for the BGI stitched tiled image.

/<stainType>/Stitch/ScopeStitch:
Group records the image stitching information processed by microscope imaging software.
Attributes

Description

GlobalHeight

Height of panorama image.

GlobalWidth

Width of panorama image.

Dataset DataType:
2D array

Description

GlobalLoc

Coordinates for the stitched tiled image (either program stitched or
microscope stitched).

ScopeJitterDiff

Jitter offset of microscope stitching.

ScopeHorizontalJitter

Horizontal jitter offset of microscope stitching. Tiled image only.

ScopeVerticalJitter

Vertical jitter offset of microscope stitching. Tiled image only.

2. FILE FORMAT

20

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/<stainType>/Stitch/StitchEval:
Group records the evaluation result of stitching.
Attributes

Description

MaxDeviation

Maximum stitching deviation. Tiled image only.

Dataset DataType:
2D array

Description

GlobalDeviation

Global stitching deviation matrix.

StitchEvalH

Stitching deviation matrix for the horizontal axes.

StitchEvalV

Stitching deviation matrix for the vertical axes.

/<stainType>/TissueSeg:
Group records the tissue segmentation information.
Attributes

Description

TissueSegScore

Reference score for tissue segmentation.

TissueSegShape

Image shape for tissue segmentation mask image.

Dataset DataType:
2D array

Description

TissueMask

Encoded tissue segmentation mask file (before registration with gene
expression matrix).

/<stainType>/TissueSeg/Labeling/<label_name>:
Group records the labeling tissue segmentation information, specifically labeled areas.
Attributes (within Dataset)

Description

Color

Color of the labeling area.

Description

Description for the labeling area.

Dataset DataType:
2D array

Description

Canvas

Serialization string of canvas.

Canvas
Serialization string of canvas.
/<stainType>/TissueSeg/Labeling/<label_name>/Element_<num>:

Group records the detailed information of each labeling element.

Attributes (within Dataset)

Description

Shape

Shape of the labeling area.

Offset

Offset of the labeling area.

Dataset DataType:
2D array

Description

LabelMask

Encoded label mask file.

2. FILE FORMAT

21

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/<stainType>/CellSeg:
Group records the cell segmentation information.
Attributes

Description

CellSegShape

Reference score for cell segmentation.

Dataset DataType:
2D array

Description

CellMask

Encoded cell segmentation mask file (before register with gene expression matrix).

CellSegTrace

Cell contour attributes, including height, width and area.

/<stainType>/Register:
Group records the information that align images with gene expression matrix.
Attributes

Description

CounterRot90

Count of counter-clockwise rotation of 90 degrees.

Flip

Whether horizontally flipped or not.

MatrixShape

Height and width of the gene expression matrix.

OffsetX

Offset between microscope image and gene expression matrix in x-axis.

OffsetY

Offset between microscope image and gene expression matrix in y-axis.

RegistrationScore

Reference score for registration.

Rotation

Rotation degree between raw image and deviation template.

ScaleX

Scale between raw image and deviation template in horizontal direction.

ScaleY

Scale between raw image and deviation template in vertical direction.

XStart

Gene expression matrix offset x (GEF geneExp/binN/expression attribute minX).

YStart

Gene expression matrix offset y (GEF geneExp/binN/expression attribute minY).

ManualRotation

Manual rotation degree of the raw image around the center point.

ManualScaleX

Manual scale of the raw image in horizontal direction based on center
point.

ManualScaleY

Manual scale of the raw image in vertical direction based on center
point.

Dataset DataType:
2D array

Description

MatrixTemplate

List of track cross points derived from gene expression matrix.

/StereoResepSwitch:
Group stores the state of each module that whether the module need to be performed.
Attributes

Description

stitch

Switch for performing stitching.

tissueseg

Switch for performing tissue segmentation.

cellseg

Switch for performing cell segmentation.

register

Switch for performing registration.

2. FILE FORMAT

22

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

/ManualState:
Group stores the state of each module that whether the module has been manually processed.
Attributes

Description

stitch

Whether manually stitched the tiled images.

tissueseg

Whether manually delineated the tissue coverage region.

cellseg

Whether manually delineated the cell coverage regions.

register

Whether manually aligned microscope image and gene expression
matrix.

calibration

Whether manually calibrated two images. For example, manually
match IF image with DAPI image.

2.7 Image Pyramid
The image pyramid model is a multi-resolution hierarchical model that is used to store and display images in
different resolutions. For the same field of view, the layer of the image pyramid that is closest to the bottom includes the most detailed information and has the largest scale. register pipeline performs the down-sampling step on the registered image, and the resulted images are layered to construct a pyramid with the suffix
“.rpi”. For each resolution layer, the intact registered image is split into 256 pixels x 256 pixels tiles. If the size of
a layer is smaller than 256 x 256, the image will then remain intact.
The outer layer group of RPI file is defined according to its stain type, generally including ssDNA, DAPI, IF
(immunofluorescence image especially for protein, group name as <protein_IF>), and HE. In each group of
stain types, multiple image results, including an image subgroup (registered microscopy image), a TissueMask
subgroup (registered mask boundary for the tissue coverage area), and a CellMask subgroup (registered mask
boundaries for the cell coverage area, optional), could be saved respectively.
Schematic diagram of image pyramid:

2. FILE FORMAT

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

23

2. FILE FORMAT

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

References
1.

STOmics/SAW. Accessed April 17, 2023. https://github.com/STOmics/SAW

2.

Sequence Alignment/Map Format Specification. Accessed May 21, 2021. https://
github.com/samtools/hts-specs.

24

STOmics Stereo-seq ANALYSIS WORKFLOW FILE FORMAT Manual

Contact Us
Beijing Genomics Institute (Shenzhen)
https://en.stomics.tech
Email: info_global@stomics.tech
Please raise GitHub issues for reporting bugs and requesting features:
SAW GitHub Issue Page: https://github.com/STOmics/SAW/issues

25

Stereo-seq
ANALYSIS WORKFLOW
SOFTWARE SUITE
USER MANUAL

Software Version: V7.0
Manual Version: A8.1

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

REVISION HISTORY
Manual Version:
Software Version:
Date:
Description:

A0
V1.0.0
Nov. 2021
Initial release

Manual Version:
A1
Software Version: V2.1.0
Date:
Dec. 2021
Description:
•

New feature: addition of manual registration
function, some fine-tuning will be automatically
performed after manually registering;

•

Improvement: performance improvement for
mapping; the order of sequencing saturation
calculation has switched, in v2.1.0 we only
compute the saturation of tissue-covered
region;

•

Manual Version:
A3
Software Version: V5.1.3
Date:
Aug. 2022
Description:
•

New feature: addition of cell segmentation
on microscopic image in register pipeline
module and cellCut pipeline module to
extract cell expression matrix; design IPR file
to store image processing record information
and TIFF images produced in register;
output exon expression matrix along with total
MID count; addition of cell clustering analysis;
addition of cell bin statistic result and image
information in HTML report; add pipeline
modules to support single-end FASTQ data;
addition of option for selecting multi-mapped
reads; addition of score system in image
processing;

•

Improvement: addition of poly A filtration
in mapping; performance improvement for
merge, tissueCut and saturation; add
data scaling and upgrade clustering analysis
pipeline;

•

Bug fix: fix the bug of plotting scatter plot in
tissueCut, review and modify the ambiguous
metrics names and explanations in HTML report.

Bug fix: fixed the bug of indexing at mapping
step; fix the bug of long waiting time at
register step.

Manual Version:
A1.1
Software Version: V2.1.0
Date:
Jan. 2022
Description:
•

Add error handling;

•

Update demo output.

Manual Version:
A2
Software Version: V4.1.0
Date:
Apr. 2022
Description:
•

New feature: support to process fused
microscopic images; employ Stereopy in
clustering; new gene expression matrix file
format; including a file format convertor and a
mapping memory estimator;

•

Improvement: performance improvement for
mapping; update gene annotation approach
in count; update image stitching and tissue
segmentation model for better performance
on image stitching and segmentation for tissue
with voids.

Manual Version:
A4
Software Version: V5.4.0
Date:
Nov. 2022
Description:
•

New feature: render a more elegant way of
organizing SE FASTQs input into mapping;
addition of header for count output TXT file;
upgrade ipr2img to imageTools which
allows you to merge TIFF images to check
segmentation result and plot templates on the
panoramic image or registered image to check
the result of stitching and registration;

•

Improvement: change data struct of gene index
in the GEF file from uint16 to uint32 to store
more genes;

•

Bug fix: fix the typo in the manual.

2

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Manual Version:
A3.1
Software Version: V5.1.3
Date:
Dec. 2022
Description:
•

Bug fix: fix the typo in the manual.

Manual Version:
A6
Software Version: V6.0
Date:
Mar. 2023
Description:
•

New feature: addition of rRNAremove switch
in mapping, off by default, to count and filter
rRNA reads using the reference genome with the
addition of rRNA information. rRNA count and
ratio are recorded in the output file; support
the scenario with the combination of DAPI and
mIF (multiple immunofluorescence images),
correspondingly generating registered, tissue
segmentation, and cell segmentation results;
support continuously processing image files
output from each module of ImageStudio;

•

Improvement: reconstructed tissueCut
module pipeline, with the addition of
parameter-t which means the number of
used CPUs, to greatly improve the calculation
efficiency; modified parameter -g in img2rpi
module to a two-layer structure, upgraded RPI
file format to support storing and organizing
multiple stained microscopy images in groups;
displayed pseudo colors (up to 7 colors) on
the bottom layer of clustering results in HTML
report, when handling the scenario of mIF in
report module;

•

Bug fix: fix the bug caused by version
compatibility when generating CGEF file.

Manual Version:
A5
Software Version: V5.5.0 - V5.5.2
Date:
Jan. 2023
Description:
•

New feature: addition of manualRegister
and lasso pipeline modules, which acquire
parameters and essential files from offline
visualization software StereoMap; addition of
error code function in each module, and the
explanation has been organized in appendix D;

•

Improvement: upgrade tissueCut pipeline
module for better performance and improved
accuracy of tissue recognition directly from
gene expression matrix; upgrade clustering
analysis pipelines; addition of image layers in
HTML report which allow users to switch images
displayed with gene expression distribution
plot; the stitching deviation heatmap(s) and
the frame of axes in the HTML report have
been adjusted according to the registration
parameters.

Manual Version:
A5
Software Version: V5.5.3
Date:
Mar. 2023
Description:
•

Improvement: upgrade mapping pipeline
module, which performs polyA filtering after
CID mapping, for improved statistical output in
report.

Manual Version:
A6.1
Software Version: V6.0.1 & V5.4.4
Date:
Apr. 2023
Description:
•

Bug fix: fix the bug that the execution path of
checkGTF function was invalid.

3

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Manual Version:
A6.1
Software Version: V6.0.2
Date:
Jun. 2023
Description:
•

Improvement: removed the dependence of
parameters related to stitched-image stitchingevaluation from different versions of QC.
The evaluation of stitched-image stitching is
completed by register module; prompt
an error when <StainType> in .ipr file is '-' ;
supported Zeiss microscope-stitched image;

•

Bug fix: for register, fixed the issue that
the module was unable to get .czi file path;
fixed the issue of doing cell segmentation in
rapidRegister for manually-stitched data;
fixed the issue that the registered .ipr file that
could not be registered again; expanded the
chip-prefix list and fixed the track line template
acquisition error. For imageTools, fixed the
issue that bin_100 of cellMask in the SN.rpi
file did not save corresponding metadata; fixed
the issue that the merge could not be performed
on images with the same width and height.

Manual Version:
A7
Software Version: V6.1
Date:
Jul. 2023
Description:
•

•

New feature: supported outputs of Valid ClD
Reads and un-mapped reads in FASTQ format;
supported QC-failed but manually processed
images as inputs for subsequent workflow;
addition of tissue area (nm²) in corresponding
GEF file; supported generating GEF file of
labeled region; addition of quality control alerts
and tissue segmentation display in report;
Improvement: updated mapping module to
improve computational efficiency; updated the
error alerts on checking the length of the gene
name, in checkGTF and count modules.

Manual Version:
A7
Software Version: V6.1.1
Date:
Aug. 2023
Description:
•

Bug fix: for manualRegister, fixed the
issue that obtaining information from
manual registration file.json incorrectly
resulted in wrong width and height of images;
for tissueCut, corrected the statistical
method of Reads_under_tissue item in
tissueCut, which now represents "Number
of reads with position prior to filtration under
tissue coverage"; for report, compatible with
the .ipr file which is failed with image quality
control (QC) and has no record of heat map
matrix information needed for html report.

Manual Version:
A7
Software Version: V6.1.2
Date:
Sep. 2023
Description:
•

Bug fix: for manualRegister, fixed the
offset calculation error of whcih the scale
direction was incorrect.

Manual Version:
A7
Software Version: V6.1.2
Date:
Oct. 2023
Description:
•

Bug fix: for imgeTool, fixed the problem
that manually registered images were
incorrectly cropped after scale operation;
for report, fixed the missing percentage
value of floating text box for 'Sequencing
Saturation', in HTML diagram.

4

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

A8.1
Manual Version:
Software Version: V7.0
Date:
Nov. 2023
Description:
•

•

New feature: supported H&E image in
pipeline; addition of cellCorrect module
for expanding cell boundaries; addition of
cellChunk module for displaying cell
expression heatmap in StereoMap; addition
of new parameter in spatialCluster
addition of a new parameter in spatialCluster
for adjusting Leiden clustering resolution;
addition of output GEF file in lasso module;
Improvement: performance improvement in
count and register modules; updated
tissue and cell segmentation model for
nuclei-stain image; supported for using GPU
in register module to accelerate
computing.

5

Note: Please download the latest version of the
manual and use it with the software specific to this
manual.
©2023 Beijing Genomics Institute (Shenzhen).
All rights reserved.
1. The products shall be for research use only, not for
use in diagnostic.
2. The Content on this manual may be protected
in whole or in part by applicable intellectual
property laws. Beijing Genomics Institute and / or
corresponding right subjects own their intellectual
property rights according to law, including but not
limited to trademark rights, copyrights, etc.
3. Beijing Genomics Institute does not grant or imply
the right or license to use any copyrighted content
or trademark (registered or unregistered) of us or
any third party. Without our written consent, no
one shall use, modify, copy, publicly disseminate,
change, distribute, or publish the program or Content
of this manual without authorization, and shall not
use the design or use the design skills to use or take
possession of the trademarks, the logo or other
proprietary information (including images, text, web
design or form) of us or our affiliates.
4. Nothing contained herein is intended to or
shall be construed as any warranty, expression or
implication of the performance of any products
listed or described herein. Any and all warranties
applicable to any products listed herein are set
forth in the applicable terms and conditions of sale
accompanying the purchase of such product. Beijing
Genomics Institute (Shenzhen) makes no warranty
and hereby disclaims any and all warranties as to
the use of any third-party products or protocols
described herein.

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

6

7

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

TABLE OF CONTENTS
CHAPTER 1: Stereo-seq ANALYSIS WORKFLOW SOFTWARE SUITE
1.1. Software Introduction						
1.2. System Requirements 						
1.3. Related Software 						
1.4. SAW Docker Image Installation 				
1.5. SAW GitHub							
1.6. SAW Test Data							
1.7. SAW Output File Format					

1
2
2
3
4
5
5

CHAPTER 2: SAW PIPELINES & ARGUMENTS
2.1. splitMask					
		
2.2. CIDCount							
2.3. mapping							
2.4. merge (optional)						
2.5. count								
2.6. register					
			
2.7. imageTools					
		
2.8. tissueCut							
2.9. spatialCluster							
2.10. cellCut							
2.11. cellCorrect
2.12. cellCluster							
2.13. saturation							
2.14. report								
2.15. Other Applications						

7
8
10
18
19
22
24
26
30
31
32
33
34
36
43

CHAPTER 3: TEST DATA DEMONSTRATION
3.1. mapping							
3.2. merge								
3.3. count								
3.4. register and imageTools					
3.5. tissueCut							
3.6. cellCut							
3.7. saturation							
3.8. report								

57
59
59
61
65
68
69
69

8

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

APPENDICES

						

Appendix A: Recommend Directory Structure for Raw Data
Appendix B: SAW ST Output File List				
Appendix C: Handling Errors and Exceptions			
Appendix D: Error Codes			
			

75
76
80
82

REFERENCES

						

93

CONTACT US							

94

CRITICAL STEPS: Pay extra attention to these instructions/steps to avoid problematic results.
SOLUTION: Provides a solution to handling common errors.

STOMICS ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

CHAPTER 1
Stereo-seq ANALYSIS
WORKFLOW SOFTWARE
SUITE

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

1

1.1. Software Introduction
Stereo-seq Analysis Workflow1 (SAW) software suite is a set of pipelines bundled to position sequenced reads
to their spatial location on the tissue section, quantify spatial gene expression and visually present spatial
expression distribution. SAW processes the sequencing data of Stereo-seq2 to generate spatial gene expression
matrices, and then users could take these files as the starting point to perform downstream analysis. SAW
includes thirteen essential and suggested pipelines and auxiliary tools for supporting other handy functions:
•

splitMask: Split Stereo-seq Chip T mask file into several pieces according to CID indexing in the Q4 FASTQ
files.

•

CIDCount: Count CIDs in the Stereo-seq Chip T mask file and roughly estimate memory required to do
mapping.

•

mapping: Correspond in situ captured sequenced reads recorded in FASTQ3,4 files by Stereo-seq with their
spatial information. It also aligns reads to the reference genome and generates coordination sorted BAM
files.

•

merge (optional): Combine CID (same as barcodes) listed files with reads count from multiple runs of
mapping. Only for an analysis that requires to combine multiple pairs of FASTQ.

•

count: Read BAM files generated from mapping to perform gene annotation, de-duplication, and gene
expression analysis on the aligned reads.

•

register: Align microscopic tissue staining image with gene expression matrix file (GEF) generated from
count.register is an optional pipeline when image fails QC or input image is absent.

•

imageTools: Convert TIFF images from IPR, such as template-aligned stitched TIFF image, binarized tissue
segmentation and cell segmentation images. Optional module when image fails QC or input image is
absent.

•

tissueCut: Identify tissue coverage area on the chip and extract gene expression matrix of the
corresponding spatial location by taking inputs from both count and register or count pipeline
alone.

•

spatialCluster: Perform clustering analysis for spots (bin200) according to the gene expression matrix of
the tissue coverage area generated from tissueCut.

•

cellCut: Identify cell nuclei area on the staining image and extract gene expression matrix of the
corresponding spatial location by taking inputs from both count and register&imageTools
pipeline. Optional module when image fails QC or input image is absent.

•

cellCorrect: Adjust cell coverage region based on the aligned cell nuclei segmentation image generated
from register and imageTools. Then, output expression matrix of the adjusted cells in cell bin GEF
and GEM formats.

•

cellCluster: Perform clustering analysis for cell bins according to the gene expression matrix which is
generated from cellCorrect. Optional module when image failed QC or input image is absent.

•

saturation: Calculate sequencing saturation of tissue coverage area based on the file that was used for
sampling data generated from count.

•

report: Generate a JSON format statistical summary report that integrates the analysis result from each
step, as well as an HTML web analysis report, and shows spatial expression distribution of genes, key
statistical metrics, sequencing saturation plots, clustering analysis results. Depending on the image input
state and register mode, HTML reports may or may not have cell bin statistical data and image processing
key results.

Other handy functions:
•

Other applications of cellCut: Manipulate GEF file.

•

checkGTF: Check GTF/GFF file is prepared in the correct format, otherwise, re-format one that meets the
compatibility requirements for count.

1. STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

•
•

2

Other applications of imageTools: 1) Merge two to three TIFF images in R-G-B order, which is useful for
checking segmentation result. 2) Plot templates on the panoramic image to assist in the evaluation of
stitching and registration result. 3) Write TIFF images into RPI format.
manualRegister: Acquire manual registration operation parameters from StereoMap visualization
software and run manualRegister to modify registration records in IPR. Users can turn on the "finetune" switch to let manualRegister perform an automatic adjustment to the manually operated result
to make the registration more precise.

•

lasso: Acquire one or multiple cell or spatial gene expression matrix subsets according to the GEOJSON
file, which stores the coordinates data of manually delineated region(s) from StereoMap visualization
software.

•

cellChunk: Generate encoding pre-computed data used for StereoMap rendering.

1.2. System Requirements
SAW runs on Linux systems that meet the following minimum requirements:

8-core Intel or AMD processor (>24 cores
recommended)
128GB RAM (>256GB recommended)
1TB free disk space or higher
64-bit CentOS/RedHat 7.8 or Ubuntu 20.04
To install and run SAW, please install one kind of the following softwares:
docker5: version 20.10.8 or higher
singularity6: version 3.8 or higher

1.3. Related Software
•

ImageQC: STOmics microscope ImageQC software is a desktop application intended for assessing the
quality of microscope images. The fluorescent image should pass ImageQC evaluation to ensure that it
fulfills the requirements for SAW pipelines. SAW >= 5.0.0 requires ImageQC version >= 1.1.0 that provides
IPR file for recording image processing data. The final version of ImageQC is v1.2.0 and will be no longer
updated.

•

ImageStudio: ImageStudio is a fully upgraded image process desktop application which integrates
the entire ImageQC functionality. It contains four main image processing modules: image QC, manual
stitching, manual tissue segmentation, and manual cell segmentation. The outputs of each module can be
input into SAW for further analysis. SAW v7.0 recommends ImageStudio version >= v3.0.

•

StereoMap: StereoMap is an HD visualization desktop application intended for displaying Stereo-seq
analysis results. SAW outputs such as gene expression matrix GEF file, image RPI and IPR files, clustering
results can be visualized via StereoMap. SAW v7.0 recommends StereoMap version >= v3.0.

1. STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE

3

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

1.4. SAW Docker Image Installation
SAW is delivered as a docker image that bundles all of its required software dependencies. You can pull the
SAW docker image from Docker Hub to your local system and run analyses offline.
Please download the latest version of the software and use it with the corresponding Stereo-seq Analysis
Workflow Software Suite User Manual version.
Docker Hub link: https://hub.docker.com/r/stomics/saw/tags
We support using Singularity and Docker to install and run the SAW.
Here we take SAW version 6.1 as an example.

1.4.1. SAW Installation via Singularity
Please replace the yellow highlighted inputs with your own data path.
Step 1: Pull the SAW docker image (2 options):
$ singularity build SAW_v7.0.sif docker://stomics/saw:07.0.0 ## option 1
$ singularity build --sandbox SAW_v7.0/ docker://stomics/saw:07.0.0 ## option 2

For non-root users, especially who don’t have enough space in the /home/ directory, please try:
$ export SINGULARITY_CACHEDIR=/path/to/build
$ singularity build --sandbox SAW_v7.0/ docker://stomics/saw:07.0.0

Step 2: Run pipelines (3 options):
Please Note! All the requested paths need to be mounted before input. For example, it is necessary
to bind directories that store input files(/path/to/data), reference genome (/path/to/genomeDir), and outputs (/path/to/output).
$ export SINGULARITY_BIND=”/path/to/data,/path/to/genomeDir,/path/to/output”

Option 1: Run pipelines within the container from the host system.
$ /path/to/SAW_v7.0.sif <application> ## option 1.1
$ singularity exec /path/to/SAW_v7.0.sif <application>

## option 1.2

1. STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

4

Option 2: Shell into the SAW container and interactively run bash commands. Run exit to exit the environment.
$ /path/to/SAW_v7.0.sif /bin/bash ## option 2.1
Singularity>
Singularity> <shell-command>
Singularity> exit
$
$ singularity shell /path/to/SAW_v7.0.sif ## option 2.2
Singularity>
Singularity> <shell-command>
Singularity> exit
$
$ singularity shell SAW_v7.0 ## option 2.3 for sandbox
Singularity>
Singularity> <shell-command>
Singularity> exit
$

Option 3: Use “-B directory on the host-machine:directory in the container” to
mount a host directory into the container and execute the command in the container.
$ singularity shell -B /path/to/directory/on/the/host-machine:/path/to/directory/

* mounted/in/the/container /path/to/SAW_v7.0.sif
Singularity>
Singularity> <shell-command>
Singularity> exit
$

* Please be noted that these two lines belong to the same line of command.

1.4.2. SAW Installation via Docker
Step 1: Pull the SAW docker image
$ docker pull stomics/saw:07.0.0

Step 2: Run pipelines
$ docker run -d -v /path/to/data:stomics/saw:07.0.0 /bin/sh -c “<shell-command>”

1.5. SAW Github
SAW GitHub: https://github.com/STOmics/SAW
Please visit GitHub for instruction regarding the installation of singularity and indexing reference genome.
The page also provides SAW shell script examples for users.
Please Note! Please build your reference before running SAW analysis.

1. STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

5

1.6. SAW Test Data
SAW test data can be downloaded from SAW GitHub page. Key outputs are shown in Chapter 3 Test Data
Demonstration. The reference genome version for SAW testing is:
•

genome-build: GRCm38.p6

•

genome-version: GRCm38

•

genome-date: 2012-01

•

genome-build-accession: NCBI:GCA_000001635.8

1.7. SAW Output File Format
Please check Stereo-seq File Format Manual to get more information on SAW output files format.

1. STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE

STOMICS ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

CHAPTER 2
SAW PIPELINES &
ARGUMENTS

7

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.1 splitMask
splitMask is designed for splitting Stereo-seq Chip T mask file according to the SE FASTQ CID. The split
count is directly related to the number of split FASTQs while writing FASTQ out from sequencer.
Running splitMask requires the following files:
•

Stereo-seq Chip T mask file (.h5)
Expected running time for 1 cm x 1 cm chip: ~5 min, Memory: ~3G
As input sequencing data, both Q40 FASTQ and Q4 FASTQ from Stereo-seq, which store the original
sequencing data, are supported in SAW pipelines. Differences between them are mainly reflected in
file size and how data and information are written in.
Q40 FASTQ, also called PE FASTQ, has a pair of read files, read 1 and read 2. Q4 FASTQ, also called SE
FASTQ, is an output format with only one file, but saves file storage space.
More details in Stereo-seq File Format Manual.

An example of Q4 FASTQ file path usually displayed as below:

2.1.1 Arguments and Options
Table 2-1 splitMask Arguments and Options

Parameter index

Function

[1]

(Required) Stereo-seq Chip T mask file path (.h5).

[2]

(Required) Output directory stores split mask files.

[3]

(Required) Set the number of threads to be used.

[4]

(Optional) Split count. This count number needs to be set the same as Q4 FASTQ count.
The options are the powers of 4, and the commonly used options are 16 and 64. If a
library contains two barcodes sequenced in the same lane and the two barcodes were
split when written out FASTQs, then the split count is 16; otherwise, if the barcodes
were not split, then 64.

[5]

(Optional) CID position, commonly used option is “2_25”.
splitMask uses 24 bases (out of 25, 25 is the read length of CID) to split Stereoseq Chip T mask file. This CID position parameter is a string that combines two index
numbers with “_”. The two numbers indicate the start and the end base index in the
CID, and the bases in this range are used for splitting. For example, “2_25” means
starting from the 2nd base to the 25th base used for splitting mask file.

2. SAW PIPELINES & ARGUMENTS

8

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.1.2 Usage Example
Please Note! Replace {SN} with your Stereo-seq Chip T serial number (SN, e.g. SS200000135TL_D1
or A00135D1)
$ mkdir /path/to/output/00.splitmask
$ singularity exec SAW_v7.0.sif splitMask \
/path/to/data/{SN}.barcodeToPos.h5 \ ## Mask path
/path/to/output/00.splitmask \ ## output directory
8 \ ## threads
16 \ ## split count
2_25 ## CID position

2.1.3 Outputs
The output files of splitMask are organized as below. The indices of the output files are corresponding to
the split list index of the Q4 FASTQ files.
$ tree /path/to/output/00.splitmask
/path/to/output/00.splitmask
|-- 01.SN.barcodeToPos.bin
|-- 02.SN.barcodeToPos.bin
|-- 03.SN.barcodeToPos.bin
|-- 04.SN.barcodeToPos.bin
|-- 05.SN.barcodeToPos.bin
|-- 06.SN.barcodeToPos.bin
|-- 07.SN.barcodeToPos.bin
|-- 08.SN.barcodeToPos.bin
|-- 09.SN.barcodeToPos.bin
|-- 10.SN.barcodeToPos.bin
|-- 11.SN.barcodeToPos.bin
|-- 12.SN.barcodeToPos.bin
|-- 13.SN.barcodeToPos.bin
|-- 14.SN.barcodeToPos.bin
|-- 15.SN.barcodeToPos.bin
`-- 16.SN.barcodeToPos.bin
0 directories, 16 files

2.2 CIDCount
CIDCount is a program for computing the number of CIDs in the Stereo-seq Chip T mask file and roughly
estimating memory used in mapping.
Running CIDCount requires the following files:
•

Stereo-seq Chip T mask file (.h5)
Expected running time for 1 cm x 1 cm chip: ~30 s, Memory: ~0.7G
2. SAW PIPELINES & ARGUMENTS

9

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.2.1 Arguments and Options
Table 2-2 CIDCount Arguments and Options

Parameter

Function

-i

(Required) Stereo-seq Chip T mask file path (.h5 or .bin).

-s

(Optional) A string of species name.

-g

(Required) Genome file size in GB.

2.2.2 Usage Example
For Q40 FASTQ input cases, run CIDCount as below:
$ singularity exec SAW_v7.0.sif CIDCount \
-i /path/to/data/{SN}.barcodeToPos.h5 \ ## Stereo-seq Chip T mask file path
-s {speciesName} \ ## species name
-g {genomeSize} ## genome file size in GB, can be acquired by “ls -l

--block-size=GB ${Genome file of the species after STAR indexing}”

For Q4 FASTQ input cases that require to run splitMask first, users may run CIDCount only once because
the results for each individual small mask are close to each other. For chip size larger than 1 cm x 1 cm, we
would recommend to run CIDCount for each CID class/small mask.
Please Note! {index} needs to be replaced by the real index number of the split mask file.
$ singularity exec SAW_v7.0.sif CIDCount \
-i /path/to/output/00.splitmask/{index}.{SN}.barcodeToPos.bin \

reo-seq Chip T mask file path
-s {speciesName} \

## Ste-

## species name

## genome file size in GB, can be acquired by “ls -l
--block-size=GB ${Genome file of the species after STAR indexing}”
-g {genomeSize}

2.2.3 Outputs
The output of CIDCount is shown as below,
$ singularity exec SAW_v7.0.sif CIDCount -i SN.barcodeToPos.h5 -s mouse -g 3
645784920 ## CID count
62 ## estimated memory for mapping

2. SAW PIPELINES & ARGUMENTS

10

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.3 mapping
Each Stereo-seq sequenced read contains a CID sequence which is used as a key to spatially map the read
back to its original location on the tissue section. mapping pipeline matches CID of the original sequencing
reads stored in the FASTQ file with the records of CID-coordinates key-value pairs saved in the Stereo-seq
Chip T mask file (allow 1 mismatch). Coordinate information for reads that CID could be paired with, based
on the records of the mask file, will be added. Coordinate information for reads that CID could be paired
with will be added based on the records of the mask file. Reads that get the coordinate annotations are Valid
CID mRNA Reads (Valid CID Reads). After discarding reads with unqualified MID reads which do not satisfy
further analysis, filtering reads with adapter, and filtering short reads (read length less than 30 after trimming
consecutive A bases), the filtered Valid CID Reads are the Clean Reads. mapping pipeline maps Clean Reads
to the reference genome, and output sorted BAM7 format alignments and summary report.
If concerned about rRNA count and filtration, necessary modification to the reference genome should be
completed beforehand, mainly including 2 steps: 1) add rRNA information into the FASTA file, with the suffix
'_rRNA' on the chromosome column, like '1_rRNA', to distinguish them from original reference; 2) build index
using modified reference genome.
Running mapping requires the following files:
•

Stereo-seq sequenced reads FASTQ files (.fq.gz)

•

Stereo-seq Chip T mask file (.h5)

•

Indexed reference genome

•

bcPara file (.bcPara), please check the content of Table 2-4
Expected running time for ~1G reads: ~4 h, Memory: ~67G
Notice to rebuild reference index, with the same command input as before. From SAW V6.1 onwards, SAW reconstructed the construction of reference index and mapping algorithms for more
efficient computational performance and reduced time cost.

2.3.1 Arguments and Options
As mapping encapsulate STAR8 function, it accepts additional options beyond those shown in the table below.
Table 2-3 mapping Arguments and Options

Parameter

Function

--outSAMattributes
spatial

Set to turn on spatial BAM file format mode.

--outSAMtype BAM
SortedByCoordinate

(STAR option) Set output BAM file sorted by coordinate.

--genomeDir

(STAR option) Path to the directory where the genome indices are stored.

--runThreadN

(STAR option; defaults to 1) Set the number of threads to be used. Usually set to 8 or
higher.

--outFileNamePrefix

(STAR option) Custom output file prefix.

--sysShell /bin/bash

(STAR option) Path to the shell binary.

--stParaFile

(Required) Create a parameter file that defines CID mapping options. Options are
specified in Table 2-4.

--readNameSeparator \" (STAR option) Character(s) separating the part of the read names that will be trimmed
\"
in output.
2. SAW PIPELINES & ARGUMENTS

11

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Parameter

Function

--limitBAMsortRAM

(STAR option) Maximum available RAM (bytes) for sorting BAM.

--limitOutSJcollapsed

(STAR option) Max number of collapsed junctions.

--limitIObufferSize

(STAR option) Max available buffers size (bytes) for input/output, per thread.

--outSAMmultNmax

(STAR option; defaults to -1) Max number of alignments that will be written in output
BAM file for a read. Recommend setting to 1 to reduce disk space storage.

Table 2-4 mapping --stParaFile Arguments and Options

Parameter

Function

in

(Required) Path to the Stereo-seq Chip T mask file (PE) or split mask file (SE).

in1

(Required) Path to the FASTQ file. For Q40 sequences specify the path to the FASTQ
file of read1 here. For Q4 sequences, input FASTQ file with the same split index as the
mask file. A more elegant way to input a long list of Q4 FASTQs is to organize them in
a FQ_{index}.list file. Please check 2.3.2 Usage Example Q4 scenario 2 to get
more information.

in2

(Optional) Path to the FASTQ file of read2. Only valid for Q40 sequencing.

barcodeReadsCount

(Required) Mapped CID list file with read counts for each CID. This is an output file in
mapping

barcodeStart

(Required; defaults to 0) CID start position. Set to 0.

barcodeLen

(Required; defaults to 25) CID length. Set to 25 for Q40, 24 for Q4.

umiStart

(Required; defaults to 25) MID start position.

umiLen

(Required; defaults to 10) MID length.

mismatch

(Required; defaults to 0) Max mismatch tolerant. Usually set to 1 in mapping.

bcNum

(Required) CID count in mask. Please check 2.2 CIDCount for more information.

polyAnum

(Optional) Number of consecutive A in the read that will be trimmed. Recommend to
set this value to 15.

mismatchInPolyA

(Optional) Number of mismatch bases in searching poly A. Recommend to set this
value to 2

rRNAremove

(Optional; default to disable) Remove rRNA reads. Note that the precondition of the
switch is the reference genome combined with rRNA information. If not, this filtering
function will not work anyway. Using the reference genome with the addition of rRNA,
reads related to rRNA are not filtered by default, namely the switch is off. And the
number and the ratio of rRNA reads in the statistical output file are both 0. When the
switch is on, as long as the query reads are mapped to rRNA reference, they will be
removed. rRNA count and ratio are recorded in the output file.

validCidFq

(Optional; default to disable) Output Valid CID Reads in FASTQ format after CID mapping. Similar to Q4 FASTQ format but with different first row of each read, for instance,
"@V350044321L1C001R0020993658|Cx:i:10413|Cy:i:7737 D3450E0D391E EC7FF",
where Cx and Cy represent the decoded coordinates and are added after readID.

outUnMappedFq

(Optional; default to disable) Output un-mapped reads in FASTQ format after mapping Clean Reads to the reference genome. Similar to Q4 FASTQ format but with
different first row of each read, for instance, "@V350044321L1C001R0020993658|Cx:i:10413|Cy:i:7737 D3450E0D391E EC7FF", where Cx and Cy represent the decoded
coordinates and are added after readID.

bcMappingRateCutoff

(Optional; default to disable) Set the minimum CID mapping rate, like
'bcMappingRateCutoff=0.1' . If the actual CID mapping rate less than this ratio,
abort mapping.
2. SAW PIPELINES & ARGUMENTS

12

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.3.2 Usage Example
Two scenarios for preparing mapping --stParaFile input file {lane}.bcPara with Q40 FASTQ input:
Please Note! Replace {SN} with your Stereo-seq Chip T serial number (SN, e.g. SS200000135TL_D1
or A00135D1), and {lane} with the FASTQ lane name prefix (e.g. E100026571_L01)
The same applies to all examples.

## input FASTQType, inputDirectory, outputDirectory one by one, separated by space, get a
Q40 scenario 1: Prepare {lane}.bcPara file for Q40 one pair FASTQ as mapping input:
$ mkdir /path/to/output/01.mapping
$ vim /path/to/output/01.mapping/{lane}.bcPara
in=/path/to/data/{SN}.barcodeToPos.h5
in1=/path/to/data/{lane}_read_1.fq.gz
in2=/path/to/data/{lane}_read_2.fq.gz
barcodeReadsCount=/path/to/ouptut/01.mapping/{lane}.barcodeReadsCount.txt
barcodeStart=0
barcodeLen=25
umiStart=25
umiLen=10
mismatch=1
bcNum=645784920 ## Input the first line from output of CIDCount
polyAnum=15
mismatchInPolyA=2

Q40 scenario 2: Prepare {lane}.bcPara file for Q40 multiple pair of FASTQ as mapping input:
$ mkdir /path/to/multi_lane_output/01.mapping
$ vim /path/to/multi_lane_output/01.mapping/{lane}.bcPara
in=/path/to/data/{SN}.barcodeToPos.h5
in1=/path/to/data/{lane}_read_1.fq.gz
in2=/path/to/data/{lane}_read_2.fq.gz
barcodeReadsCount=/path/to/multi_lane_output/01.mapping/{lane}.barcodeReadsCount.
txt
barcodeStart=0
barcodeLen=25
umiStart=25
umiLen=10
mismatch=1
bcNum=645784920 ## Input the first line from output of CIDCount
polyAnum=15
mismatchInPolyA=2

2. SAW PIPELINES & ARGUMENTS

13

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Run mapping for Q40 input:
$ singularity exec SAW_v7.0.sif mapping \
--outSAMattributes spatial \
--outSAMtype BAM SortedByCoordinate \
--genomeDir /path/to/genomeDir \
--runThreadN 8 \
--outFileNamePrefix /path/to/output/01.mapping/{lane}. \
--sysShell /bin/bash \
--stParaFile /path/to/output/01.mapping/{lane}.bcPara \
--readNameSeparator \" \" \
--limitBAMsortRAM 38582880124 \
--limitOutSJcollapsed 10000000 \
--limitIObufferSize=280000000 \
--outBAMsortingBinsN 50 \
> /path/to/output/01.mapping/{lane}.run.log

Two scenarios for preparing mapping --stParaFile input file {index}.bcPara with Q4 FASTQ input:
Q4 scenario 1: Prepare {index}.bcPara file for Q4 FASTQ that contains one barcode in library or did not
split barcode when writing FASTQ:
Please Note! {index} need to be replaced by the index of the split mask file which is corresponding
to the index of the Q4 FASTQ file.
$ mkdir /path/to/output/01.mapping
$ vim /path/to/output/01.mapping/{index}.bcPara
in=/path/to/output/00.splitmask/{index}.{SN}.barcodeToPos.bin ## split mask file
in1=/path/to/data/{lane}_{index}.fq.gz ## {index} th FASTQ file in {lane}
barcodeReadsCount=/path/to/ouptut/01.mapping/{index}.barcodeReadsCount.txt
barcodeStart=0
barcodeLen=24
umiStart=25
umiLen=10
mismatch=1
bcNum=38284877 ## Input the first line from output of CIDCount
polyAnum=15
mismatchInPolyA=2

2. SAW PIPELINES & ARGUMENTS

14

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Q4 scenario 2: Prepare {idx}.bcPara file for Q4 FASTQ that has multiple barcodes in the library and split
when writing FASTQ:
Please Note! {index} needs to be replaced by the real index number of the split mask file and
{idx} needs to be replaced by the index number of the input FASTQ file. For example, {index}
and {idx} of the first barcode group are "01-16" and "01-16", {index} and {idx} of the
second barcode group are "01-16" and "17-32".

$ mkdir /path/to/output/01.mapping
$ vim /path/to/output/01.mapping/{idx}.bcPara
in=/path/to/output/00.splitmask/{index}.{SN}.barcodeToPos.bin ## split mask file
in1=/path/to/data/{lane}_{index}.fq.gz ## {index} th FASTQ file in {lane}. FASTQ

files for different barcode usually stores in different directory, so /path/to/
data/ might change to /path/to/data/{barcode_n}
barcodeReadsCount=/path/to/ouptut/01.mapping/{idx}.barcodeReadsCount.txt
barcodeStart=0
barcodeLen=24
umiStart=25
umiLen=10
mismatch=1
bcNum=38284877 ## Input the first line from output of CIDCount
polyAnum=15
mismatchInPolyA=2

In case there are too many FASTQ files that need to be processed, an easier way is to organize them into a FQ_
{index}.list file. The requirement for preparing a FQ_{index}.list file is to gather all the FASTQs
with the same index as the split mask together, since these files are all split by the same logic.

Get the list input conveniently like:
$ sh Get_FASTQ_list.sh <FASTQDirList> <outdir> <SN>
FASTQDirList = <Q4 FASTQ directory list which record directory paths line byline>
outDir = <directory to output FQ.list files>
SN = <Stereo-seq chip serial number>

https://github.com/STOmics/SAW/blob/main/Scripts/Get_FASTQ_list.sh
An example to display FQ.list file :
$ cat SN_Q4_fastq_16.list

is 16

## a FASTQ list file gathers all the FASTQs whose index

/path/to/data/lane_1_16.fq.gz
/path/to/data/lane_2_16.fq.gz
2. SAW PIPELINES & ARGUMENTS

15

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Then input the path of FQ_{index}.list file for in1 parameter in the {index}.bcPara file. The
{index}of FQ_{index}.list and the {index} of split mask file have to be the same.
$ mkdir /path/to/output/01.mapping
$ vim /path/to/output/01.mapping/{index}.bcPara
in=/path/to/output/00.splitmask/{index}.{SN}.barcodeToPos.bin ## split mask file
in1=/path/to/output/{SN}_Q4_fastq_{index}.list
barcodeReadsCount=/path/to/output/01.mapping/{index}.barcodeReadsCount.txt
barcodeStart=0
barcodeLen=24
umiStart=25
umiLen=10
mismatch=1
bcNum=38284877 ## Input the first line from output of CIDCount
polyAnum=15
mismatchInPolyA=2

Run mapping pipeline
$ singularity exec SAW_v7.0.sif mapping \
--outSAMattributes spatial \
--outSAMtype BAM SortedByCoordinate \
--genomeDir /path/to/genomeDir \
--runThreadN 8 \
--outFileNamePrefix /path/to/output/01.mapping/{index}. \

## {in-

--sysShell /bin/bash \
--stParaFile /path/to/output/01.mapping/{index}.bcPara \

## {in-

dex} or {idx} depending on the scenario
dex} or {idx} depending on the scenario

--readNameSeparator \” \” \
--limitBAMsortRAM 38582880124 \
--limitOutSJcollapsed 10000000 \
--limitIObufferSize=280000000 \
--outBAMsortingBinsN 50 \
> /path/to/output/01.mapping/{index}.run.log

depending on the scenario

## {index} or {idx}

2. SAW PIPELINES & ARGUMENTS

16

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.3.3 Outputs
Q40 scenario 1 output files are organized as below:
$ tree /path/to/output/01.mapping/
/path/to/output/01.mapping/
├── lane.Aligned.sortedByCoord.out.bam
├── lane.barcodeReadsCount.txt
├── lane.bcPara
├── lane.CIDMap.stat
├── lane.Log.final.out
├── lane.Log.out
├── lane.Log.progress.out
├── lane.run.log
└── lane.SJ.out.tab

Q40 scenario 2 output files are organized as below (Here shows an example of 2 pairs of FASTQ):
If one sample has multiple FASTQ files, you need to run mapping for each FASTQ pair.
$ tree /path/to/multi_lane_output/01.mapping
/path/to/multi_lane_output/01.mapping
├── lane1.Aligned.sortedByCoord.out.bam
├── lane1.barcodeReadsCount.txt
├── lane1.bcPara
├── lane1.CIDMap.stat
├── lane1.Log.final.out
├── lane1.Log.out
├── lane1.Log.progress.out
├── lane1.run.log
├── lane1.SJ.out.tab
├── lane2.Aligned.sortedByCoord.out.bam
├── lane2.barcodeReadsCount.txt
├── lane2.bcPara
├── lane2.CIDMap.stat
├── lane2.Log.final.out
├── lane2.Log.out
├── lane2.Log.progress.out
├── lane2.run.log
└── lane2.SJ.out.tab

2. SAW PIPELINES & ARGUMENTS

17

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Q4 scenario 1 (one barcode in library or did not split barcode when writing FASTQ) output files are organized
as below:
$ tree /path/to/output/01.mapping
/path/to/output/01.mapping
├── 01.Aligned.sortedByCoord.out.bam
├── 01.barcodeReadsCount.txt
├── 01.bcPara
├── 01.CIDMap.stat
├── 01.Log.final.out
├── 01.Log.out
├── 01.Log.progress.out
├── 01.run.log
├── 01.SJ.out.tab
...
├── 16.Aligned.sortedByCoord.out.bam
├── 16.barcodeReadsCount.txt
├── 16.bcPara
├── 16.CIDMap.stat
├── 16.Log.final.out
├── 16.Log.out
├── 16.Log.progress.out
├── 16.run.log
└── 16.SJ.out.tab

Q4 scenario 2 (multiple barcodes in the library and split when writing FASTQ) output files are organized as
below (Here shows an example of 2 barcodes):
$ tree /path/to/output/01.mapping
/path/to/output/01.mapping
/path/to/output/01.mapping
├── 01.Aligned.sortedByCoord.out.bam
├── 01.barcodeReadsCount.txt
├── 01.bcPara
├── 01.CIDMap.stat
├── 01.Log.final.out
├── 01.Log.out
├── 01.Log.progress.out
├── 01.run.log
├── 01.SJ.out.tab
...
├── 128.Aligned.sortedByCoord.out.bam
├── 128.barcodeReadsCount.txt
├── 128.bcPara
├── 128.CIDMap.stat
├── 128.Log.final.out
├── 128.Log.out
├── 128.Log.progress.out
├── 128.run.log
└── 128.SJ.out.tab

2. SAW PIPELINES & ARGUMENTS

18

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.4 merge (optional)
SAW merge pipeline is used to combine the results of mapping.
Running merge requires the following file:
·

mapping output mapped CID list files (.txt)
Expected running time for ~1G reads 2 lanes: ~5 min, Memory: ~5G

2.4.1 Arguments and Options
Table 2-5 merge Arguments and Options

Parameter

Function

[1]

(Required) Path to the Stereo-seq Chip T mask file.

[2]

(Required) Mapped CID list files with read counts for each CID.

[3]

(Required) Mapped CID list file which merges all input files.

2.4.2 Usage Example
$ mkdir /path/to/multi_lane_output/02.merge
$ singularity exec SAW_v7.0.sif merge \
/path/to/data/{SN}.barcodeToPos.h5 \
/path/to/multi_lane_output/01.mapping/{lane1}.barcodeReadsCount.txt,/path/to/
* multi_lane_output/01.mapping/{lane2}.barcodeReadsCount.txt \ ## change {lane} to
{index} or {idx} for Q4 and change /path/to/multi_lane_output/ to /path/to/output/
for SE single lane scenario
/path/to/multi_lane_output/02.merge/{SN}.barcodeReadsCount.txt
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

2.4.3 Ouputs
The output file of merge has been organized as below:
$ tree /path/to/multi_lane_output/02.merge
/path/to/multi_lane_output/02.merge
└── {SN}.merge.barcodeReadsCount.txt

2. SAW PIPELINES & ARGUMENTS

19

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.5 count
SAW count is an efficient general-purpose read annotation pipeline that label reads with their overlapped
genomic features and outputs statistical information for the overall summarization result. Through
quantification of annotated reads, count generates spatial gene expression data after de-duplicating reads
according to CID, gene ID, and MID information. Usually, SAW count is run on the Uniquely Mapped Reads
filtered from mapping output based on the reference genome annotation records. Starting from SAW v5.1.3,
count allows the utilization of some Multi-Mapped Reads in quantification (--multi_map). The gene
expression level in SAW pipeline is the summation of both intron and exon MID count. To support downstream
analysis that might be required of different genomic features, count also outputs exon MID count separately.
Running count requires the following files:
•

mapping output BAM file (.bam)

•

Reference genome annotation GFF/GTF9,10 file (.gff / .gtf)
Expected running time for ~1G reads: 0.5 h, Memory: ~45 G

2.5.1 Arguments and Options
Table 2-6 count Arguments and Options

Parameter

Function

-i

(Required) mapping output BAM file. Separate multiple files by comma.

-o

(Required) Set the count output BAM file name.

-a

(Required) Gene annotation GFF/GTF file.

-s

(Required) Set the count output statistical summary report file name.

-e

(Required) Set the count output gene expression file name.

--umi_len

(Required; defaults to 10) MID length.

--sn

(Required) Stereo-seq Chip T serial number (SN).

-c

(Optional; defaults to detected) CPU core number to use. Minimum value is 8,
recommended value is 24.

--save_lq

(Optional; defaults to false) Save low-quality reads if set.

--save_dup

(Optional; defaults to false) Save duplicate reads if set.

--umi_on

(Optional; defaults to false) Correct MID if set.

--sat_file

(Optional; defaults to None) Set the saturation sampling file name which is prepared for
sequencing saturation (requires --umi_on).

--multi_map

(Optional; defaults to disable) Set to enable multi-mapped reads correction. This
correction consists of two logics. 1) The first logic is the correction of multi-gene reads
which is a read mapped uniquely to a genomic region where multiple genes overlap.
In this scenario, the read has to overlap with a genomic locus greater than 50% of its
read length. If the genomic feature (exon, intron, or intergenic) of all the mapped genes
includes exon and intron, then select the alignment record mapped to exon in preference
to intron. If more than one gene locus belongs to the same genomic feature type, then
pick the one that has the longest overlap. Otherwise, label the read to “intergenic.” 2) The
second logic is to select and correct one of the multi-mapped reads and add the count
to gene expression matrix. The first step is to group reads by QNAME. Select reads in the
group mapped to exon in preference to those mapped to intron. Then correct the longest
overlapped reads (at least overlapped greater than 50% of its read length) in the group to
unique read and correct its MAPQ to 255. Set the MAPQ of the remaining reads to 0.

2. SAW PIPELINES & ARGUMENTS

20

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.5.2 Usage Example
$ mkdir -p /path/to/output/03.count
$ geneExp=/path/to/output/03.count/{SN}.raw.gef
$ saturationSamplingFile=/path/to/output/03.count/{SN}_raw_barcode_gene_exp.txt
$ singularity exec SAW_v6.1.sif count \
-i /path/to/output/01.mapping/{lane}.Aligned.sortedByCoord.out.bam \
-o /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
* target.bam \
-a /path/to/reference/genes.gtf \
-s /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
* target.bam.summary.stat \
-e ${geneExp} \
--umi_len 10 \
--sat_file ${saturationSamplingFile} \
--sn {SN} \
--umi_on \
--save_lq \
--save_dup \
-c 24
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

For more than one pair of FASTQ files (Here shows an example of 2 pairs of FASTQ):
## change /path/to/multi_lane_output/ to /path/to/output/ for SE single lane scenario

$ mkdir -p /path/to/multi_lane_output/03.count

$ geneExp=/path/to/multi_lane_output/03.count/{SN}.raw.gef
$ saturationSamplingFile=/path/to/multi_lane_output/03.count/{SN}_raw_barcode_gene_
exp.txt
$ singularity exec SAW_v7.0.sif count \
-i /path/to/multi_lane_output/01.mapping/{lane1}.Aligned.sortedByCoord.out.
*
bam,/path/to/ multi_lane_output/01.mapping/{lane2}.Aligned.sortedByCoord.out.bam \

## change {lane} to {index} or {idx} for SE

-o /path/to/multi_lane_output/03.count/{SN}.Aligned.sortedByCoord.out.

* merge.q10.dedup.target.bam \

-a /path/to/reference/genes.gtf \
-s /path/to/multi_lane_output/03.count/{SN}.Aligned.sortedByCoord.out.
* merge.q10.dedup.target.bam.summary.stat \
-e ${geneExp} \
--umi_len 10 \
--sat_file ${saturationSamplingFile} \
--sn {SN} \
--umi_on \
--save_lq \
--save_dup \
-c 24
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

2. SAW PIPELINES & ARGUMENTS

21

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

For dealing with multi-mapped reads:
$ singularity exec SAW_v7.0.sif count \
-i /path/to/output/01.mapping/{lane}.Aligned.sortedByCoord.out.bam \
-o /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
target.bam \
-a /path/to/reference/genes.gtf \
-s /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
target.
bam.summary.stat \
-e ${geneExp} \
--umi_len 10 \
--sat_file ${saturationSamplingFile} \
--sn {SN} \
--umi_on \
--save_lq \
--save_dup \
-c 24 \
--multi_map

2.5.3 Ouputs
The count output files are organized as below:
$ tree /path/to/output/03.count
/path/to/output/03.count
├── SN.Aligned.sortedByCoord.out.merge.q10.dedup.target.bam
├── SN.Aligned.sortedByCoord.out.merge.q10.dedup.target.bam.csi
├── SN.Aligned.sortedByCoord.out.merge.q10.dedup.target.bam.summary.stat
├── SN_raw_barcode_gene_exp.txt
└── SN.raw.gef

When you run mapping using reference genome with rRNA information and the switch of
rRNAremove is on, PASS FILTER item in*.bam.summary.stat file will not contain the
number of the reads mapped to rRNA reference.

2. SAW PIPELINES & ARGUMENTS

22

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.6 register
SAW register pipeline aligns the microscopic tissue staining images with the plot of gene expression matrix
generated by count based on the track lines on the chip while establishing the mapping relationship between
images and spatial gene expression distribution. Staining images include:
• DAPI/ssDNA image for cell nucleus;
• IF (immunofluorescence) image for protein.
• H&E (hematoxylin and eosin) image for cell nuclei, extracellular matrix and cytoplasm.
SAW register includes four main modules, stitching, tissue segmentation, cell segmentation, and
registration. Stitching combines microscopic images with overlapping sections to create a panoramic image
(skip stitching if the input image is already a panoramic image). Tissue and cell segmentation modules
detect and mask out tissue and cell coverage region, respectively. Registration module aligns the stitched
image and the expression matrix, and at the same time registered masks from segmentation modules with
the gene expression matrix using the same parameters. When it comes to the scenario of DAPI and mIF
(multiple immunofluorescence images), this module outputs the registered DAPI and mIF image files. Tissue
segmentation of IF image adopts the method of threshold segmentation, while cell segmentation of it is the
intersection result of IF tissue segmentation, DAPI tissue segmentation and DAPI cell segmentation.
In addition, stitching and segmentation modules can be run separately with registration.
QC-failed data which is manually processed are supported currently. The tissue or cell segmentation
image will adopt the manually processed results from ImageStudio (Both QC failure and success are
accepted). More to the manual tutorial on GitHub.
Running register requires the following files:
•

count output gene expression matrix file (.raw.gef)

•

The microscopic tissue staining image file (.tar.gz) processed by ImageStudio. register is compatible
with QC outputs from ImageStudio v3.

•

ImageStudio Image process record file (.ipr)
Expected running time for 1 cm x 1 cm Stereo-seq Chip T image: ~7.5 h, Memory: ~20 G
Cell segmentation is the most time-consuming part. You may use -w False to skip cell
segmentation, but still perform stitching, tissue segmentation and registration.
.

2.6.1 Arguments and Options
Table 2-7 register Arguments and Options

Parameter

Function

-i

(Required) ImageQC/ImageStudio processed staining image TAR.GZ file or image preprocessed output directory.

-c

(Required) ImageQC/ImageStudio IPR (image process record) file. IPR is designed to
efficiently hold images and process records generated from each image processing step
along with metadata in various data types. Please check Stereo-seq File Format Manual to
get more information on the IPR file.

-v

(Optional. Depends on -i) count output gene expression matrix GEF file.

-o

(Required) Path to the directory where to store the register outputs.
2. SAW PIPELINES & ARGUMENTS

23

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Parameter

Function

-w

(Required, bool) Whether to do cell segmentation.

-P

(Optional, str=None) Customized IF thresholds and separated by comma and correspond
to -g, e.g "-p 70,70".

-g

(Optional, str=None) IF group names and separated by comma, e.g "-g 355_ID,648_IF".

--gpu

(Optional, str=-1) Set GPU ID. eg: "--gpu 0". Default using CPU by "--gpu -1".

--core

(Optional, int=os.cpu_count()) Set CPU core number.

Preparation of GPU Usage:
pip install onnxruntime-gpu==1.15.1
.
export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
NVIDIA CUDA installation guide on Linux: https://docs.nvidia.com/cuda/cuda-installation-guide-linux/

2.6.2 Usage Example
Scenario 1: Process images from ImageQC/ImageStudio output data and gene expression matrix. Perform
stitching, tissue segmentation, cell segmentation, and registration with gene expression matrix.
$ image=/path/to/data/image
$ image4register=$(find ${image} -maxdepth 1 -name {SN}*.tar.gz | head -1)
$ imageQC=$(find ${image} -maxdepth 1 -name {SN}*.ipr | head -1)
$ mkdir -p /path/to/output/04.register
$ singularity exec SAW_v7.0.sif register \
-i ${image4register} \
-c ${imageQC} \
-v /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/04.register
-w True ## do cell segmentation

Scenario 2: Process images from ImageQC/ImageStudio output data. Perform stitching, tissue segmentation,
and cell segmentation without doing registration with the gene expression matrix.
$ image=/path/to/data/image
$ image4register=$(find ${image} -maxdepth 1 -name {SN}*.tar.gz | head -1)
$ imageQC=$(find ${image} -maxdepth 1 -name {SN}*.ipr | head -1)

$ mkdir -p /path/to/output/04.register
$ singularity exec SAW_v7.0.sif register \
-i ${image4register} \
-c ${imageQC} \
-o /path/to/output/04.register
-w True ## do cell segmentation

2. SAW PIPELINES & ARGUMENTS

24

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Scenario 3: Process images from scenario 2. register processed images with gene expression matrix.
$ imageQC=$(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head -1)

$ mkdir -p /path/to/output/04.register
$ singularity exec SAW_v7.0.sif register \
-i /path/to/output/04.register \ ## -i input scenario 2 output directory
-c ${imageQC} \ ## scenario 2 output IPR
-v /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/04.register
-w False ## cell segmentation has been done in Scenario 2

2.6.3 Outputs
registeroutput files of scenario 1 and scenario 3 (if -i and -o are identical) are organized as below:
$ tree /path/to/output/04.register
/path/to/output/04.register
... ## skip setting files, logs and image folder
├── <stainType>_fov_stitched_transformed.tif
└── SN_<chipType>_date_time_version.ipr
register output files of scenario 2:
$ tree /path/to/output/04.register
/path/to/output/04.register
... ## skip setting files, logs and image folder
├── <stainType>_fov_stitched_transformed.tif
└── SN_<chipType>_date_time_version.ipr
register output files of scenario 3 if -i and -o are two different paths:
$ tree /path/to/output/04.register
/path/to/output/04.register
... ## skip logs
└── SN_<chipType>_date_time_version.ipr

2.7 imageTools
SAW imageTools is a handy toolkit designed to play with image data in SAW. imageTools ipr2img
(or ipr2img, available from SAW ST >= v5.0.0) is required in SAW core pipeline “decode” images from the
processed IPR file. SAW imageTools ipr2img outputs TIFF images from IPR such as pre-registered ssDNA
stitched image, tissue segmentation and cell segmentation mask TIFFs, as well as registered three types of
images.

2. SAW PIPELINES & ARGUMENTS

25

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Running imageTools ipr2img requires the following files:
•

ImageQC/ImageStudio processed microscopic tissue staining image file (.tar.gz)

•

register processed Image process record file (.ipr, compatible with v0.0.1 and v0.1.0)
Expected running time for 1 cm x 1 cm Stereo-seq Chip T image: ~5 min, Memory: ~10 G

2.7.1 Arguments and Options
Table 2-8 imageTools ipr2img Arguments and Options

Command

ipr2img

Parameter

Function

-i

(Required) ImageQC/ImageStudio processed staining image TAR.GZ file.

-c

(Required) IPR (image process record) file. IPR is designed to efficiently hold image
information generated from each processing step and datasets in various compound
types along with metadata. Please check Stereo-seq File Format Manual to get
more information on IPR file.

-d

(Required) Segmentation module names. Convert segmentation mask TIFF from IPR
for the selected modules. Valid options: tissue and cell. Separate modules by
space.

-r

(Required; default to True) Whether output registered images or pre-registered
images. “Pre-registered” state stands for the images that have been stitched to
a single panoramic image and transformed to have the same scale with the gene
expression matrix, but still need to be flipped, 90°rotated, or translated. The options
are True for output registered images and False for output pre-registered images.

-o

(Required) Path to the directory where to store the ipr2img outputs.

Please check 2.14.4 Other applications of imageTools to learn more about imageTools.

2.7.2 Usage Example
$ image=/path/to/data/image
$ image4register=$(find ${image} -maxdepth 1 -name {SN}*.tar.gz | head -1)
$ imageIPR=$(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head -1)

## has to be a processed IPR

$ singularity exec SAW_v7.0.sif imageTools ipr2img \
-i ${image4register} \
-c ${imageIPR} \
-d tissue cell \ ## output both tissue and cell segmentation mask TIFF
-r True \
-o /path/to/output/04.register

2. SAW PIPELINES & ARGUMENTS

26

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.7.3 Outputs

imageTools ipr2img output files (if the parent directory path of -c IPR and -o are identical) are

organized as below:

$ tree /path/to/output/04.register
/path/to/output/04.register
... ## skip setting files, logs and image folder
├── <stainType>_fov_stitched_transformed.tif
├── <stainType>_matrix_template.txt
├── <stainType>_SN_mask.tif
├── <stainType>_SN_regist.tif
├── <stainType>_SN_tissue_cut.tif
├── <stainType>_transform_template.txt
├── fov_stitched_transformed.rpi
├── SN.rpi
└── SN_<chipType>_date_time_version.ipr

imageTools ipr2img output files (if the parent directory path of -c IPR and -o are two different paths)

are organized as below:

$ tree /path/to/output/04.register_tmp
/path/to/output/04.register_tmp
... ## skip logs and image folder
├── <stainType>_fov_stitched_transformed.tif
├── <stainType>_matrix_template.txt
├── <stainType>_SN_mask.tif
├── <stainType>_SN_regist.tif
├── <stainType>_SN_tissue_cut.tif
├── <stainType>_transform_template.txt
└── SN.rpi

2.8 tissueCut
SAW tissueCut pipeline can delineate and extract the tissue coverage area based on the aligned image
generated from register and imageTools or from the plot of gene expression matrix (if microscopic
tissue staining images are not available). tissueCut outputs expression data in GEF format.
If the output of tissueCut doesn’t match the morphology of the tissue, users could handle this
issue with the help of ImageStudio, StereoMap or Stereopy11. If the tissueCut was run with
an image, users could manually redo tissue segmentation for the image via ImageStudio and
run register, imageTools and tissueCut again. Otherwise, manually delineate tissue
coverage region from the gene expression distribution plot via StereoMap and then put the result
into the SAW-lasso pipeline (2.15.6 lasso), or do lasso selection and expression matrix extraction
via Stereopy (Stereopy->Tutorials->MatrixExport).
Running tissueCut requires the following files:
•

Mapped CID list file (.txt)

•

count output gene expression matrix file (.raw.gef)

•

imageTools ipr2img output tissue segmentation mask TIFF file (.tif, optional)
Expected running time for ~1G reads: ~6 min, Memory: ~6 G
2. SAW PIPELINES & ARGUMENTS

27

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.8.1 Arguments and Options
Table 2-9 tissueCut Arguments and Options

Parameter

Function

--dnbfile

(Optional) Mapped CID list file with reads counts for each CID. Input merged mapped
CID list file if more than one list file was generated in mapping.

-i

(Required) count output gene expression matrix file.

-o

(Required) Path to the directory where to store the tissueCut outputs.

-s

(Optional) Path to the imageTools ipr2img output tissue segmentation mask
file. Only valid when register has been performed.

--sn

(Required) Stereo-seq Chip T serial number (SN).

--omics,-O

(Required; default to Transcriptomics) String that specifies the omics.

-d

(Required) Set to generate required plots for report.

-t

(Optional) Number of threads used in numpy (recommended to fill 8 here).

-b

(Optional; default to 1,20,50,100,200) Set to specify bin sizes, separated by comma.

-l

(Optional) Set to specify the output label name.

2.8.2 Usage Example
Run tissueCut if register aligned microscopic staining image is provided:
• Generate tissue GEF based on the corresponding tissue mask image.
$ nucleusLayer=$(find /path/to/output/04.register -maxdepth 1 -name *fov_stitched_
transformed.tif -exec sh -c 'for f do basename -- "$f" _fov_stitched_transformed.
tif;done' sh {} + | grep -v IF)
$ tissueMaskFile=$(find /path/to/output/04.register -maxdepth 1 -name ${nucleusLayer}*_tissue_cut.tif
$ mkdir -p /path/to/output/05.tissuecut
$ singularity exec SAW_v7.0.sif tissueCut \
--dnbfile /path/to/output/02.merge/{SN}.merge.barcodeReadsCount.txt \
-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut \
-s ${tissueMaskFile} \
--sn {SN} -O Transcriptomics -d

•

Output GEF with a customized label.

$ label=<labelName> ## customized label name
$ labelMaskFile=$(find /path/to/output/04.register -maxdepth 1 -name *${label}*_tissue_cut.tif)
$ mkdir -p /path/to/output/05.tissuecut/tissuecut_${label}
$ singularity exec SAW_v7.0.sif tissueCut \
--dnbfile /path/to/output/02.merge/{SN}.merge.barcodeReadsCount.txt \
2. SAW PIPELINES & ARGUMENTS

28

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut/tissuecut_${label} \
-s ${labelMaskFile} \
-l ${label}
--sn {SN} -O Transcriptomics -d

Run tissueCut if image is not available:
$ mkdir -p /path/to/output/05.tissuecut
$ singularity exec SAW_v7.0.sif tissueCut \
--dnbfile /path/to/output/02.merge/{SN}.merge.barcodeReadsCount.txt \
-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut \
--sn {SN} -O Transcriptomics -d

2.8.3 Outputs
tissueCut output files:
Image is provided:
• Generate tissue GEF based on the corresponding tissue mask image.
$ tree /path/to/output/05.tissuecut
/path/to/output/05.tissuecut
├── SN.tissue.gef
├── tissuecut.stat
└── tissue_fig
├── scatter_100x100_MID_gene_counts.png
├── scatter_150x150_MID_gene_counts.png
├── scatter_200x200_MID_gene_counts.png
├── scatter_20X20_MID_gene_counts.png
├── scatter_50x50_MID_gene_counts.png
├── statistic_100x100_MID_gene_DNB.png
├── statistic_150x150_MID_gene_DNB.png
├── statistic_200x200_MID_gene_DNB.png
├── statistic_20X20_MID_gene_DNB.png
├── statistic_50x50_MID_gene_DNB.png
├── violin_100x100_MID_gene.png
├── violin_150x150_MID_gene.png
├── violin_200x200_MID_gene.png
├── violin_20X20_MID_gene.png
└── violin_50x50_MID_gene.png

2. SAW PIPELINES & ARGUMENTS

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

•

29

Output GEF with a customized label.

$ tree /path/to/output/05.tissuecut/tissuecut_<label>
/path/to/output/05.tissuecut/tissuecut_<label>
...
├── tissuecut_<label>
│
├── SN.<label>.raw.label.gef
│
├── <label>.tissuecut.stat
│
└── tissue_fig
│
├── scatter_100x100_MID_gene_counts.png
│
├── scatter_150x150_MID_gene_counts.png
│
├── scatter_200x200_MID_gene_counts.png
│
├── scatter_20x20_MID_gene_counts.png
│
├── scatter_50x50_MID_gene_counts.png
│
├── statistic_100x100_MID_gene_DNB.png
│
├── statistic_150x150_MID_gene_DNB.png
│
├── statistic_200x200_MID_gene_DNB.png
│
├── statistic_20x20_MID_gene_DNB.png
│
├── statistic_50x50_MID_gene_DNB.png
│
├── violin_100x100_MID_gene.png
│
├── violin_150x150_MID_gene.png
│
├── violin_200x200_MID_gene.png
│
├── violin_20x20_MID_gene.png
│
└── violin_50x50_MID_gene.png
...

Image is not provided:
$ tree /path/to/output/05.tissuecut
/path/to/output/05.tissuecut
├── 100X100_contour_image.png ## bin100 expression png
├── bin1_img.tif ## bin1 expresion distribution TIFF file
├── bin1_img_tissue_cut.tif ## tissue mask acquried from bin1 expression distribu-

tion plot

├── SN.tissue.gef
├── tissuecut.stat
└── tissue_fig
├── scatter_100x100_MID_gene_counts.png
├── scatter_150x150_MID_gene_counts.png
├── scatter_200x200_MID_gene_counts.png
├── scatter_20X20_MID_gene_counts.png
├── scatter_50x50_MID_gene_counts.png
├── statistic_100x100_MID_gene_DNB.png
├── statistic_150x150_MID_gene_DNB.png
├── statistic_200x200_MID_gene_DNB.png
├── statistic_20X20_MID_gene_DNB.png
├── statistic_50x50_MID_gene_DNB.png
├── violin_100x100_MID_gene.png
├── violin_150x150_MID_gene.png
├── violin_200x200_MID_gene.png
├── violin_20X20_MID_gene.png
└── violin_50x50_MID_gene.png
2. SAW PIPELINES & ARGUMENTS

30

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.9 spatialCluster
SAW spatialCluster pipeline performs clustering analysis for spots using Stereopy. The clustering
procedure includes 4 main steps: 1) preprocess gene expression data from the tissue-coverage region
(normalize, logarithmize, identify highly-variable genes, and scale each gene), 2) reduce the dimensionality of
the data by running PCA, 3) compute the neighborhood graph and embed neighborhood graph using UMAP, 4)
clustering by Leiden algorithm.
Running spatialCluster requires the following files:
tissueCut output GEF file for the tissue-covered region (.tissue.gef)

•

Expected running time for ~1G reads: ~1 min, Memory: ~5 G

2.9.1 Arguments and Options
Table 2-10 spatialCluster Arguments and Options

Parameter

Function

-i

(Required) tissueCut output GEF file for the tissue coverage area.

-o

(Required) Output path for the clustering result in H5AD format.

-s

(Required; default to 50) Bin size.

-r

(Required; default to 1.0) Leiden resolution which controls the coarseness of the
clustering. Higher values lead to more clusters.

2.9.2 Usage Example
$ mkdir -p /path/to/output/06.spatialcluster
$ singularity exec SAW_v7.0.sif spatialCluster \
-i /path/to/output/05.tissuecut/{SN}.tissue.gef \
-r 1.0 \
-s 200 \
-o /path/to/output/06.spatialcluster/{SN}.spatial.cluster.h5ad
## SN is suffixed with bin_size and resolution information

2.9.3 Outputs
spatialCluster output files are:
$ tree /path/to/output/06.spatialcluster
/path/to/output/06.spatialcluster
└── SN.bin200_1.0.spatial.cluster.h5ad

2. SAW PIPELINES & ARGUMENTS

31

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.10 cellCut
SAW cellCut pipeline runs to extract expression matrix of cell nucleus based on the aligned image generated
from register and imageTools. cellCut outputs expression data in cell bin GEF format. Run cellCut
if cell bin results are desired.
Running cellCut requires the following files:
•

count output gene expression matrix file (.raw.gef)

•

register and imageTools output cell segmentation mask TIFF file (.tif)
Expected running time for ~1G reads: ~2 min, Memory: ~10 G

2.10.1 Arguments and Options
Table 2-11 cellCut Arguments and Options

Commands

cgef

Parameters

Function

-i, --input-file

(Required) Input GEF file.

-m, --mask-file

(Required) Input cell segmentation mask file.

-o, --output-file

(Required) Output cell bin GEF file.

-b, --block

(Optional; default to 256,256) Block size.

-r, --rand-celltype

(Optional; default to 0) Number of random cell type.

-t, --threads

(Optional; default to 1) Number of threads.

-v, --verbose

(Optional) Verbose output.

-n, --cnum

(Optional; default to 5000) Top level cell number.

-R, --ratio

(Optional; default to 20) Other level cell number ratio.

-a, --allocat

(Optional; default to 2) Allocation strategy.

-g, --raw-gem

(Optional) Raw GEM file.

-c, --canvas

(Optional; default to 0,0,90000,90000) Set canvas size, minX,minY,maxX maxY.

-l, --limit

(Optional; default to 16,16) Set block limit.

-S, --split

(Optional; default to 0) Split cellID to layers and blocks.

-w, --errorCode-file (Optional; default to false) Set to turn on error code mode.

Please check 2.14.1 Other applications of cellCut to learn more about cellCut.

2. SAW PIPELINES & ARGUMENTS

32

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.10.2 Usage Example
Run cellCut only if register aligned microscopic staining image is provided:
$ mkdir -p /path/to/output/051.cellcut
$ nucleusLayer=$(find /path/to/output/04.register -maxdepth 1 -name *fov_stitched_
transformed.tif -exec sh -c 'for f do basename -- "$f" _fov_stitched_transformed.
tif;done' sh {} + | grep -v IF)
$ nucleusMask=$(find /path/to/output/04.register -maxdepth 1 -name ${nucleusLayer}*_
mask.tif)
$ singularity exec SAW_v7.0.sif cellCut cgef \
-i /path/to/output/03.count/{SN}.raw.gef \
-m ${nucleusMask} \
-o /path/to/output/051.cellcut/{SN}.cellbin.gef

2.10.3 Outputs
cellCut output files:
$ tree /path/to/output/051.cellcut
/path/to/output/051.cellcut
└── SN.cellbin.gef

2.11 cellCorrect
SAW cellCorrect pipeline runs to make adjustments based on the aligned cell segmentation image
generated from register and imageTools and and extract expression matrix of the adjusted one.
cellCorrect outputs expression data in cell bin GEF and GEM formats. Run cellCorrect if results of
cell correction are desired.
Running cellCorrect requires the following files:
•

count output gene expression matrix file (.raw.gef)

•

register and imageTools output cell segmentation mask TIFF file (.tif)
Expected running time for ~1G reads: ~2 min, Memory: ~10 G

2.11.1 Arguments and Options
Table 2-12 cellCluster Arguments and Options

Parameter

Function

-i

(Required) Input GEF file.

-m

(Required) Input cell segmentation mask file.

-d

(Required; default to 10) Outspread distance based on the cellular contour of cell
segmentation image, in pixels.

-o

(Required) Path to output cell bin GEF, GEM and adjusted mask files.

2. SAW PIPELINES & ARGUMENTS

33

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.11.2 Usage Example
Run cellCorrect as below:
$ nucleusLayer=$(find /path/to/output/04.register -maxdepth 1 -name *fov_stitched_

transformed.tif -exec sh -c 'for f do basename -- "$f" _fov_stitched_transformed.
tif;done' sh {} + | grep -v IF)
$ nucleusMask=$(find /path/to/output/04.register -maxdepth 1 -name ${nucleusLayer}*_
mask.tif)
$ singularity exec SAW_v7.0.sif cellCorrect \
-i /path/to/output/03.count/{SN}.raw.gef \
-m ${nucleusMask} \
-d 10 \

-o /path/to/output/051.cellcut

2.11.3 Outputs
cellCorrect output files:
$ tree /path/to/output/051.cellcut
/path/to/output/051.cellcut
├── SN.adjusted.cellbin.gef
├──<stainType>_SN_mask_edm_dis_10.tif
└── SN.adjusted.gem

2.12 cellCluster
SAW cellCluster pipeline runs by clustering cells using the Leiden algorithm similarly to the procedures of
spatialCluster. Run cellCluster if cell bin results are desired.
Running cellCluster requires the following files:
cellCut output cell bin gene expression matrix file (.cellbin.gef)

•

Expected running time for ~1G reads: ~5 min, Memory: ~5 G

2.12.1 Arguments and Options
Table 2-12 cellCluster Arguments and Options

Parameter

Function

-i

(Required) cellCut output cell bin gene expression matrix file.

-o

(Required) Output path to the clustering result in H5AD format.

2. SAW PIPELINES & ARGUMENTS

34

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.12.2 Usage Example
$ mkdir -p /path/to/output/061.cellcluster
$ singularity exec SAW_v7.0.sif cellCluster \
-i /path/to/output/051.cellcut/{SN}.adjusted.cellbin.gef \
-o /path/to/output/061.cellcluster/{SN}.adjusted.cell.cluster.h5ad
$ singularity exec SAW_v7.0.sif cellCluster \
-i /path/to/output/051.cellcut/{SN}.cellbin.gef \
-o /path/to/output/061.cellcluster/{SN}.cell.cluster.h5ad

2.12.3 Outputs
cellCluster output files:
$ tree /path/to/output/061.cellcluster
/path/to/output/061.cellcluster
├── SN.adjusted.cell.cluster.h5ad
└── SN.cell.cluster.h5ad

2.13 saturation
SAW saturation pipeline is performed to compute the sequencing saturation for the tissue coverage area.
Running saturation requires the following files:
•

mapping output statistical report of CID mapping (.stat)

•

count output saturation sampling file (.txt)

•

count output statistical report of annotation (.stat)

•

tissueCut output GEF file for the tissue coverage area (.tissue.gef)
Expected running time for ~1G reads: ~5 min, Memory: ~5 G

2.13.1 Arguments and Options
Table 2-13 saturation Arguments and Options

Parameter

Function

-i

(Required) count output saturation sampling file.

--tissue

(Required) tissueCut output GEF file for the tissue coverage area.

-o

(Required) Path to the directory where to store the saturation outputs. There has to be an existing path.

--bcstat

(Required) mapping output statistical report of CID mapping. Separate
multiple files by comma.

--summary

(Required) count output statistical report of annotation.

2. SAW PIPELINES & ARGUMENTS

35

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.13.2 Usage Example
$ mkdir -p /path/to/output/07.saturation
$ singularity exec SAW_v7.0.sif saturation \
-i /path/to/output/03.count/{SN}_raw_barcode_gene_exp.txt \
--tissue /path/to/output/05.tissuecut/{SN}.tissue.gef \
-o /path/to/output/07.saturation \
--bcstat /path/to/output/01.mapping/{lane}.CIDMap.stat \
--summary /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.
* dedup.target.bam.summary.stat
* Please be noted that these two lines belong to the same line of command.

For more than one pair of FASTQ files (Here showing an example of 2 pairs of FASTQ),
$ mkdir -p /path/to/multi_lane_output/07.saturation
$ singularity exec SAW_v7.0.sif saturation \
-i /path/to/multi_lane_output/03.count/{SN}_raw_barcode_gene_exp.txt \
--tissue /path/to/multi_lane_output/05.tissuecut/{SN}.tissue.gef \
-o /path/to/multi_lane_output/07.saturation \
--bcstat /path/to/multi_lane_output/01.mapping/{lane1}.CIDMap.stat,/path/to/
*
multi_lane_output/01.mapping/{lane2}.CIDMap.stat \
--summary /path/to/multi_lane_output/03.count/{SN}.Aligned.sortedByCoord.out.
*
merge.q10.dedup.target.bam.summary.stat
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

2.13.3 Outputs
saturation output files:
$ tree /path/to/output/07.saturation
├── plot_1x1_saturation.png
├── plot_200x200_saturation.png
└── sequence_saturation.tsv

2. SAW PIPELINES & ARGUMENTS

36

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14 report
SAW report pipeline is performed to integrate analysis results from each step and generate the report
in JSON format as well as a web report in HTML format. HTML analytical report integrate genes’ spatial
expression distribution, key statistical metrices, sequencing saturation plots, clustering analysis results, and
image processing information. When it comes to the scenario of mIF, pseudo color (up to 7) is used on the
bottom layer of clustering results.
Running report requires the following files and information:
•

mapping output statistical report of CID mapping and STAR alignment (.stat, .out)

•

count output statistical report of annotation (.stat)

•

register processed image process record file and image pyramid RPI file (.ipr, .rpi)

•

tissueCut and cellCut (if available) output GEF file, statistical report of tissue-covered region, plots
and image pyramid RPI file (.gef, .stat, .png)

•

spatialCluster and cellCluster (if available) output clustering H5AD file (.h5ad)

•

saturation output bin200 sequence saturation plot (.png)

•

species, tissue, and reference information
Expected running time for ~1G reads: ~1 min, Memory: 1G

2.14.1 Arguments and Options
Table 2-14 report Arguments and Options

Parameter

Function

-m

(Required) Statistical report of CID mapping. Separate multiple files by comma.

-a

(Required) Statistical report of STAR alignment. Separate multiple files by
comma.

-g

(Required) Statistical report of annotation.

-l

(Required) Statistical report of tissue-covered region.

-n

(Required) GEF file that has wholeExp/bin200. Please check 2.14.1 Other
applications of cellCut to get more information of GEF completion.

-b

(Required) tissueCut output bin 200 scatter plot.

-v

(Required) tissueCut output bin 200 violin plot.

-c

(Required) tissueCut output bin 200 statistics plot.

--bin20Saturation

(Required) tissueCut output bin 20 scatter plot.

--bin20violin

(Required) tissueCut output bin 20 violin plot.

--bin20MIDGeneDNB

(Required) tissueCut output bin 20 statistics plot.

--bin50Saturation

(Required) tissueCut output bin 50 scatter plot.

--bin50violin

(Required) tissueCut output bin 50 violin plot.

--bin50MIDGeneDNB

(Required) tissueCut output bin 50 statistics plot.

--bin100Saturation

(Required) tissueCut output bin 100 scatter plot.

--bin100violin

(Required) tissueCut output bin 100 violin plot.

--bin100MIDGeneDNB

(Required) tissueCut output bin 100 statistics plot.

--bin150Saturation

(Required) tissueCut output bin 150 scatter plot.
2. SAW PIPELINES & ARGUMENTS

37

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Parameter

Function

--bin150violin

(Required) tissueCut output bin 150 violin plot.

--bin150MIDGeneDNB

(Required) tissueCut output bin 150 statistics plot.

-d

(Required) spatialCluster output H5AD file.

-t

(Required) saturation output bin 200 sequence saturation plot.

-r standard_version

(Required) Set to specifying report version.

-s

(Required) The Stereo-seq Chip T serial number.

--pipelineVersion

(Required) Set to specifying analysis pipeline version.

-o

(Required) The directory to store outputs.

--species

(Required) A string of species name.

--tissue

(Required) A string of tissue type.

-reference

(Required) A string of reference used for mapping

--rpi_resolution

(Optional; default to 100) The resolution of RPI. Valid options: 2, 10, 50, 100, 150.

-i

(Optional) The image pyramid RPI file.

--iprFile

(Optional) A processed IPR (image process record) file.

--cellBinGef

(Optional) The cell bin GEF file.

--cellCluster

(Optional) cellCluster output H5AD file.

--tissue_fig

(Optioanal) The directory of statistical images from tissueCut.

--qc_metrics

(Optional) The customized QC-metrics file (.xlsx) for SAW. QC-metrics focus on
sequencing quality, and performance of in situ restoration of sequencing reads.
For example, "Total Q30" and "Fraction MID in Spots Under Tissue".

2.14.2 Usage Example
Run report if register aligned microscopic staining image is provided and has cell bin output:

Please Note! Replace {SN}, {lane},{species_name}, {tissue_type}, {reference_
index} with the real information.

$ imageIPR=$(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head
-1) ## has to be a processed IPR

$ singularity exec SAW_v7.0.sif cellCut bgef \
-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut/{SN}.gef \
-b 1,10,20,50,100,200,500 \
-O Transcriptomics

* $ mkdir -p /path/to/output/08.report

$ singularity exec SAW_v7.0.sif report \
-m /path/to/output/01.mapping/{lane}.CIDMap.stat \
-a /path/to/output/01.mapping/{lane}.Log.final.out \
-g /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
target.bam.summary.stat \
-l /path/to/output/05.tissuecut/tissuecut.stat \
-n /path/to/output/05.tissuecut/{SN}.gef \

* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.
2. SAW PIPELINES & ARGUMENTS

38

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

gene_counts.png
\,--bin20violin,--bin20MIDGeneDNB
-d /path/to/output/06.spatialcluster/{SN}.bin200_1.0.spatial.cluster.h5ad \
-t /path/to/output/07.saturation/plot_200x200_saturation.png \
png \

-b /path/to/output/05.tissuecut/tissue_fig/scatter_200x200_MID_gene_counts.
-v /path/to/output/05.tissuecut/tissue_fig/violin_200x200_MID_gene.png \

png \

-c /path/to/output/05.tissuecut/tissue_fig/statistic_200x200_MID_gene_DNB.
--bin20Saturation /path/to/output/ 05.tissuecut/tissue_fig/scatter_20x20_MID_

gene_counts.png \

png \

--bin20violin /path/to/output/05.tissuecut/tissue_fig/violin_20x20_MID_gene.

--bin20MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_20x20_
MID_gene_DNB.png \
--bin50Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_50x50_MID_
gene_counts.png \
png \

--bin50violin /path/to/output/05.tissuecut/tissue_fig/violin_50x50_MID_gene.

--bin50MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_50x50_
MID_gene_DNB.png \
--bin100Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_100x100_
MID_gene_counts.png \

*

--bin100violin /path/to/output/05.tissuecut/tissue_fig/violin_100x100_MID_
gene.png \
--bin100MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_100x100_MID_gene_DNB.png \
--bin150Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_150x150_
MID_gene_counts.png \
--bin150violin /path/to/output/05.tissuecut/tissue_fig/violin_150x150_MID_
gene.png \
--bin150MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_150x150_MID_gene_DNB.png \
--cellBinGef /path/to/output/051.cellcut/{SN}.adjusted.cellbin.gef \
--cellCluster /path/to/output/061.cellcluster/{SN}.adjusted.cell.cluster.h5ad \
-i /path/to/output/04.register/{SN}.rpi \
-r standard_version \
-s {SN} \
--pipelineVersion SAW_v7.0.0 \
--iprFile ${imageIPR} \
--species {species_name} \
--tissue {tissue_type} \
--reference {reference_index} \
-o /path/to/output/08.report
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

2. SAW PIPELINES & ARGUMENTS

39

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

For more than one pair of FASTQ files (Here showing an example of 2 pairs of FASTQ),
$ mkdir -p /path/to/multi_lane_output/08.report
$ singularity exec SAW_v7.0.sif cellCut bgef \
-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut/{SN}.gef \
-b 1,10,20,50,100,200,500 \
-O Transcriptomics
$ singularity exec SAW_v7.0.sif report \

*

-m /path/to/multi_lane_output/01.mapping/{lane1}.CIDMap.stat,/path/to/multi_
lane_output/01.mapping/{lane2}.CIDMap.stat \
-a /path/to/multi_lane_output/01.mapping/{lane1}.Log.final.out,/path/to/
multi_lane_output/01.mapping/{lane2}.Log.final.out \
-g /path/to/multi_lane_output/03.count/{SN}.Aligned.sortedByCoord.out.merge.
q10.dedup.target.bam.summary.stat \
-l /path/to/multi_lane_output/05.tissuecut/tissuecut.stat \
-n /path/to/multi_lane_output/05.tissuecut/{SN}.gef \
-d /path/to/multi_lane_output/06.spatialcluster/{SN} .bin200_1.0.spatial.
cluster.h5ad \

-t /path/to/multi_lane_output/07.saturation/plot_200x200_saturation.png \

-b /path/to/multi_lane_output/05.tissuecut/tissue_fig/scatter_200x200_MID_
gene_counts.png \
-v /path/to/multi_lane_output/05.tissuecut/tissue_fig/violin_200x200_MID_
gene.png \
-c /path/to/multi_lane_output/05.tissuecut/tissue_fig/statistic_200x200_MID_
gene_DNB.png \
--bin20Saturation /path/to/mult_lane_output/05.tissuecut/tissue_fig/scatter_20x20_MID_gene_counts.png \
--bin20violin /path/to/multi_lane_output/05.tissuecut/tissue_fig/violin_20x20_MID_gene.png \
--bin20MIDGeneDNB /path/to/multi_lane_output/05.tissuecut/tissue_
fig/statistic_20x20_MID_gene_DNB.png \
--bin50Saturation /path/to/mult_lane_output/05.tissuecut/tissue_fig/scat-

* ter_50x50_MID_gene_counts.png \

--bin50violin /path/to/multi_lane_output/05.tissuecut/tissue_fig/violin_50x50_MID_gene.png \
--bin50MIDGeneDNB /path/to/multi_lane_output/05.tissuecut/tissue_
fig/statistic_50x50_MID_gene_DNB.png \
--bin100Saturation /path/to/multi_lane_output/05.tissuecut/tissue_
fig/scatter_100x100_MID_gene_counts.png \
--bin100violin /path/to/multi_lane_output/05.tissuecut/tissue_
fig/violin_100x100_MID_gene.png \
--bin100MIDGeneDNB /path/to/multi_lane_output/05.tissuecut/tissue_
fig/statistic_100x100_MID_gene_DNB.png \
--bin150Saturation /path/to/multi_lane_output/05.tissuecut/tissue_
fig/scatter_150x150_MID_gene_counts.png \

2. SAW PIPELINES & ARGUMENTS

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

40

--bin150violin /path/to/multi_lane_output/05.tissuecut/tissue_

*

fig/violin_150x150_MID_gene.png \
--bin150MIDGeneDNB /path/to/multi_lane_output/05.tissuecut/tissue_
fig/statistic_150x150_MID_gene_DNB.png \
--cellBinGef /path/to/output/051.cellcut/{SN}.adjusted.cellbin.gef \
--cellCluster /path/to/output/061.cellcluster/{SN}.adjusted.cell.cluster.h5ad \
-i /path/to/multi_lane_output/04.register/{SN}.rpi \
-r standard_version \
-s {SN} \
--pipelineVersion SAW_v7.0.0 \
--iprFile ${imageIPR} \
--species {species_name} \
--tissue {tissue_type} \
--reference {reference_index} \
-o /path/to/multi_lane_output/08.report
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

Run report of outputs in which the microscopic image has been registered with gene expression matrix but
did not perform cell segmentation. Here is an example of just one pair of FASTQ,
$ mkdir -p /path/to/output/08.report
$ singularity exec SAW_v7.0.0.sif cellCut bgef \
-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut/{SN}.gef \
-b 1,10,20,50,100,200,500 \
-O Transcriptomics
$ singularity exec SAW_v7.0.0.sif report \
-m /path/to/output/01.mapping/{lane}.CIDMap.stat \
-a /path/to/output/01.mapping/{lane}.Log.final.out \
-g /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
* target.bam.summary.stat \
-l /path/to/output/05.tissuecut/tissuecut.stat \
-n /path/to/output/05.tissuecut/{SN}.gef \
-d /path/to/output/06.spatialcluster/{SN}.bin200_1.0.spatial.cluster.h5ad \
-t /path/to/output/07.saturation/plot_200x200_saturation.png \
-b /path/to/output/05.tissuecut/tissue_fig/scatter_200x200_MID_gene_counts.png
* \
-v /path/to/output/05.tissuecut/tissue_fig/violin_200x200_MID_gene.png \
-c /path/to/output/05.tissuecut/tissue_fig/statistic_200x200_MID_gene_DNB.png
\
--bin20Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_20x20_MID_
gene_counts.png \
--bin20violin /path/to/output/05.tissuecut/tissue_fig/violin_20x20_MID_gene.
*
png \
--bin20MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_20x20_MID_
gene_DNB.png \
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.
2. SAW PIPELINES & ARGUMENTS

41

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

--bin50Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_50x50_MID_
gene_counts.png \
--bin50violin /path/to/output/05.tissuecut/tissue_fig/violin_50x50_MID_gene.
png \
--bin50MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_50x50_MID_
gene_DNB.png \
--bin100Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_100x100_
MID_gene_counts.png \
--bin100violin /path/to/output/05.tissuecut/tissue_fig/violin_100x100_MID_
*
gene.png \
--bin100MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_100x100_
MID_gene_DNB.png \
--bin150Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_150x150_
MID_gene_counts.png \
--bin150violin /path/to/output/05.tissuecut/tissue_fig/violin_150x150_MID_gene.
png \
--bin150MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_150x150_
MID_gene_DNB.png \
-i /path/to/output/04.register/{SN}.rpi \
-r standard_version \
-s {SN} \
--pipelineVersion SAW_v7.0.0 \
--iprFile ${imageIPR} \
--species {species_name} \
--tissue {tissue_type} \
--reference {reference_index} \
-o /path/to/output/08.report

Run report for register aligned microscopic staining image is absent (Here shows an example of just
one pair of FASTQ, similar to multiple pairs),
$ mkdir -p /path/to/output/08.report
$ singularity exec SAW_v7.0.sif cellCut bgef \
-i /path/to/output/03.count/{SN}.raw.gef \
-o /path/to/output/05.tissuecut/{SN}.gef \
-b 1,10,20,50,100,200,500 \
-O Transcriptomics
$ singularity exec SAW_v7.0.sif report \
-m /path/to/output/01.mapping/{lane}.CIDMap.stat \
-a /path/to/output/01.mapping/{lane}.Log.final.out \
-g /path/to/output/03.count/{SN}.Aligned.sortedByCoord.out.merge.q10.dedup.
* target.bam.summary.stat \
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

2. SAW PIPELINES & ARGUMENTS

42

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

* png \
png \

-l /path/to/output/05.tissuecut/tissuecut.stat \
-n /path/to/output/05.tissuecut/{SN}.gef \
-d /path/to/output/06.spatialcluster/{SN}.bin200_1.0.spatial.cluster.h5ad \
-t /path/to/output/07.saturation/plot_200x200_saturation.png \
-b /path/to/output/05.tissuecut/tissue_fig/scatter_200x200_MID_gene_counts.
-v /path/to/output/05.tissuecut/tissue_fig/violin_200x200_MID_gene.png \
-c /path/to/output/05.tissuecut/tissue_fig/statistic_200x200_MID_gene_DNB.

--bin20Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_20x20_MID_
gene_counts.png \
--bin20violin /path/to/output/05.tissuecut/tissue_fig/violin_20x20_MID_gene.
* png \
--bin20MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_20x20_
MID_gene_DNB.png \
--bin50Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_50x50_MID_
gene_counts.png \
--bin50violin /path/to/output/05.tissuecut/tissue_fig/violin_50x50_MID_gene.
* png \
--bin50MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_50x50_
MID_gene_DNB.png \
--bin100Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_100x100_
MID_gene_counts.png \
--bin100violin /path/to/output/05.tissuecut/tissue_fig/violin_100x100_MID_
gene.png \
--bin100MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_100x100_MID_gene_DNB.png \
--bin150Saturation /path/to/output/05.tissuecut/tissue_fig/scatter_150x150_
MID_gene_counts.png \
--bin150violin /path/to/output/05.tissuecut/tissue_fig/violin_150x150_MID_
gene.png \
--bin150MIDGeneDNB /path/to/output/05.tissuecut/tissue_fig/statistic_150x150_MID_gene_DNB.png \
-r standard_version \
-s {SN} \
--pipelineVersion SAW_v7.0.0 \
--species {species_name} \
--tissue {tissue_type} \
--reference {reference_index} \
-o /path/to/output/08.report

* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

2. SAW PIPELINES & ARGUMENTS

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

43

2.14.3 Outputs
report output files that have cell bin data input are organized as below:
$ tree /path/to/output/08.report
/path/to/output/08.report
├── scatter_1x1_MID_gene_counts.png
├── SN.report.html
├── SN.statistics.json
├── statistic_1x1_cell_area.png
├── statistic_1x1_DNB.png
├── statistic_1x1_gene.png
├── statistic_1x1_MID.png
├── violin_1x1_gene.png
└── violin_1x1_MID.png

report output files that the cell bin data inputs are absent:
$ tree /path/to/output/08.report
/path/to/output/08.report
├── SN.report.html
└── SN.statistics.json

2.15 Other Applications

2.15.1 Other applications of cellCut
SAW cellCut is also an application for manipulating GEF file. SAW contains this tool to convert GEF format
gene expression matrix to plain table or complete a GEF. Users may also manipulate the GEF files using the separate individual C++ compiled program geftools12 or its python encapsulated package gefpy13.

2. SAW PIPELINES & ARGUMENTS

44

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.15.1.1 Arguments and Options
Table 2-15 Other applications of cellCut Arguments and Options

Commands

view

bgef

Parameters

Function

-i, --input-file

(Required) Input bin GEF file or cell bin GEF file.

-o, --output-file

(Optional; default to stdout) Output GEM file.

-d, --exp_data

(Optional; default to “”) Input bin1 GEF to get cell bin GEM.

-m, --mask-file
-b, --bin-size

(Optional; default to "") Input cell segmentation mask file, when cell
bin GEM is expected output.
(Optional; default to1) Set bin size for bin GEF file. Only valid for bin
GEF.

-s, --serial-number

(Required) Stereo-seq Chip T serial number.

-e, --exon

(Optional; default to 1) Whether or not output exon group.

-w, --errorCode-file

(Optional; default to false) Determine output error code to file.

-i, --input-file

(Required) Input gene expression matrix file (.gem/.gem.gz) or bin1
GEF file.

-o, --output-file

(Required) Output bin GEF file.

-b, --bin-size

(Required; default to 1,10,20,50,100,200,500) Comma-separate bin
size list.

-r, --region

(Optional; default to “”) A rectangular region represented by the
comma-separated list of vertex coordinates. For example, minx,maxX,minY,maxY.

-t, --threads

(Optional; default to 8) Number of threads.

-O, --omics

(Optional; default to true) Whether create stat group. Stat group includes a gene dataset which contains total MIDcount and E10 score for
each gene.
(Required; default to Transcriptomics) Specify the omics.

-v, --verbose

(Optional) Verbose output.

-w, --errorCode-file

(Optional; default to false) Determine output error code to file.

-i, --input-file

(Required) Input GEF file.

-m, --mask-file

(Required) Input cell segmentation mask file.

-o, --output-file

(Required) Output cell bin GEF file.

-b, --block

(Optional; default to 256,256) Block size.

-r, --rand-celltype

(Optional; default to 0) Number of random cell type.

-t, --threads

(Optional; default to 1) Number of threads.

-v, --verbose

(Optional) Verbose output.

-n, --cnum

(Optional; default to 5000) Top level cell number.

-R, --ratio

(Optional; default to 20) Other level cell number ratio.

-a, --allocat

(Optional; default to 2) Allocation strategy.

-g, --raw-gem

(Optional) Raw GEM file.

-c, --canvas

(Optional; default to 0,0,90000,90000) Set canvas size, minX, minY,
maxX, maxY.

-l, --limit

(Optional; default to 16,16) Set block limit.

-S, --split

(Optional; default to 0) Split cellID to layers and blocks.

-w, --errorCode-file

(Optional; default to false) Set to turn on error code mode.

-s, --stat

cgef

2. SAW PIPELINES & ARGUMENTS

45

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14.1.2 Usage Examples
Function 1: GEF to plain table GEM format
1

$ singularity exec SAW_v7.0.sif cellCut view \

bin1 geneExp

## convert GEF that only contains

-s {SN} \
-i /path/to/output/03.count/{SN}.raw.gef \
-o {SN}.raw.gem
$ singularity exec SAW_v7.0.sif cellCut view \ ## convert a whole GEF
-s {SN} \
-i /path/to/output/05.tissuecut/{SN}.gef \
-o {SN}.gem
$ singularity exec SAW_v7.0.sif cellCut view \ ## convert tissue GEF that only

contains bin1 geneExp

-s {SN} \
-i /path/to/output/05.tissuecut/{SN}.tissue.gef \
-o {SN}.tissue.gem
$ singularity exec SAW_v7.0.sif cellCut view \ ## convert cellbin GEF to cellbin

GEM

-s {SN} \
-i /path/to/output/051.cellcut/{SN}.cellbin.gef \
-o {SN}.cellbin.gem \
-d /path/to/output/03.count/{SN}.raw.gef

Function 2: completion of a GEF
## complete GEF that only contains
bin1 geneExp group to a whole GEF, you may specify the bin size using “-b”. Separate multiple bin size with comma
$ singularity exec SAW_v7.0.sif cellCut bgef \

-i /path/to/output/03.count/{SN}.tissue.gef \
-o {SN}.tissue.complete.gef \
-b 1,20,50,100 \
-O Transcriptomics

Function 3: converting GEM to GEF
## convert GEM to GEF in specific
bin size. Separate multiple bin sizes with comma

$ singularity exec SAW_v7.0.sif cellCut bgef \
-i {SN}.gem \
-o {SN}.gef \
-b 1,20,50 \
-O Transcriptomics

Example of GEF to GEM conversion using gefpy, users may specify the bin size.
$ python
>>> from gefpy.bgef_reader_cy import BgefR
>>> bgef=BgefR(filepath=’/path/to/output/05.tissuecut/{SN}.tissue.gef’,bin_
size=200,n_thread=4)
>>> bgef.to_gem(‘{SN}.tissue.bin200.gem’)
2. SAW PIPELINES & ARGUMENTS

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

46

2.14.2 checkGTF
SAW checkGTF is an application for checking whether the GTF/GFF file is in the correct format as the input for
count, especially the limitation to the length of gene names.
Running checkGTF requires the following files:
Reference genome annotation GFF/GTF9,10 file (.gff / .gtf)

•

2.14.2.1 Arguments and Options
Table 2-17 checkGTF Arguments and Options

Parameter

Function

-i

(Required) Gene annotation GFF/GTF file.

-o

(Required) Output a re-format GFF/GTF file.

2.14.2.2 Usage Examples
$ singularity exec SAW_v7.0.sif checkGTF \

-i /path/to/reference/genes.gtf \
-o /path/to/reference/genes_new.gtf \

2.14.3 Other applications of imageTools
Besides ipr2img, imageTools has three more functions: img2rpi(writes images in RPI format), merge
(merges stain image with tissue segmentation and cell segmentation images to check the segmentation
result), and overlay (stacks inferred track line template with stitched panoramic image to check stitching
result or stacks track line template from matrix with registered panoramic image to check registration result).

2. SAW PIPELINES & ARGUMENTS

47

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14.3.1 Arguments and Options
Table 2-18 Other applications of imageTools Arguments and Options

Commands

img2rpi

Parameters

Function

-i

(Required) Input TIFF file. Separate multiple files by comma.

-g

(Required) Set the '<stainType>/<imageType>' of the input TIFF stores in the
RPI. Separate multiple files by comma, the order of groups needs to be exactly
same with the input TIFF files.

-b

(Required) Bin sizes. Separate multiple bin sizes with space, for example 1 10
50 100

-o

(Required) Output path for the RPI file. Has to use absolute path or relative
path.

-i

(Optional) Customized mask colors in RGB format only valid for
(/<stainType>/TissueMask_<label>/Color. The default color is set to be
(255,255,255) for one mask. Separate multiple mask colors by comma and
and add escape characters before brackets.
For example: -c \(10,20,30\),\(30,40,50\).
(Required) Input TIFF files. Separate multiple files by comma. The maximum
number of TIFF files to be composited is three, and the channel order is R-G-B.

-o

(Required) Output path for the multichannel image.

-i

(Required) Input TIFF file. Usually input a pre-registered panoramic image if
overlaid with the stitching template derived from track cross, and input a registered microscopic image if overlaid with the track line template acquired from
gene expression matrix.

-c

(Required) Image configuration file (.ipr) or template points file (.txt).

-o

(Required) Output path of the TIFF file which has the template overlaid on the
selected image.

-d

(Required) Module name. Convert template from IPR for the selected modules.
Valid options: stitch or register.

-l

(Optional, default to 30) Cross limbs length in pixel.

-w

(Optional, default to 1) Cross line thickness in pixel.

-i

(Required) ImageQC/ImageStudio processed staining image TAR.GZ file.

-c

(Required) IPR (image process record) file. IPR is designed to efficiently hold
image information generated from each processing step and datasets in various compound types along with metadata. Please check Stereo-seq File
Format Manual to get more information on IPR file.

-d

(Required) Segmentation module names. Convert segmentation mask TIFF
from IPR for the selected modules. Valid options: tissue and cell. Separate
modules by space.

-r

(Required; default to True) Whether output registered images or pre-registered
images. “Pre-registered” state stands for the images that have been stitched
to a single panoramic image and transformed to have the same scale with the
gene expression matrix, but still need to be flipped, rotated, or translated. The
options are True for output registered images and False for output pre-registered images.

-o

(Required) Path to the directory where to store the imageTools ipr2img
outputs.

-c

merge

overlay

ipr2img

2. SAW PIPELINES & ARGUMENTS

48

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14.3.2 Usage Examples
Function 1: img2rpi
$ singularity exec SAW_v7.0.sif imageTools img2rpi \

-i /path/to/output/04.register/<stainType1>_fov_stitched_transformed.tif,/
path/to/output/04.register/<stainType2>_fov_stitched_transformed.tif \
-g <stainType1>/<ImageType>,<stainType2>/<ImageType>\
-b 1 10 50 100 \
-o /path/to/output/04.register/fov_stitched_transformed.rpi

used for manual registration in StereoMap

## this RPI is

# An easy example of transforming multiple <stainType>_fov_stitched_transformed.tif
# and storing as '<stainType>/Image' into fov_stitched_transformed.rpi
$ registerTif=$(find /path/to/output/04.register -maxdepth 1 -name \

* *fov_stitched_transformed.tif)

$ regTifStr=$(echo $registerTif | tr ' ' ',')
$ regGroup=$(find /path/to/output/04.register -maxdepth 1 -name \

*

'*fov_stitched_transformed.tif' -exec sh -c 'for f do basename -- "$f" \
_fov_stitched_transformed.tif;done' sh {} +)

$ regGroupStr=$(echo $regGroup | sed 's/ \|$/\/Image,/g' | sed 's/.$//') \
$ singularity exec SAW_v7.0.sif imageTools img2rpi \
-i ${regTifStr} \
-g ${regGroupStr} \ ## <stainType>/Image，<stainType>/Image
-g 1 10 50 100 \
-o /path/to/output/04.register/fov_stitched_transformed.rpi
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

## Cutomize labeled-tissue-mask color
$ singularity exec SAW_v7.0.sif imageTools img2rpi \
-i /path/to/<stainType>_{SN}_<label01>_tissue_cut.tif,/path/to/<stainType>_{SN}
_<label02>_tissue_cut.tif\
-g <stainType>/TissueMask_<label01>,<stainType>/TissueMask_<label02> \
-o /path/to/output/04.register/<stainType>_stitch_check_tmplt.tif \
-g 1 10 50 100 \

-c \(100,200,255\),\(200,25,255\) \ ## escape character "\" before brackets
-o /path/to/fov_stitched.rpi ## this RPI could be used for manual registration

in StereoMap

2. SAW PIPELINES & ARGUMENTS

49

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Function 2: merge ( -i Arbitrary up to three grayscale images (.tif))
$ singularity exec SAW_v7.0.sif imageTools merge \

-i /path/to/output/04.register/<stainType>_{SN}_regist.tif,/path/to/output/04.
* register/<stainType>_{SN}_tissue_cut.tif,/path/to/output/04.register/<stainType>_
{SN}_mask.tif \
-o /path/to/output/04.register/merge.tif
* Please be noted that we use the backward slash “\” to indicate the end of a line in a command that spans multiple lines.

Function 3: overlay
Overlay stitching template in IPR or in a TXT format with the pre-registered panoramic image to check the
stitching result.
## stitch

preRegImage=/path/to/output/04.register/<stainType>_fov_stitched_transformed.tif
imageIPR=$(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head -1)
stitchTmplt=/path/to/output/04.register/<stainType>_transform_template.txt
singularity exec SAW_v7.0.sif imageTools overlay \

-i ${preRegImage} \
-c ${imageIPR} \
-o /path/to/output/04.register/<stainType>_stitch_check.tif \
-d stitch \
-l 60 \
-w 3

singularity exec SAW_v7.0.sif imageTools overlay \
-i ${preRegImage} \
-c ${stitchTmplt} \
-o /path/to/output/04.register/<stainType>_stitch_check_tmplt.tif \
-d stitch \
-l 60 \
-w 3

2. SAW PIPELINES & ARGUMENTS

50

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Overlay registration template in IPR or in a TXT format with the registered panoramic image.
## register

$ regImage= /path/to/output/04.register/<stainType>_{SN}_regist.tif
imageIPR=$(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head -1)
regTmplt=/path/to/output/04.register/<stainType>_matrix_template.txt
$ singularity exec SAW_v7.0.sif imageTools overlay \
-i ${regImage} \
-c ${imageIPR} \
-o /path/to/output/04.register/register_check.tif \
-d register \
-l 60 \
-w 3
$ singularity exec SAW_v7.0.sif imageTools overlay \
-i ${regImage} \

-c ${regTmplt} \
-o /path/to/output/04.register/register_check_tmplt.tif \
-d register \
-l 60 \
-w 3

Function 4: ipr2img
Output images (.tif) from IPR file. Other usages of this function can be found in the tutorial for manual
processing workflow on GitHub (https://github.com/STOmics/SAW/blob/main/Documents/
UserManual/).

2.14.4 manualRegister
SAW manualRegister pipeline is performed when automatic registration result does not meet the requirement.
Users can use StereoMap, an offline visualization software, to manually register images with the gene
expression matrix. The operation parameters are recorded in the JSON file and can be input into the SAW
manualRegister pipeline to modify registration record in IPR. Remember to run imageTools ipr2img
again to acquire transformed images.
Running manualRegister requires the following files and information:
•

count output gene expression matrix file (.raw.gef)

•

An image processing output directory, including several *fov_stitched_transformed.tif files,
usually in /path/to/output/04.register

•

register/rapidRegister output IPR file (.ipr), supporting v0.1.0

•

StereoMap manual registration output JSON file, recording manual operations (.regist.json)
Expected running time for 1 cm x 1 cm Stereo-seq Chip T image: ~3 min, Memory: 7 G

2. SAW PIPELINES & ARGUMENTS

51

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14.4.1 Arguments and Options
Table 2-19 manualRegister Arguments and Options

Parameters

Function

-i

(Required) register/rapidRegister output directory which includes a <stainType>_
fov_stitched_transformed.tif or <stainType>_fov_stitched.tif file.

-c

(Required) register/rapidRegister output IPR file. manualRegister would overwrite
registration parameters in the IPR to the manually adjusted parametes acquired from StereoMap.

-v

(Required) count output gene expression matrix GEF file.

-m

(Optional; default to "") The path to StereoMap outpu JSON file

-w

(Optional; default to False) False: negative degree when clockwise rotation. True: positive degree
when clockwise rotation. Being valid when -m is missing.

-o

(Optional; default to 0 0) Offset in the x and y direction from the center of the fov_stitched_
transformed.tif image. These two values are specified as "offsetX" and "offsetY" in the
StereoMap output JSON file created after manual registration, and will be recorded as "OffsetX"
and "OffsetY" in the IPR "Register" group. The offset x and offset y are separate by space.

-f

(Optional; default to 0) Whether flip the image horizontally along the y-axis. This value is specified as "flip" in the StereoMap output JSON file created after manual registration. Valid options:
1 (flip), 0 (not flip). Flip information will be recorded as "Flip" in the IPR "Register" group.

-r

(Optional; default to 0) The manual rotation degree from the center of the fov_stitched_transformed.tif image. This value is specified as "rotate" in the StereoMap output JSON file created
after manual registration, and will be recorded as "ManualRotation" in the IPR "Register" group.

-s

(Optional; default to 0 0) The manual scale in the x and y direction from the center off the fov_
stitched_transformed.tif image. These two values are specified as "extrude_x" and
"extrude_y" in the StereoMap output JSON file created after manual registration, and will be recorded as "ManualScaleX" and "ManualScaleY" in the IPR "Register" group. The scale x and scale
y are separated by space.

-p

(Required) Output directory.

2.14.4.2 Usage Examples
Tip: get the inputs for manualRegister from StereoMap manual registration output JSON file:
Option 1:
- "offsetX":{offsetX} of -o
- "offsetY":{offsetY} of -o
- "flip":{flip} of -f
- "rotate": {rotate} of -r
- "extrude_x": {extrude_x} of -s
- "extrude_y": {extrude_y} of -s
- "version":{isReversed} of -w,If this key is not present in the JSON, enter
"True". If it is present, enter "False". This parameter only takes effect when -m
is missing.
Option 2: Use StereoMap output JSON file only by -m.
2. SAW PIPELINES & ARGUMENTS

52

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Scenario 1: transform image based solely on manual operation
$ mkdir -p /path/to/output/manualregister
$ cp $(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head -1)
/path/to/output/manualregister # we recommend to make a copy of IPR to pre-

vent overwirte original file

$ regIPR=$(find /path/to/output/manualregister -maxdepth 1 -name {SN}*.ipr |
head -1)
$ singularity exec SAW_v7.0.sif manualRegister \
-i /path/to/output/04.register \
-c ${regIPR} \
-v /path/to/output/03.count/{SN}.raw.gef \
-o {offsetX} {offsetY} \
-f {flip} \
-r {rotate} \
-s {extrude_x} {extrude_y} \
-w {isReversed} \
-p /path/to/output/manualregister

Scenario 2: Use StereoMap output JSON file only
$ mkdir -p /path/to/output/manualregister
$ cp $(find /path/to/output/04.register -maxdepth 1 -name {SN}*.ipr | head -1)
/path/to/output/manualregister # we recommend to make a copy of IPR to pre-

vent overwirte original file

$ regIPR=$(find /path/to/output/manualregister -maxdepth 1 -name {SN}*.ipr |
head -1)
singularity exec SAW_v7.0.sif manualRegister \
-i /path/to/output/04.register \
-c ${regIPR} \
-v /path/to/output/03.count/{SN}.raw.gef \
-p /path/to/datetime.regist.json
-p /path/to/output/manualregister

2. SAW PIPELINES & ARGUMENTS

53

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14.5 lasso
SAW lasso pipeline is performed to extract cell or spatial gene expression matrix(ces) of one or multiple
manually delineated closed regions acquired from StereoMap.
Running lasso requires the following files and information:
•

GEF file that includes wholeExp group or cellCut output cell bin GEF file (.gef or .cellbin.gef)

•

StereoMap output coordinates list file (.geojson)
Running time and memory are highly dependent on the selected bin size and data volume.

2.14.5.1 Arguments and Options
Table 2-20 lasso Arguments and Options

Parameters

Function

-i

(Required) GEF file that includes wholeExp group or cellCut output cell bin GEF file (.gef or
.cellbin.gef)

-m

(Required) StereoMap output coordinates list file (.geojson)

-n

(Required) The Stereo-seq Chip T serial number.

-o

(Required) Path to the directory where to store the lasso outputs. It has to be an existing path.

-s

(Optional for square bin, default=1) GEM Bin size. Separate multiple bin size by comma, e.g.
"-s 10,20".

2.14.5.2 Usage Examples
Please Note! Replace {SN} with your Stereo-seq Chip T serial number (SN, e.g. SS200000135TL_
D1 ), {bin} with the bin size you want (e.g. 1, 10, 200), and /upload/path/{taskID} with the
true path and task ID.
Scenario 1: square bin lasso
$ mkdir -p /path/to/output/lasso
$ singularity exec SAW_v7.0.sif lasso \

-i /path/to/output/03.count/{SN}.gef \
-m /upload/path/{taskID}.anno.geojson \
-o /path/to/output/lasso \
-s {bin} \
-n {SN}

2. SAW PIPELINES & ARGUMENTS

54

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Scenario 2: cell bin lasso
$ mkdir -p /path/to/output/lasso
$ singularity exec SAW_v7.0.sif lasso \
-i /path/to/output/051.tissuecut/{SN}.cellbin.gef \
-m /upload/path/{taskID}.anno.geojson \
-o /path/to/output/lasso \
-n {SN}

# do cell cluster for cellbin.gef and can show clusters in StereoMap
$ singularity exec SAW_v7.0.sif lasso \
-i /path/to/output<label>/{SN}.<label>.label.cellbin.gef \
-o /path/to/output<label>/{SN}.<label>.label.cell.cluster.h5ad

# pre-compute rendering data and can show cellbin.gef expression heatmap in
StereoMap
$ singularity exec SAW_v7.0.sif lasso \
-i /path/to/output<label>/{SN}.<label>.label.cell.cluster.h5ad \
-o /path/to/<label>

2.14.5.3 Outputs
Square bin lasso output files are:
$ tree /path/to/output/lasso
/path/to/output/lasso
└── <label>
├── SN.<label>.label.gef
└── segmentation
├── SN.lasso.<binList[0]>.<label>.gem.gz
...
├── SN.lasso.<binList[m]>.<label>.gem.gz
└── SN.lasso.<label>.mask.tif

Cellbin lasso output files are:
$ tree /path/to/output/lasso
/path/to/output/lasso
└── <label>
└── SN.<label>.label.cellbin.gef

2. SAW PIPELINES & ARGUMENTS

55

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

2.14.6 cellChunk
cellChunk is performed to generate precomputed rendering data for StereoMap. This information will
be recorded in /codedCellBlock in cell bin GEF file.
Running cellChunk requires the following file:
• cell bin GEF file (cellbin.gef) after cellCluster.

2.14.6.1 Arguments and Options
Table 2-21 cellChunk Arguments and Options

Parameters

Function

-i
-o

(Required) cell bin GEF file (.cellbin.gef or .cellbin.gef ) after cellCluster.
(Required) Path to the directory where to store outputs. It has to be an existing path.

2.14.6.2 Usage Examples
$ mkdir -p /path/to/output/lasso
$ singularity exec SAW_v7.0.sif cellChunk \
-i /path/to/output/051.cellcut/{SN}.adjusted.cellbin.gef \
-o /path/to/051.cellcut

2. SAW PIPELINES & ARGUMENTS

STOMICS ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

CHAPTER 3
TEST DATA
DEMONSTRATION

57

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Users may refer to this section as a format for testing SAW process, of the files shown in this chapter as the
reference in testing SAW pipelines. This chapter includes the statistics results and examples of critical files for
each key step.
SN: SS200000135TL_D1
“…” in the demo stands for some lines of log information that can be omitted.

3.1 mapping
3.1.1 Statistical Report for CID Mapping and Filtering
$ cat /path/to/output/01.mapping/E100026571_L01_trim_read_1.CIDMap.stat
...
unique_CID_in_mask:
645784920
unique_CID_in_fq:
78021796
total_reads:
1002214171
CID_with_N_reads:
8031
0.00 %
CID_mapped_reads:
845113606
84.32 %
CID_exactly_mapped_reads:
698277934
69.67 %
CID_mapped_reads_with_mismatch:
146827641
14.65 %
discarded_MID_reads:
8451158
0.84 %
MID_with_N_reads:
13339
0.00 %
MID_with_polyA_reads:
13044
0.00 %
MID_with_low_quality_base_reads:
8424775
0.84 %
reads_with_dnb:
45281336
4.52 %
reads_with_adapter:
8136836
0.81 %
short_reads_filtered_with_polyA:
14191622
1.42 %
reads_with_polyA:
105849530
10.56 %
reads_with_rRNA:
0
0.00 %
Q10_bases_in_seq:
99.47 %
Q20_bases_in_seq:
97.12 %
Q30_bases_in_seq:
91.08 %
Q10_bases_in_MID:
99.26 %
Q20_bases_in_MID:
96.32 %
Q30_bases_in_MID:
89.45 %
Q10_bases_in_CID:
99.54 %
Q20_bases_in_CID:
97.49 %
Q30_bases_in_CID:
91.74 %

3. TEST DATA DEMONSTRATION

58

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.1.2 Statistical Report for Reference Genome Alignment
$ cat /path/to/output/01.mapping/E100026571_L01_trim_read_1.Log.final.out
...
Number of input reads |
769052654
Average input read length |
95
UNIQUE READS:
Uniquely mapped reads number |
645319822
Uniquely mapped reads % |
83.91%
Average mapped length |
95.14
Number of splices: Total |
67634124
Number of splices: Annotated (sjdb) |
65711163
Number of splices: GT/AG |
66445242
Number of splices: GC/AG |
457783
Number of splices: AT/AC |
41573
Number of splices: Non-canonical |
689526
Mismatch rate per base, % |
0.50%
Deletion rate per base |
0.07%
Deletion average length |
3.91
Insertion rate per base |
0.03%
Insertion average length |
1.25
MULTI-MAPPING READS:
Number of reads mapped to multiple loci |
87828411
% of reads mapped to multiple loci |
11.42%
Number of reads mapped to too many loci |
5333051
% of reads mapped to too many loci |
0.69%
UNMAPPED READS:
Number of reads unmapped: too many mismatches |
0
% of reads unmapped: too many mismatches |
0.00%
Number of reads unmapped: too short |
29365488
% of reads unmapped: too short |
3.82%
Number of reads unmapped: other |
1205882
% of reads unmapped: other |
0.16%
CHIMERIC READS:
Number of chimeric reads |
0
% of chimeric reads |
0.00%

3.1.3 Example of BAM mapping
$ samtools view /path/to/output/01.mapping/E100026571_L01_trim_read_1.Aligned.
sortedByCoord.out.bam | head -2
E100026571L1C007R00303973559
256
1
3000644 3
100M
*
0
0
GCCTCATTGTGCCCCATATGTTTGCCTATGTTGTGGACTTATTTTCATTAAACTTTAAAACATCTTTAATTTTTTTCTTTATTTCATCATTGACCAAGCT
-FCA9D?GFFD<-D<CGFEGD-DG*FGFDFBE;E(9BGGE38FFFG9GG;0?GGFGB?E@G:GGG3GF79F0GGDG?G<D>F;EG,G?<<CD4>G=>B+C
NH:i:2 HI:i:2 AS:i:94
nM:i:2 Cx:i:8839
Cy:i:7539
UR:Z:120CF
E100026571L1C003R03702347721
0
1
3001778 255
100M
*
0
0
GTATGACATCTGTCCAGGATCTTCTAGCTTTCATAGTCTCTGGTGAGAAGTCTGGAGTAATTCTAATAGGCCTGCATTTATATGTTACTTGACCTTTTTC
EEFEDFFEFFFFEFFFFEC@EFFFFDFFEEFFEFFFFCFCEFFAFBFCED??FGBEFFDC:FFFDCFAF4FAFFDFFDG?DFBD.F@FECA/FEDEFFAA
NH:i:1 HI:i:1 AS:i:92
nM:i:3 Cx:i:12136
Cy:i:14034
UR:Z:C0808

3. TEST DATA DEMONSTRATION

59

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.2 merge
3.2.1 Example of Mapped CID List with Reads Count File
$ head /path/to/output/02.merge/SS200000135TL_D1.merge.barcodeReadsCount.txt
7127
18002
48
4348
19028
1
14130
8635
1
7618
14537
24
4912
10945
5
16783
12914
1
15539
8177
1
9288
8082
14
7274
16533
59
9087
10657
10

3.3 count
3.3.1 Statistical Report for MID Filtering and Gene Annotation
$ cat /path/to/output/03.count/SS200000135TL_D1.Aligned.sortedByCoord.out.merge.q10.dedup.
target.bam.summary.stat
## FILTER & DEDUPLICATION METRICS
TOTAL_READS
PASS_FILTER
ANNOTATED_READS UNIQUE_READS
FAIL_FILTER_RATE
FAIL_ANNOTATE_RATE
DUPLICATION_RATE
733148233
645319822
533743961
108363128
11.98
17.29
79.70
## ANNOTATION METRICS
TOTAL_READS
MAP
EXONIC
INTRONIC
INTERGENIC
TRANSCRIPTOME
ANTISENSE
645319822
645319822
484480416
49263545
111575861
533743961
110185975
100.0
100.0
75.1
7.6
17.3
82.7
17.1

3.3.2 Example of Annotated BAM
$ samtools view /path/to/output/03.count/SS200000135TL_D1.Aligned.sortedByCoord.out.merge.
q10.dedup.target.bam | head -2
E100026571L1C007R00303973559
768
1
3000644 3
100M
*
0
0
GCCTCATTGTGCCCCATATGTTTGCCTATGTTGTGGACTTATTTTCATTAAACTTTAAAACATCTTTAATTTTTTTCTTTATTTCATCATTGACCAAGCT
-FCA9D?GFFD<-D<CGFEGD-DG*FGFDFBE;E(9BGGE38FFFG9GG;0?GGFGB?E@G:GGG3GF79F0GGDG?G<D>F;EG,G?<<CD4>G=>B+C
NH:i:2 HI:i:1 AS:i:94 nM:i:2 Cx:i:8839
Cy:i:7539
UR:Z:120CF
E100026571L1C003R03702347721
0
1
3001778 255
100M
*
0
0
GTATGACATCTGTCCAGGATCTTCTAGCTTTCATAGTCTCTGGTGAGAAGTCTGGAGTAATTCTAATAGGCCTGCATTTATATGTTACTTGACCTTTTTC
EEFEDFFEFFFFEFFFFEC@EFFFFDFFEEFFEFFFFCFCEFFAFBFCED??FGBEFFDC:FFFDCFAF4FAFFDFFDG?DFBD.F@FECA/FEDEFFAA
NH:i:1 HI:i:1 AS:i:92 nM:i:3 Cx:i:12136
Cy:i:14034
UR:Z:C0808
XF:i:2

3. TEST DATA DEMONSTRATION

60

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.3.3 Example of count Gene Expression Matrix
$ h5dump -n /path/to/output/03.count/SS200000135TL_D1.raw.gef
HDF5 “/path/to/output/03.count/SS200000135TL_D1.raw.gef” {
FILE_CONTENTS {
group
/
group
/geneExp
group
/geneExp/bin1
dataset
/geneExp/bin1/exon
dataset
/geneExp/bin1/expression
dataset
/geneExp/bin1/gene
}
}
$ h5dump -d /geneExp/bin1/expression /path/to/output/03.count/SS200000135TL_
D1.raw.gef | head -15
HDF5 “/path/to/output/03.count/SS200000135TL_D1.raw.gef” {
DATASET “/geneExp/bin1/expression” {
DATATYPE H5T_COMPOUND {
H5T_STD_U32LE “x”;
H5T_STD_U32LE “y”;
H5T_STD_U8LE “count”;
}
DATASPACE SIMPLE { ( 76210618 ) / ( 76210618 ) }
DATA {
(0): {
636,
12671,
2
},
(1): {
$ h5dump -d /geneExp/bin1/gene /path/to/output/03.count/SS200000135TL_D1.raw.gef |
head -20
HDF5 “/path/to/output/03.count/SS200000135TL_D1.raw.gef” {
DATASET “/geneExp/bin1/gene” {
DATATYPE H5T_COMPOUND {
H5T_STRING {
STRSIZE 32;
STRPAD H5T_STR_NULLTERM;
CSET H5T_CSET_ASCII;
CTYPE H5T_C_S1;
} “gene”;
H5T_STD_U32LE “offset”;
H5T_STD_U32LE “count”;
}
DATASPACE SIMPLE { ( 24670 ) / ( 24670 ) }
DATA {
(0): {
“0610005C13Rik”,
0,
45
},
(1): {

3. TEST DATA DEMONSTRATION

61

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.3.4 Example of count Sampling File
$ head -8 /path/to/output/03.count/SS200000135TL_D1_raw_barcode_gene_exp.txt
x y geneIndex MIDIndex readCount
9602 7705 10551 611723 2
4888 10392 10551 665954 4
8901 7096 10551 881671 1
8901 7096 10551 357383 20
7397 18783 10551 355789 1
9155 13032 10551 297666 1
9155 13032 10551 298690 1

3.4 register and imageTools
3.4.1 Registered image
File /path/to/output/04.register/ssDNA_fov_stitched_transformed.tif and /path/
to/output/04.register/ssDNA_SS200000135TL_D1_regist.tif.

/path/to/output/04.register/ssDNA_fov_stitched_transformed.tif

/path/to/output/04.register/ssDNA_SS200000135TL_D1_regist.tif

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

62

3.4.2 Image Process Record File
$ h5dump -n /path/to/output/04.register/SS200000135TL_D1_20220527_201353_1.1.0.ipr
HDF5 "/path/to/output/04.register/SS200000135TL_D1_20220527_201353_1.1.0.ipr" {
FILE_CONTENTS {
group
/
group
/ManualState
dataset
/Preview
group
/StereoResepSwitch
group
/ssDNA
group
/ssDNA/CellSeg
dataset
/ssDNA/CellSeg/CellMask
dataset
/ssDNA/CellSeg/CellSegTrace
group
/ssDNA/ImageInfo
dataset
/ssDNA/ImageInfo/RGBScale
group
/ssDNA/QCInfo
group
/ssDNA/QCInfo/CrossPoints
dataset
/ssDNA/QCInfo/CrossPoints/0_0
...
dataset
/ssDNA/QCInfo/CrossPoints/9_8
group
/ssDNA/Register
dataset
/ssDNA/Register/MatrixTemplate
group
/ssDNA/Stitch
group
/ssDNA/Stitch/ScopeStitch
dataset
/ssDNA/Stitch/ScopeStitch/GlobalLoc
dataset
/ssDNA/Stitch/ScopeStitch/ScopeHorizontalJitter
dataset
/ssDNA/Stitch/ScopeStitch/ScopeJitterDiff
dataset
/ssDNA/Stitch/ScopeStitch/ScopeVerticalJitter
group
/ssDNA/Stitch/StitchEval
dataset
/ssDNA/Stitch/StitchEval/GlobalDeviation
dataset
/ssDNA/Stitch/StitchEval/StitchEvalH
dataset
/ssDNA/Stitch/StitchEval/StitchEvalV
dataset
/ssDNA/Stitch/TemplatePoint
dataset
/ssDNA/Stitch/TransformTemplate
group
/ssDNA/TissueSeg
dataset
/ssDNA/TissueSeg/TissueMask
}
}
$ h5dump -A /path/to/output/04.register/SS200000135TL_D1_20220527_201353_1.1.0.ipr
| head -20
HDF5 “/path/to/output/04.register/SS200000135TL_D1_20220527_201353_1.1.0.ipr” {
GROUP "/" {
ATTRIBUTE "IPRVersion" {
DATATYPE H5T_STRING {
STRSIZE H5T_VARIABLE;
STRPAD H5T_STR_NULLTERM;
CSET H5T_CSET_UTF8;
CTYPE H5T_C_S1;
}
DATASPACE SCALAR
DATA {
(0): "0.2.0"
}
}
GROUP "ManualState" {
ATTRIBUTE "cellseg" {
DATATYPE H5T_ENUM {
H5T_STD_I8LE;
"FALSE"
0;
"TRUE"
1;
3. TEST DATA DEMONSTRATION

63

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.4.3 ImageTools merge
Merged image of microscopy image ssDNA_SS200000135TL_D1_regist.tif and tissue segmentation
mask file ssDNA_SS200000135TL_D1_tissue_cut.tif to check tissue segmentation performance.

Part of the merged image of microscopy image ssDNA_SS200000135TL_D1_regist.tif and cell segmentation mask file ssDNA_SS200000135TL_D1_mask.tif to check cell segmentation performance.

3. TEST DATA DEMONSTRATION

64

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.4.4 ImageTools overlay
Stack stitching template onto the ssDNA_fov_stitched_transformed.tif to check the result of
stitching.

Stack registration template onto the ssDNA_SS200000135TL_D1_register.tif to check the result of
registration.

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

65

3.5 tissueCut
3.5.1 Statistical Report for Tissue Covered Region
$ cat /path/to/output/05.tissuecut/tissuecut.stat
# Tissue Statistic Analysis with Stain Image
Contour_area: 87086375
Number_of_DNB_under_tissue: 36521212
Ratio: 41.94%
Total_gene_type: 24289
MID_counts: 89679129
Fraction_MID_in_spots_under_tissue: 82.76%
Reads_under_tissue: 709807297
Fraction_reads_in_spots_under_tissue: 83.99%
binSize=1
Mean_reads_per_spot: 15.10
Median_reads_per_spot: 9.00
Mean_gene_type_per_spot: 1.71
Median_gene_type_per_spot: 1
Mean_Umi_per_spot: 2.46
Median_Umi_per_spot: 2
binSize=20
Mean_reads_per_spot: 3241.11
Median_reads_per_spot: 2782.00
Mean_gene_type_per_spot: 241.08
Median_gene_type_per_spot: 227
Mean_Umi_per_spot: 409.56
Median_Umi_per_spot: 370
binSize=50
Mean_reads_per_spot: 20054.45
Median_reads_per_spot: 18285.00
Mean_gene_type_per_spot: 1165.56
Median_gene_type_per_spot: 1133
Mean_Umi_per_spot: 2534.10
Median_Umi_per_spot: 2346
binSize=100
Mean_reads_per_spot: 78867.48
Median_reads_per_spot: 72545.00
Mean_gene_type_per_spot: 3110.83
Median_gene_type_per_spot: 3117
Mean_Umi_per_spot: 9964.35
Median_Umi_per_spot: 9205
binSize=150
Mean_reads_per_spot: 174614.34
Median_reads_per_spot: 162073.00
Mean_gene_type_per_spot: 4926.51
Median_gene_type_per_spot: 5065
Mean_Umi_per_spot: 22066.71
Median_Umi_per_spot: 20430
binSize=200
Mean_reads_per_spot: 305687.91
Median_reads_per_spot: 285723.00
Mean_gene_type_per_spot: 6424.38
Median_gene_type_per_spot: 6747
Mean_Umi_per_spot: 38621.50
Median_Umi_per_spot: 36060
3. TEST DATA DEMONSTRATION

66

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.5.2 Example of Gene Expression Matrix for Tissue Covered Region

$ h5dump -n /path/to/output/05.tissuecut/SS200000135TL_D1.tissue.gef
HDF5 "/path/to/output/05.tissuecut/SS200000135TL_D1.tissue.gef" {
FILE_CONTENTS {
group
/
group
/geneExp
group
/geneExp/bin1
dataset
/geneExp/bin1/exon
dataset
/geneExp/bin1/expression
dataset
/geneExp/bin1/gene
}
}
$ h5dump -d /geneExp/bin1/expression /path/to/output/05.tissuecut/SS200000135TL_D1.
tissue.gef | head -15
HDF5 "/path/to/output/05.tissuecut/SS200000135TL_D1.tissue.gef" {
DATASET "/geneExp/bin1/expression" {
DATATYPE H5T_COMPOUND {
H5T_STD_U32LE "x";
H5T_STD_U32LE "y";
H5T_STD_U8LE "count";
}
DATASPACE SIMPLE { ( 62542665 ) / ( 62542665 ) }
DATA {
(0): {
6148,
10906,
1
},
(1): {
$ h5dump -d /geneExp/bin1/gene /path/to/output/05.tissuecut/SS200000135TL_D1.tissue.gef | head -20
HDF5 "/path/to/output/05.tissuecut/SS200000135TL_D1.tissue.gef" {
DATASET "/geneExp/bin1/gene" {
DATATYPE H5T_COMPOUND {
H5T_STRING {
STRSIZE 64;
STRPAD H5T_STR_NULLTERM;
CSET H5T_CSET_ASCII;
CTYPE H5T_C_S1;
} "gene";
H5T_STD_U32LE "offset";
H5T_STD_U32LE "count";
}
DATASPACE SIMPLE { ( 24289 ) / ( 24289 ) }
DATA {
(0): {
"0610005C13Rik",
0,
24
},
(1): {

3. TEST DATA DEMONSTRATION

67

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.5.3 Example of Gene Expression Matrix for complete GEF

$ h5dump -n /path/to/output/02.count/SS200000135TL_D1.gef
HDF5 “/path/to/output/05.tissuecut/SS200000135TL_D1.gef” {
FILE_CONTENTS {
group
/
group
/geneExp
group
/geneExp/bin1
dataset
/geneExp/bin1/exon
dataset
/geneExp/bin1/expression
dataset
/geneExp/bin1/gene
group
/geneExp/bin10
dataset
/geneExp/bin10/exon
dataset
/geneExp/bin10/expression
dataset
/geneExp/bin10/gene
group
/geneExp/bin100
dataset
/geneExp/bin100/exon
dataset
/geneExp/bin100/expression
dataset
/geneExp/bin100/gene
group
/geneExp/bin20
dataset
/geneExp/bin20/exon
dataset
/geneExp/bin20/expression
dataset
/geneExp/bin20/gene
group
/geneExp/bin200
dataset
/geneExp/bin200/exon
dataset
/geneExp/bin200/expression
dataset
/geneExp/bin200/gene
group
/geneExp/bin50
dataset
/geneExp/bin50/exon
dataset
/geneExp/bin50/expression
dataset
/geneExp/bin50/gene
group
/geneExp/bin500
dataset
/geneExp/bin500/exon
dataset
/geneExp/bin500/expression
dataset
/geneExp/bin500/gene
group
/stat
dataset
/stat/gene
group
/wholeExp
dataset
/wholeExp/bin1
dataset
/wholeExp/bin10
dataset
/wholeExp/bin100
dataset
/wholeExp/bin20
dataset
/wholeExp/bin200
dataset
/wholeExp/bin50
dataset
/wholeExp/bin500
group
/wholeExpExon
dataset
/wholeExpExon/bin1
dataset
/wholeExpExon/bin10
dataset
/wholeExpExon/bin100
dataset
/wholeExpExon/bin20
dataset
/wholeExpExon/bin200
dataset
/wholeExpExon/bin50
dataset
/wholeExpExon/bin500
}
}

3. TEST DATA DEMONSTRATION

68

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

$ h5dump -d /stat/gene /path/to/output/02.count/SS200000135TL_D1.gef | head -20
HDF5 "/path/to/output/05.tissuecut/SS200000135TL_D1.gef" {
DATASET "/stat/gene" {
DATATYPE H5T_COMPOUND {
H5T_STRING {
STRSIZE 64;
STRPAD H5T_STR_NULLTERM;
CSET H5T_CSET_ASCII;
CTYPE H5T_C_S1;
} "gene";
H5T_STD_U32LE "MIDcount";
H5T_IEEE_F32LE "E10";
}
DATASPACE SIMPLE { ( 24670 ) / ( 24670 ) }
DATA {
(0): {
"Gm42418",
5860952,
60.1028
},
(1): {

3.6 cellCut
3.6.1 Example of Gene Expression Matrix for Cell Bins
$ h5dump -n /path/to/output/051.cellcut/SS200000135TL_D1.cellbin.gef
HDF5 “/path/to/output/051.cellcut/SS200000135TL_D1.cellbin.gef” {
FILE_CONTENTS {
group
/
group
/cellBin
dataset
/cellBin/blockIndex
dataset
/cellBin/blockSize
dataset
/cellBin/cell
dataset
/cellBin/cellBorder
dataset
/cellBin/cellExon
dataset
/cellBin/cellExp
dataset
/cellBin/cellExpExon
dataset
/cellBin/cellTypeList
dataset
/cellBin/gene
dataset
/cellBin/geneExon
dataset
/cellBin/geneExp
dataset
/cellBin/geneExpExon
}
}

3. TEST DATA DEMONSTRATION

69

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

3.7 saturation
3.7.1 Example of Sequence Saturation File
$ cat /path/to/output/07.saturation/sequence_saturation.tsv
sample bar_x
bar_y1 bar_y2 bar_umi bin_x
bin_y1 bin_y2
0.05
26687198
0.250475
1
20002730
0.273744
3030
7041
0.1
53374396
0.389862
1
32565765
0.409615
4045
11464
0.2
106748792
0.542456
1
48842313
0.557064
4962
17194
0.3
160123200
0.625182
1
60017028
0.636707
5435
21128
0.4
213497584
0.677501
1
68852648
0.6871
5778
24238
0.5
266871984
0.713814
1
76374913
0.722081
6052
26886
0.6
320246400
0.740741
1
83026752
0.748035
6234
29228
0.7
373620768
0.761599
1
89071589
0.768155
6381
31356
0.8
426995168
0.778242
1
94689701
0.784222
6528
33334
0.9
480369568
0.79188
1
99974373
0.797395
6639
35194
1
533743961
0.803326
1
104973406
0.808462
6718
36641

bin_umi
26687198
53374396
106748792
160123200
213497584
266871984
320246400
373620768
426995168
480369568
533743961

3.8 report
3.8.1 Example of Statistical Summary Report
$ head /path/to/output/08.report/SS200000135TL_D1.statistics.json
{
"version": "version_v2",
"1.Filter_and_Map": {
"1.1.Adapter_Filter": [
{
"Sample_id": "E100026571_L01_trim_read_1",
"getCIDPositionMap_uniqCIDTypes": "645784920",
"total_reads": "1002214171",
"CID_withN_reads": "8031
(0.00 %)",
"mapped_reads": "845113606
(84.32 %)",

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

70

3.8.2 HTML Report

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

71

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

72

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

73

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

74

3. TEST DATA DEMONSTRATION

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

75

Appendices
Appendix A: Recommended Directory Structure for Raw Data
Recommend to organize raw data as below if users prefer to use SAW shell script provided on the
SAW GitHub page (https://github.com/STOmics/SAW).
$ tree
.
|-- image
|
|-- SS200000135TL_D1_SC_20230822_144400_3.0.0.ipr
|
`-- SS200000135TL_D1_SC_20230822_144400_3.0.0.tar.gz
|-- mask
|
`-- SS200000135TL_D1.barcodeToPos.h5
|-- md5
|-- reads
|
|-- E100026571_L01_trim_read_1.fq.gz
|
`-- E100026571_L01_trim_read_2.fq.gz
`-- reference
|-- STAR_SJ100
|
|-- chrLength.txt
|
|-- chrNameLength.txt
|
|-- chrName.txt
|
|-- chrStart.txt
|
|-- exonGeTrInfo.tab
|
|-- exonInfo.tab
|
|-- FMindex
|
|-- geneInfo.tab
|
|-- Genome
|
|-- genomeParameters.txt
|
|-- SA
|
|-- SAindex
|
|-- SAindexAux
|
|-- sjdbInfo.txt
|
|-- sjdbList.fromGTF.out.tab
|
|-- sjdbList.out.tab
|
`-- transcriptInfo.tab
|-- genes.gtf
`-- genome.fa
5 directories, 25 files

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

76

Appendix B: SAW ST Output File List
STEP

OUTPUT

FILE DESCRIPTION

splitMask

*.SN.barcodeToPos.bin

Split Stereo-seq Chip T mask file according to the CID.

lane.Aligned.
sortedByCoord.out.bam

Binary Alignment/Map file, used for storing the sequence
alignment information.

lane.
barcodeReadsCount.txt

Mapped CID list file with reads counts for each CID, the three columns record x, y, and read count.

lane.Log.final.out

Summary mapping statistics after mapping job is complete (STAR
output)

lane.Log.out

Main log file in STAR mapping (STAR output)

lane.Log.progress.out

Reports job process statistics (STAR output)

lane.SJ.out.tab

Splice junctions detected in the mapping (STAR output)

lane.bcPara

A parameters file defines CID mapping options

lane.CIDMap.stat

Statistical report of CID mapping, such as CID mapped reads
count, reads sequencing quality, mapped DNB count, etc.

lane.run.log

Log file of mapping module.

lane.valid_cid_reads.
fq

Valid CID Reads in FASTQ format after CID mapping. Similar to
SE FASTQ format but with different first row of each read, for instance, "@V350044321L1C001R0020993658|Cx:i:10413|Cy:i:7737
D3450E0D391E EC7FF", where Cx and Cy represent the decoded
coordinates and are added after readID.

lane.unmapped_reads.fq

Un-mapped reads in FASTQ format after mapping Clean Reads
to the reference genome. Similar to SE FASTQ format but with
different first row of each read, for instance, "@V350044321L1C001R0020993658|Cx:i:10413|Cy:i:7737 D3450E0D391E EC7FF",
where Cx and Cy represent the decoded coordinates and are added after readID.

SN.merge.
barcodeReadsCount.txt

Mapped CID list file with reads counts for each CID., the three columns record x, y, and read count.

SN.Aligned.
sortedByCoord.out.
merge.q10.dedup.
target.bam

Annotated BAM file sorted by coordinate, includes uniquely
mapped reads and multi-mapped reads whose HI:i tag is 1.

SN.Aligned.sortedByCoord.out.merge.q10.
dedup.target.bam.csi

Index file of annotated BAM.

SN.Aligned.sortedByCoord.out.merge.q10.dedup.target.bam.summary.
stat

Statistical summary report file for count. Total reads in filter&deduplication metrics stand for the total alignment record count
in BAM. Pass filter and total reads in annotation metrics are the
same, they represent uniquely mapped reads that will be used for
annotation, MID correction and quantification.

SN.raw.gef

Gene expression file in hdf5 format. This is the first raw matrix that
includes the expression information over a complete chip region.
It only includes geneExp group for the bin size of 1. The origin of
expression matrix has been calibrated to (0,0), and the offset x and
y has been record as minX and minY in the attribute of geneExp/
expression dataset.

SN_raw_barcode_gene_
exp.txt

A space-separate file records coordinate, gene, MID, and count
information. Which is prepared to be a sampling file that performs
sequence saturation. The 5 columns are y, x, geneIndex, MIDIndex,
readCount.

count_data_hhmmss.log

Log file.

mapping

merge

count

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

STEP

77

OUTPUT

FILE DESCRIPTION

date-hh-mm-ss.log

Log file.

SN or other user specified name for the
image folder used when
input into ImageQC/ImageStudio

This subdirectory stores raw small image pieces in TIFF format.

SN_0000_0000_YYYY-MMDD_hh-mm-ss-n.tif

Small image pieces in TIFF format.

<stainType>_fov_
stitched_transformed.
rpi

Multiple staining stitched panaromic images (.tif) are stored in RPI
file. The stitched panoramic image that has pre-registered with
the track line pattern template. So that it will not need to further
rotate a non-right angle or scale.

fov_stitched.rpi

Multiple staining stitched panaromic images (.tif) are stored in
RPI file. The stitched panoramic image. It needs to further rotate a
non-right angle or scale.

<stainType>_fov_
stitched_transformed.
tif

The stitched panoramic image from DAPI/IF layers that has
pre-registered with the track line pattern template. So that it will
not need to further rotate a non-right angle or scale.

register&
imageTools <stainType>_fov_
stitched.tif
ipr2img
<stainType>matrix_template.txt

The stitched panoramic image. It needs to further rotate a nonright angle or scale.
Track line cross point template for the registered staining image.
Used for assessing registeration result.

SN_<chipType>date_
time_version.ipr

IPR format image process record file which records basic image
information gathered from ImageQC/ImageStudio.

<stainType>_SN_mask.
tif

Registered cell segmentation binary image file from staining layers
in TIFF format.

<stainType>_SN_regist.
tif

Registered panoramic image file from staining layers in TIFF format.

SN.rpi

Registered panoramic image file, tissue area boundary, and cell
boundaries (downsampled) that stores as an image pyramid.

<stainType>_SN_tissue_
cut.tif

The tissue segmentation result of registered panoramic image file
from staining layers in TIFF format.

<stainType>_transform_
template.txt

Track line cross point template for the <stainType>_fov_stitched_
transformed.tif. Used for assessing stitching result.

SN.gef

A gene expression file in hdf5 format. This file is a complete GEF
format which includes geneExp group and wholeExp group in
bin1, 10, 20, 50, 100, 200, and 500. It also includes a stat group. The
original expression matrix has been calibrated to (0,0), and the offset x and y has been recorded as minX and minY in the attribute of
geneExp/expression dataset.

SN.tissue.gef

A gene expression file in hdf5 format. Tissue GEF includes the expression information of the tissue coverage region. It only includes
geneExp group for the bin size of 1. The origin of expression matrix
has been calibrated to (0,0), and the offset x and y has been record
as minX and minY in the attribute of geneExp/expression dataset
same to raw GEF.

tissueCut

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

STEP

tissueCut

78

OUTPUT

FILE DESCRIPTION

SN.<label>.raw.label.gef

A gene expression file in hdf5 format. It carries the expression
information of the labeled tissue coverage region, with only geneExp group for the bin size of 1. The origin of expression matrix has
been calibrated to (0,0), and the offset x and y has been recorded
as minX and minY in the attribute of geneExp/expression dataset
same to raw GEF.

SN.<label>.label.gef

A gene expression file in hdf5 format. It includes the expression
information of the labeled tissue coverage region, with geneExp
group and wholeExp group in bin1, 10, 20, 50, 100, 200, and 500. It
also includes a stat group. The original expression matrix has been
calibrated to (0,0), and the offset x and y have been recorded as
minX and minY in the attribute of geneExp/expression dataset.

tissue_fig

This directory stores the statistical plots for the tissue coverage
region

scatter_100x100_MID_
gene_counts.png

Scatter plot of MID count and gene types in each bin (bin100)

scatter_150x150_MID_
gene_counts.png

Scatter plot of MID count and gene types in each bin (bin150)

scatter_200x200_MID_
gene_counts.png

Scatter plot of MID count and gene types in each bin (bin200)

scatter_20x20_MID_
gene_counts.png

Scatter plot of MID count and gene types in each bin (bin20)

scatter_50x50_MID_
gene_counts.png

Scatter plot of MID count and gene types in each bin (bin50)

statistic_100x100_MID_
gene_DNB.png

Univariate distribution of MID count, gene types, and DNB numbers with rug along the x axis (bin100)

statistic_150x150_MID_
gene_DNB.png

Univariate distribution of MID count, gene types, and DNB numbers with rug along the x axis (bin150)

statistic_200x200_MID_
gene_DNB.png

Univariate distribution of MID count, gene types, and DNB numbers with rug along the x axis (bin200)

statistic_20x20_MID_
gene_DNB.png

Univariate distribution of MID count, gene types, and DNB numbers with rug along the x axis (bin20)

statistic_50x50_MID_
gene_DNB.png

Univariate distribution of MID count, gene types, and DNB numbers with rug along the x axis (bin50)

violin_100x100_MID_
gene.png

Violin plots show the distribution of deduplicated MID count and
gene types in each bin (bin100)

v i o l i n _ 1 5 0 x 1 5 0 _ M I D _ Violin plots show the distribution of deduplicated MID count and
gene.png
gene types in each bin (bin150)
violin_200x200_MID_
gene.png

Violin plots show the distribution of deduplicated MID count and
gene types in each bin (bin200)

violin_20x20_MID_gene.
png

Violin plots show the distribution of deduplicated MID count and
gene types in each bin (bin20)

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

STEP

cellCut

OUTPUT

FILE DESCRIPTION

violin_50x50_MID_gene.
png

Violin plots show the distribution of deduplicated MID count and
gene types in each bin (bin50)

tissuecut.stat

Statistical report for tissue coverage region.

<label>.tissuecut.stat

Statistical report for labeling coverage region.

SN.cellbin.gef

A gene expression file for cells in hdf5 format. Cellbin GEF includes
the expression information of the cells, such as the coordinate of
the centroid, boundary coordinates, expression of genes, and cell
area. The cell is recorded by its boundary. The origin of expression
matrix has been calibrated to (0,0), and the coordinate offset x and
y have been recorded as offsetX and offsetY in the attribute of the
GEF file, the same as minX and minY in the raw GEF file.

SN.adjusted.cellbin.gef

Cellbin GEF generated from adjusted cell segmentation TIFF image
and *.raw.gef.

cellCorrect SN.adjusted.gem
<stainType>_SN_mask_
edm_dis_10.tif
spatialCluster
cellCluster

saturation

report

79

Cellbin GEM generated from adjusted cell segmentation TIFF image
and *.raw.gef.
Adjusted cell segmentation binary image in TIFF format.

SN.bin200_1.0.spatial.
cluster.h5ad

H5AD file for spatial clustering analysis result.

SN.cell.cluster.h5ad

H5AD file for cell clustering analysis result.

SN.adjusted.cell.
cluster.h5ad

H5AD file for cell clustering analysis result, based on adjusted
Cellbin GEF.

plot_1x1_saturation.
png

Sequencing saturation analysis plots for bin1. Calculated by 1(unique reads/total reads) for each bin (bin1).

plot_200x200_saturation.png

Sequencing saturation analysis plots for bin200. Calculated by 1(unique reads/total reads) for each bin (bin1).

sequence_saturation.
tsv

Sequence saturation file. The nine colums are sampling component (#sample), bin1 total reads (bar_x), sequence saturation value
at bin1 (bar_y1), median gene count at bin1 (bar_y2), unique reads
at bin1 (bar_umi), bin200 total reads (bin_x), sequence saturation
value at bin200 (bin_y1), median gene count at bin200 (bin_y2),
and unique reads at bin200 (bin_umi), respectively.

SN.report.html

HTML analytical report.

SN.statistics.json

Statistical summary report in JSON format. It gathers all important
statistical metrics from the statistical report in each step.

scatter_1x1_MID_gene_
counts.png

Scatter plot of MID count and gene types in each cell.

statistic_1x1_cell_
area.png

Univariate distribution of cell area with rug along the x axis of each
cell.

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

STEP

80

OUTPUT

FILE DESCRIPTION

statistic_1x1_DNB.png

Univariate distribution of DNB numbers with rug along the x axis of
each cell.

statistic_1x1_gene.png

Univariate distribution of gene types with rug along the x axis of
each cell.

statistic_1x1_MID.png

Univariate distribution of MID count with rug along the x axis of
each cell.

violin_1x1_gene.png

Violin plots show the distribution of gene types in each cell.

violin_1x1_MID.png

Violin plots show the distribution of deduplicated MID count in
each cell.

Appendix C: Handling Errors and Exceptions
Common Errors
•

File access error:
Some examples of file access error:
terminate called after throwing an instance of ‘std::invalid_argument’
what(): Could not open the file: xxxxxx
...

Or
#006: H5FDsec2.c line 352 in H5FD__sec2_open(): unable to open file: name = ‘/path/
to/hdf5/file’, errno = 2, error message = ‘No such file or directory’, flags = 0,
o_flags = 0
...

major: File accessibility
minor: Unable to open file

Solution:
# Attempt 1: Bind file path before execute command.

$ export SINGULARITY_BIND=”/path/to/file/directory”

# Attempt 2: Turn off the HDF5 lock on the file by running the command below before
running SAW.
$ export HDF5_USE_FILE_LOCKING=FALSE

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

81

mapping
•

readNameSeparator error:

EXITING: FATAL INPUT ERROR: empty value for parameter “readNameSeparator” in input
“Command-Line”
SOLUTION: use non-empty value for this parameter

try to delete --readNameSeparator \” \” from the command.
•

limitBAMsortRAM error:

Error code: SAW-A10183
EXITING because of fatal ERROR: not enough memory for BAM sorting:
SOLUTION: re-run STAR with at least –limitBAMsortRAM xxxxxxxxx

Modify the value specified by the --limitBAMsortRAM refer to the SOLUTION in the stderr.
•

limitOutSJcollapsed error:

Error code: SAW-A10182
EXITING because of fatal error: buffer size of SJ output is too small
Solution: increase input parameter --limitOutSJcollapsed

the parameters --limitOutSJcollapsed and --limitIObufferSize are paired.
Please replace them with --limitOutSJcollapsed 10000000 --limitIObufferSize=480000000 and try again.

imageTools
•

OSError raises for imageTools merge

OSError: [Errno 30] Read-only file system: ‘/opt/saw_v5.4.0_software/pipeline/imageTools/imagetools-1.0.0/log’

Error raises because the -o input is a filename without path. Try to input /path/to/output/file.
rpi or ./file.rpi for -o.

82

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Appendix D: Error Codes
SAW error codes are designed to catch error information and describe it in an easily understood way. Users can use these messages to fix the problem by themselves.
The error messages will be output to the "errcode.log" file.
The error code is designed to express in three parts, date-time, error code, and explanation. The date-time information could help users differentiate errors in different program executions. The error code part provides information for the pipeline modules and error types. The explanation section displays the most explicit
message stating the error/exception and possible solutions.

PIPELINE

splitMask

CIDCount

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A00001

Parameters invalid or missing

e.g. "parameters error"
Please check your input parameters. Some required parameters might be missed.
e.g. "splitBcPos error, expected 1_24 or 2_25"
Please check your input CID position is either 1_24 or 2_25.

SAW-A00002

File open failed

Please check the input file exists and has the correct access permission.

SAW-A00003

File parse failed

e.g. "only support .bin or .h5 file."
Please check your input file is in the correct file format.

SAW-A00004

Other IO API error

e.g. "cannot write to file, /path/to/file"
Please check your output directory path is an existing path.

SAW-A00021

Parameters invalid or missing

Please check your input parameters. Some required parameters might be missed.

SAW-A00022

File open failed

e.g. "cannot open such file, /path/to/file"
Please check the input file exists and has the correct access permission.

SAW-A00023

Failed to parser the file

Please check your input file is in the correct file format.

SAW-A00024

Other API error

Please check Appendix C or contact FAS/FBS for help.

SAW-A00025

Software exception

Please check Appendix C or contact FAS/FBS for help.

83

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

Parameters invalid or missing

e.g. "EXITING: FATAL INPUT ERROR: unrecognized parameter name "outSAMattribute" in
input "Command-Line-Initial""
Please check the spelling of your argument and parameters.
e.g. "please check the umi position and length"
Please check the length of the reads in FQ1 are consistent with the parameters set for barcode length and umi length. For example, the length of the sum of barcode and umi set in
bcPara file is 35 bp, but one of the reads in FQ1 is 30 bp, then you will see A10101 error code.
Please check the parameters set in the bcPara file are consistent with your FQs.

SAW-A10102

File open failed

e.g. "Error, cannot open the file which be expected in gz or ascii format"
Please check the file permission and file format.
e.g. "barcodePositionMapFile does not exists: /path/to/mask"
Please check the mask file exists and has the correct access permission.

SAW-A10103

File parse failed

e.g. "sequence and quality have different length"
Please check the completeness of the reads in FQ. This issue may arise if the FQs are in
incorrect format or the file was incompletely written or transferred.

SAW-A10104

Invalid data or data exception

Error data. Please check the file format and content.

SAW-A10105

File deletion failed

This error arose if "_STARtmp" directory failed to be deleted. Please check whether the program has completely finished according to the *.Log.progress.out or *.run.log file.

SAW-A10106

File IO failed

Please contact FAS/FBS for help.

SAW-A10107

Failure on APIs of system and
libraries

Please contact FAS/FBS for help.

SAW-A10108

Software assert

Please contact FAS/FBS for help.

SAW-A10109

Software exception

Please contact FAS/FBS for help.

SAW-A10110

Allocate memory error

This error occurs when you run out of RAM. You may need to kill some jobs that use the
same RAM or upgrade your hardware to get more RAM resources for your job.

SAW-A10101

mapping

84

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

mapping

count

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A10111

Out of disk space

This error occurs when you store too many files on your hard disk. Please remove some files
to free disk space.

SAW-A10200

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A10201

CID comparison rate is too low

This error usually arises because the CID information of the input FQs is not the same as the
CID in the input mask file. Please use the correct SN-FQ pairs for mapping.

SAW-A10202

Fail to create the index for the
BAM file

Please contact FAS/FBS for help.

SAW-A10300

Fail to load indexed reference

Please check the existence, access permission, and completeness for the indexed reference.

SAW-A10301

STAR parameter missing

Please check whether basic STAR parameters have been set.

SAW-A20001

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A20002

File open failed

Please check the input file exists and has the correct access permission.

SAW-A20003

File parse failed

Please check your input BAM header is in the correct file format.

SAW-A20004

Allocate memory error

This error occurs when you run out of RAM. You may need to kill some jobs that use the
same RAM or upgrade your hardware to get more RAM resources for your job.

SAW-A20005

File parse failed

e.g. "Found <number> gene names with their length exceeding 64 characters"
Please check gene names in your input GTF/GFF file.

SAW-A20101

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A20102

File open failed

Please check the file that exists and has the correct access permission.

SAW-A20103

File parse failed

Please check your input file has a valid column number.

SAW-A20105

File parse failed

e.g. "Found <number> gene names with their length exceeding 64 characters"
Please check gene names in your input GTF/GFF file.

85

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

merge

register

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A30001

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A30002

File open failed

Please check the input file exists and has the correct access permission.

SAW-A30003

File parse failed

Please check your mask file is in the correct file format. Only support .h5/.bin mask file.

SAW-A30004

Allocate memory error

Please check whether the range of the coordinates is too large, or you have run out of RAM.
You may need to kill some jobs that use the same RAM or upgrade your hardware to get
more RAM resources for your job.

SAW-A30005

Fail to open input file

Fail to open input TXT file. Please check the file that exists and have the correct access permission.

SAW-A40001

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A40002

File open failed

Please check the input file that exists and has the correct access permission. Or, please
check whether a stitched panoramic TIFF (.tif or .tiff) image exists in the TAR.GZ.

SAW-A40003

File parse failed

Please check your input file is in the correct file format. The -v input gene expression matrix
should be either a *tsv, barcode_gene_exp.txt, *.gem.gz, or *raw.gef.

SAW-A40004

Invalid data or data exception

Error data. Please check the file content. This error may arise because the -v input file is
empty, the CZI file in TAR.GZ is invalid, or the QCPassFlag in IPR is 0.

SAW-A40005

Tissue segmentation error

Abnormal tissue segmentation reference score in image preprocessing.

SAW-A40006

IPR field missing

"Stitch/BGIStitch/StitchedGlobalLoc", does not exist.

SAW-A40007

Tiled image missing

Please check the uncompressed image folder has tiled images.

SAW-A40008

Insufficient GPU memory

GPU resources in the current node are insufficient. Please redeliver the task on an adequate
one.

86

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

register

SAW-A40009

Abnormal chip SN prefix

Check "ImageInfo -> STOmicsChipSN" in.ipr where it offers the information of chip SN prefix.

SAW-A40401

Parameter missing

Please check your imageTools merge input parameters. Some required parameters
might be missed.

SAW-A40402

File open failed

Please check the imageTools merge input file that exists and has the correct access
permission.

SAW-A40405

Invalid input

imageTools merge inputs of less than two images or more than three images.

SAW-A40406

File pairing failed

Please check the imageTools merge input TIFF sizes are the same. Since the merge
function is used for evaluating segmentation results, the input images are supposed to be
the same in size and position (tissue position in the whole image).

SAW-A40501

Parameter missing

Please check your imageTools overlay input parameters. Some required parameters
might be missed.

File open failed

Please check the imageTools overlay input file that exists and has the correct access
permission.

SAW-A40504

Invalid data or data exception

Error data. Please check the file content. This error may arise because the -c input IPR file
does not include Stitch/TransformTemplate or Register/MatrixTemplate information.

SAW-A40601

Parameter missing

Please check your imageTools img2rpi input parameters. Some required parameters
might be missed.

SAW-A40602

File open failed

Please check the imageTools img2rpi input file that exists and has the correct access
permission.

SAW-A40605

Invalid input

imageTools img2rpi input -i and -g have different length. These two inputs are supposed to be paired.

SAW-A40701

Parameter missing

Please check your imageTools ipr2img input parameters. Some required parameters
might be missed.

imageTools SAW-A40502

87

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A40702

File open failed

Please check the imageTools ipr2img input file exists and has the correct access permission. Or, please check whether a stitched panoramic TIFF (.tif or .tiff) image exists in the
TAR.GZ.

SAW-A40703

File parse failed

Please check your imageTools ipr2img input file is in the ImageQC/ImageStudio output TAR.GZ format.

SAW-A40704

Invalid data or data exception

Error data. Please check the imageTools ipr2img input IPR file content.
This error may arise because the CZI file in TAR.GZ is invalid, or the image has not either
automatically or manually registered with the expression matrix. The second circumstance
can be confirmed from IPR by checking whether the StereoResepSwitch/register is TRUE (has
not performed automatic registration) or the ManualState/register is FALSE (has not performed manual registration). The third possible reason is the StereoResepSwitch/tissueseg
is TRUE, therefore cannot output cell segmentation result.

SAW-A40706

File pairing failed

Please check the shape of registered tissue segmentation images stored in the imageTools ipr2img input IPR are the same. Or please contact FAS/FBS for help.

SAW-A50001

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A50002

File open failed

Please check the file that exists and has the correct access permission.

SAW-A50003

File parse failed

Please check your input file is in the correct file format.

SAW-A50004

Fail to create output file

Fail to create output file. Please check your writing permission of the output directory.

SAW-A50005

Fail to write TIFF

Fail to write a TIFF file.

SAW-A50006

h5AttrWrite error

Please check the H5 file attributes.

SAW-A50007

h5DatasetWrite error

Please check the H5 file dataset.

SAW-A50008

Fail to create TIFF

Please check the access permission to write a TIFF image.

SAW-A50009

Different sizes between TIFF
and GEF

Please check the sizes of the TIFF image and GEF (gene expression matrix) respectively.
Make sure they are the same size.

SAW-A50010

Allocate memory error

This error occurs when you run out of RAM. You may need to kill some jobs that use the
same RAM or upgrade your hardware to get more RAM resources for your job.

imageTools

tissueCut

88

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

cellCut

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A60001

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A60002

File open failed

Please check the file that exists and has the correct access permission.

SAW-A60003

File parse failed

The file does not contain correct information. Please check the file format.

SAW-A60110

Program version error

Please check your output GEF version. Your input GEF version might be too old.

SAW-A60111

Call process error

e.g. "Please call freeRestriction first, or call restrictRegion function before restrictGene."
This error arose because the invocation flow order was messed up. Please modify your
invocation flow as prompted.

SAW-A60120

Invalid data or data exception

Error data. Please check the file content.

SAW-A60121

File information missing

Failed to read the file. Please check whether the file is damaged.

SAW-A60122

File pairing failed

Please check the TIFF mask size is consistent with the size of expression matrix. Since the
mask has been registered with the expression matrix, their sizes are supposed to be the
same.

SAW-A60130

Fail to create output file

Fail to create output H5 file. Please check your writing permission of the output directory or
contact FAS/FBS for help.

SAW-A60140

Allocate memory error

This error occurs when you run out of RAM. You may need to kill some jobs that use the
same RAM or upgrade your hardware to get more RAM resources for your job.

SAW-A60150

Dimensions of gene expression
matrix did not match

Please contact FAS/FBS for help.

89

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A70001

Parameter missing

e.g. "-i or --gef_file is missing"
Please check your input parameters. Some required parameters might be missed.

SAW-A70002

File open failed

e.g. “cannot access /path/to/file: No such file or directory.”
Please check the file that exists and has the correct access permission.

SAW-A70005

Value error

e.g. "The bin size is out of range, please check the range of gef binsize is in
[1,10,20,50,100,200,500]."
Please reset the bin size as prompted.
e.g. "Gene number less than 3000, please check your gef file"
Please check the content of your GEF file, and make sure there are at least 3000 genes for
clustering.

SAW-A70101

Parameter missing

e.g. "-i or --gef_file is missing"
Please check your input parameters. Some required parameters might be missed.

SAW-A70102

File open failed

e.g. “cannot access /path/to/file: No such file or directory.”
Please check the file that exists and has the correct access permission.

Value error

e.g. "The bin size is out of range, please check the range of gef binsize is in
[1,10,20,50,100,200,500]."
Please reset the bin size as prompted.
e.g. "Gene number less than 3000, please check your gef file"
Please check the content of your GEF file, and make sure there are at least 3000 genes for
clustering.

spatialCluster

cellCluster
SAW-A70105

90

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

saturation

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A80001

Parameter missing

e.g. "-i is missing."
Please check your input parameters. Some required parameters might be missed.

SAW-A80002

File open failed

Please check the file that exists and has the correct access permission.

SAW-A80003

File parse failed

Invalid GEF file. Please check the file format.

SAW-A80004

Invalid data or data exception

e.g. "no data left after filter by coordinates."
Please check the file content.

SAW-A80005

Invalid data or data exception

e.g. "total map reads is 0, please check file format from --bcstat"
Please check the file content of the input file as prompted.

SAW-A80006

File pairing failed

e.g. "map reads less than annotated reads."
Please check the input mapping statistical report and the count statistical report are
from the same analysis.

SAW-A80007

Plot error

Please contact FAS/FBS for help. PATH environment may not have python3.

SAW-A80008

Fail to create output

Fail to generate saturation file, please contact FAS/FBS for help.

91

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A90001

Parameter missing

e.g. "-m or --barcodeMapStat is missing."
Please check your input parameter as prompted. Some required parameters might be
missed.

SAW-A90002

File open failed

e.g. "cannot access *: No such file or directory."
Please check the file that exists and has the correct access permission.

SAW-A90003

File parse failed

JSON file format error. This error may arise because the input statistics files were not generated in the same SAW version as report. Or, the input mapping file prefix can not be
parsed. Please contact FAS/FBS for help.

SAW-A90004

Invalid data or data exception

e.g."information loss: fail to find 'bin_[size]' or 'ssDNA' in '*.rpi'."
Please check the file content.

SAW-A90005

Fail to create output file

Fail to create output file. Please check your writing permission of the output directory.

SAW-A40801

Parameter missing

Please check your input parameters. Some required parameters might be missed.

SAW-A40802

File open failed

Please check the file that exists and has the correct access permission. Or, please check
whether the pre-registered image fov_stitched_transformed.tif exists in the input directory.

manualRegSAW-A40803
ister

File parse failed

Please check your input file is in the correct file format. The -v input gene expression matrix
should be either a *tsv, barcode_gene_exp.txt, *.gem.gz, or *raw.gef.

Invalid data or data exception

Error data. Please check the file content. This error may arise because the -v input file is
empty. The second possible reason is that the gene expression matrix information in the
IPR Register module (MatrixShape, Xstart, Ystart) does not match with the input GEF file
(minX, minY, maxX, maxY), because the manual registration has to be processed on the
identical matrix.

report

SAW-A40804

92

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

PIPELINE

CODE

ERROR TYPE

EXAMPLES AND ERROR HANDLING

SAW-A13001

GEF parse failed

e.g. "-i parameter is invalid, please check your input."
Please check the path or file format of GEF.

SAW-A13002

TIFF parse failed

e.g. "-m parameter is invalid, please check your input."
Please check the path or size of TIFF image.

Fail to create output

e.g. "-o parameter is invalid, please check your input."
Please check the access permission to write files or whether the output directory exists.

cellCorrect SAW-A13003

lasso

e.g. "-d parameter exceeds the range of adjusting distance."

SAW-A13004

Invalid adjusting distance

SAW-A00031

Parameters invalid or missing

e.g. "-i/-o/-m/-n is missing"
Please check your input parameters. Some required parameters might be missed.

SAW-A00032

File open failed

e.g. "cannot access *: No such file or directory."
Please check the file that exists and has the correct access permission.

SAW-A00033

File parse failed

Ee.g. "file type error: * is not GEF/GEOJSON file."
Invalid file. Please check the file format.

Please check whether the adjusting distance is in a proper and reasonable range.

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

93

References
1.

STOmics/SAW. Accessed April 17, 2023. https://github.com/STOmics/SAW

2.

Chen A, Liao S, Cheng M, et al. Large field of view-spatially resolved transcriptomics at
nanoscale resolution Short title: DNA nanoball stereo-sequencing. bioRxiv. Published online
January 24, 2021:2021.01.17.427004. doi:10.1101/2021.01.17.427004

3.

Cock PJA, Fields CJ, Goto N, Heuer ML, Rice PM. The Sanger FASTQ file format for sequences with quality scores, and the Solexa/Illumina FASTQ variants. Nucleic Acids Res.
2009;38(6):1767-1771. doi:10.1093/nar/gkp1137

4.

Archives SR, Sra T, Nucleotide I, et al. File Format Guide 1. Published online 2009:1-11. Accessed May 21, 2021. https://www.ncbi.nlm.nih.gov/sra/docs/submitformats/

5.

Merkel D. Docker: lightweight Linux containers for consistent development and deployment.

Linux J. 2014;2014(239):2. Accessed October 15, 2021. https://www.linuxjournal.com/content/
docker-lightweight-linux-containers-consistent-development-and-deployment
6.

Kurtzer GM, Sochat V, Bauer MW. Singularity: Scientific containers for mobility of compute.

PLoS One. 2017;12(5):e0177459. doi:10.1371/journal.pone.0177459
7.

Sequence Alignment/Map Format Specification. Accessed May 21, 2021. https://github.com/
samtools/hts-specs.

8.

Dobin A, Davis CA, Schlesinger F, et al. STAR: Ultrafast universal RNA-seq aligner. Bioinformat-

ics. 2013;29(1):15-21. doi:10.1093/bioinformatics/bts635
9.

Ensembl. GFF/GTF File Format. Published 2020. Accessed May 27, 2021. http://www.ensembl.
org/info/website/upload/gff.html?redirect=no

10.

GFF2 - GMOD. Accessed May 27, 2021. http://gmod.org/wiki/GFF2

11.

STOmics/Stereopy: Spatial Transcriptomics Analysis in Python. Accessed May 15, 2023.
https://github.com/STOmics/Stereopy

12.

STOmics/geftools: Tools for manipulating GEFs. Accessed May 30, 2023. https://github.com/
STOmics/geftools

13.

STOmics/gefpy: gef io, draw out from Stereopy. Accessed May 30, 2023. https://github.com/
STOmics/gefpy

STEREO-SEQ ANALYSIS WORKFLOW SOFTWARE SUITE USER MANUAL

Contact Us
Beijing Genomics Institute (Shenzhen)
https://en.stomics.tech
Email: info_global@stomics.tech
Please raise GitHub issues for reporting bugs and requesting features:
SAW GitHub Issue Page: https://github.com/STOmics/SAW/issues

94

x.comSTOmics - YouTube
About
Press
Copyright
Contact us
Creators
Advertise
Developers
Terms
Privacy
Policy & Safety
How YouTube works
Test new features
NFL Sunday Ticket
© 2025 Google LLCStereo-seq OMNI for FFPE solution - STOmics
STOmics
STOmics
STOmics
Why Stereo-seq
Products
STOmics Solutions
Stereo-seq Solutions
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-CITE Solution
Stereo-seq OMNI Solution
STOmics Software
Stereo-seq Analysis Workflow
StereoMap
Help Center
Applications
Research Areas
Development Research
Organ Research
Evolution Research
Disease Research
Publications
STOmics Grant
Resources
Resources
Documents
Videos
Publications
STOmics Validated Tissue List
Demo Data
FAQ
STOmics Datasets
Software Archives
Certified Service Provider
About CSP program
STOmics CSP
News
STOmics Events
Conference
Webinar
Seminar
STOmics News
About
About STOmics
STOmics introduction
Milestones
Contact Us
Login
Sign up
Mission
Mission
zhangjiaqi@genomics.cn
Personal information
Change password
Log out
EN
CN
All
Products
Resources
News
FAQ
Search
Stereo-seq OMNI for FFPE Solution
Release all spatial information of your FFPE samples with our revolutionary solution.
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-seq OMNI for FFPE Solution
Release all spatial information of your FFPE samples with our revolutionary solution.
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-seq OMNI for FFPE Solution
Release all spatial information of your FFPE samples with our revolutionary solution.
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
STOmics
>
Products
>
STOmics Solutions
>
Stereo-seq Solutions
Solution Overview
Product Highlight
Workflow
Tissue to Data End-to-end Solution
Stereo-seq Kit Solutions
Stereo-seq OMNI Product Flyer
Stereo-seq OMNI Experiment Checklist
Sample preparation Guide for Stereo-seq OMNI
Stereo-seq OMNI Transcript Set User Manual
Stereo-seq OMNI Library Preparation User Manual
Solution Overview
Stereo-seq OMNI, a revolutionary sequencing-based spatial transcriptomics solution to study your FFPE samples.
Stereo-seq OMNI provides true spatial single-cell total RNA information with accuracy and precision with the innovative 'Random Probe' design. Covering a continuous tissue area of 10mm by 10mm, Stereo-seq OMNI delivers best-in-class data and bioinformatics workflow for analyzing spatial total RNA information.
Product Highlight
True single-cell level gene expression profiling combined with histology study
Species agnostic, enabling the study of host-microorganism interactions with spatial context
Random probe design for efficient total RNA capturing
Compatible with low-quality samples (DV200 > 30%)
Workflow
Demo Results
Exploring true spatial single-cell total RNA information
with Stereo-seq OMNI
Mouse lung H&E Image
Capture area size: 1 cm x 1cm
Mouse lung Bin50 gene expression heatmap
Capture area size: 1 cm x 1cm
Staining method: H&E staining
Mycobacterium tuberculosis (Mtb) infected mouse lung Bin50 gene expression heatmap
Capture area size: 1 cm x 1cm
Staining method: H&E staining
Mouse brain H&E Image
Capture area size: 1 cm x 1cm
Mouse brain Bin50 gene expression heatmap
Capture area size: 1 cm x 1cm
Staining method: H&E staining
Mouse brain Bin200 clustering
Capture area size: 1 cm x 1cm
Staining method: H&E staining
Mouse brain nucleus staining Image
Capture area size: 1 cm x 1cm
Mouse brain Bin20 gene expression heatmap
Capture area size: 1 cm x 1cm
Staining method: Nucleus staining
Mouse brain single-cell clustering (cellbin)
Capture area size: 1 cm x 1cm
Staining method: Nucleus staining
Mouse brain H&E Image
Capture area size: 1 cm x 1cm
Mouse brain Bin50 gene expression heatmap
Capture area size: 1 cm x 1cm
Staining method: H&E staining
Mouse brain Bin200 clustering
Capture area size: 1 cm x 1cm
Staining method: H&E staining
Perform Stereo-seq OMNI in your own laboratory
Reach out to Us
Discover the power of Stereo-seq
Contact
时空组学英文紫
SOCIAL
Twitter
Linkedin
Youtube
LINKS
Complete Genomics
MGI
SOCIAL
Twitter
Linkedin
Youtube
SUBSCRIBE FOR PRODUCT AND EVENT UPDATES
Submit
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
The website uses cookies
We use cookies to make sure that the website works well for you. By clicking on the "I accept recommended cookies" button you agree to our use of cookies. Read more about our
cookie policy
.
I accept the recommended cookiesSTOmics Stereo-seq | Advanced Spatial Multi-omics Technology
STOmics
STOmics
STOmics
Why Stereo-seq
Products
STOmics Solutions
Stereo-seq Solutions
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-CITE Solution
Stereo-seq OMNI Solution
STOmics Software
Stereo-seq Analysis Workflow
StereoMap
Help Center
Applications
Research Areas
Development Research
Organ Research
Evolution Research
Disease Research
Publications
STOmics Grant
Resources
Resources
Documents
Videos
Publications
STOmics Validated Tissue List
Demo Data
FAQ
STOmics Datasets
Software Archives
Certified Service Provider
About CSP program
STOmics CSP
News
STOmics Events
Conference
Webinar
Seminar
STOmics News
About
About STOmics
STOmics introduction
Milestones
Contact Us
Login
Sign up
Mission
Mission
zhangjiaqi@genomics.cn
Personal information
Change password
Log out
EN
CN
All
Products
Resources
News
FAQ
Search
Stereo-CITE Proteo-Transcriptomics Solution
A powerful solution for multi-omic study with a true single-cell resolution and whole transcriptome profiling
More
Stereo-seq OMNI for FFPE Solution
A revolutionary spatial whole transcriptomics solution
for FFPE samples across species
More
Get A Taste For Greater Possibility
Stereo-seq Transcriptomics Set for Large Chip Designs
More
STOmics Validated Tissue List
Nearly one hundred samples validated on Stereo-seq
More
STOmics Certified Service Provider Program
Become a STOmics service provider to provide cutting edge spatial solutions to your scientific partners
More
Stereo-seq Transcriptomics Solution v1.3
Level-up Spatial Whole Transcriptome Solution
More
Higher resolution
Stereo-seq achieves a nanoscale resolution of 500 nm, which enables spatial localization and identification of single-cell and their molecular information.
Larger FOV
The standard chip size for Stereo-seq is 1 cm*1 cm and can be expanded up to 13 cm*13 cm.
Customization
Stereo-seq supports customizing chips of different sizes according to tissue size, providing more options for your research.
Higher resolution
Larger FOV
Customization
STOmics Solution
STOmics Software
Transcriptomics Solution
Transcriptomics Solution
More
Stereo-seq OMNI Solution
Stereo-seq OMNI Solution
More
Certified Service Provider
Certified Service Provider
More
Stereo-seq Analysis Workflow (SAW)
Stereo-seq Analysis Workflow (SAW)
More
StereoMap
StereoMap
More
Applications
Publications
Development Research
Life development is a dynamic process in which multiple cell types interact with each other in a three-dimensional space. Therefore, spatial analysis of cell types and their interactions is the basis of developmental research.
More
Organ Research
Spatial transcriptome technology can bring profound changes to the physiological functions of organs and related diseases.
More
Evolution Research
Utilizing spatial transcriptome to map the structure and development of the same organ...
More
Disease Research
Spatial transcriptome technology can map tumor cell heterogeneity and microenvironment structure at the molecular level, bringing significant breakthroughs in tumor research.
More
2022.05.12
Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays
More
2022.09.02
Single-cell Stereo-seq reveals Induced progenitor cells involved in Axolotl brain regeneration
More
2022.09.21
A cellular hierarchy in melanoma uncouples growth and metastasis
More
2022.05.23
The single-cell stereo-seq reveals region-specific cell subtypes and transcriptome profiling in Arabidopsis leaves
More
STOmics News
More
18/04/2024
Beat the rush: Early bird special offer for STOmics Stereo-seq OMNI
12/07/2023
International Scientists Release Most Complete Primate Brain Cell Atlas to Date
17/06/2023
Science cover! Scientists build world's first spatio-temporal atlas of brain regeneration by STOmics Stereo-seq
STOmics Events
More
05/11/2023
Join us at Spatial Biology Congress Asia in Singapore
More
10/07/2023
Special Seminar on STOmics Spatial Technology
More
14/01/2023
Join Stereo-seq Workshop at PAG30 in San Diego
The first time to introduce Stereo-seq at the International Plant & Animal Genome Conference (PAG)! Please join our workshop in the Bioactive, Nutraceutical and Therapeutic Molecules in Plants session.
More
STOmics Stereo-seq
Independently developed by STOmics, Stereo-seq technology is the one and only spatial-omics technology in the world that could achieve both centimeter level panoramic field of view and subcellular resolution. Ever since its release in the early 2021, it has drawn extensive attention around the globe and was praised as 'the thunderclap in the academia', bringing life science research into a new era of time and space while ushering in the third revolution in the field of life sciences.
STOmics Stereo-seq
Independently developed by STOmics, Stereo-seq technology is the one and only spatial-omics technology in the world that could achieve both centimeter level panoramic field of view and subcellular resolution. Ever since its release in the early 2021, it has drawn extensive attention around the globe and was praised as 'the thunderclap in the academia', bringing life science research into a new era of time and space while ushering in the third revolution in the field of life sciences.
More
时空组学英文紫
SOCIAL
Twitter
Linkedin
Youtube
LINKS
Complete Genomics
MGI
SOCIAL
Twitter
Linkedin
Youtube
SUBSCRIBE FOR PRODUCT AND EVENT UPDATES
Submit
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
The website uses cookies
We use cookies to make sure that the website works well for you. By clicking on the "I accept recommended cookies" button you agree to our use of cookies. Read more about our
cookie policy
.
I accept the recommended cookies
时空组学英文紫
SOCIAL
Twitter
Linkedin
Youtube
LINKS
Complete Genomics
MGI
SOCIAL
Twitter
Linkedin
Youtube
SUBSCRIBE FOR PRODUCT AND EVENT UPDATES
Submit
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
The website uses cookies
We use cookies to make sure that the website works well for you. By clicking on the "I accept recommended cookies" button you agree to our use of cookies. Read more about our
cookie policy
.
I accept the recommended cookiesVersion Description - STOmics
STOmics
STOmics
STOmics
Why Stereo-seq
Products
STOmics Solutions
Stereo-seq Solutions
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-CITE Solution
Stereo-seq OMNI Solution
STOmics Software
Stereo-seq Analysis Workflow
StereoMap
Help Center
Applications
Research Areas
Development Research
Organ Research
Evolution Research
Disease Research
Publications
STOmics Grant
Resources
Resources
Documents
Videos
Publications
STOmics Validated Tissue List
Demo Data
FAQ
STOmics Datasets
Software Archives
Certified Service Provider
About CSP program
STOmics CSP
News
STOmics Events
Conference
Webinar
Seminar
STOmics News
About
About STOmics
STOmics introduction
Milestones
Contact Us
Login
Sign up
Mission
Mission
zhangjiaqi@genomics.cn
Personal information
Change password
Log out
EN
CN
All
Products
Resources
News
FAQ
Search
SAW Software Operation Manual
搜 索
SAW operation manual
7.0
7.0
6.0
5.5.3
Version Description
Background
Downloadable materials
SAW installation and startup
Display of test data results
SAW process operation introduction
Appendices and References
Version Description
Revision History
Manual Version
Software Version
Date
Description
A0
V1.0.0
Nov. 2021
Initial release.
A1
V2.1.0
Dec. 2021
New feature: addition of manual
                                        registration function, some fine-tuning
                                        will be automatically performed after
                                        manually registering;
Improvement: performance improvement for
mapping
; the order of
                                        sequencing saturation calculation has
                                        switched, in v2.1.0 we only compute the
                                        saturation of tissue-covered region;
Bug fix: fix the bug of indexing at
mapping
step; fix the bug
                                        of long waiting time at
register
step.
A1.1
V2.1.0
Jan. 2022
Add error handling;
Update demo output
A2
V4.1.0
Apr. 2022
New feature: support to process fused
                                        microscopic images; employ Stereopy in
                                        clustering; new gene expression matrix
                                        file format; including a file format
                                        convertor and a mapping memory
                                        estimator;
Improvement: performance improvement for
mapping
; update gene
                                        annotation approach in
count
; update image
                                        stitching and tissue segmentation model
                                        for better performance on image
                                        stitching and segmentation for tissue
                                        with voids.
A3
V5.1.3
Aug. 2022
New   feature: addition of cell
                                        segmentation on microscopic image in
register
pipeline module
                                        and
cellCut
pipeline module
                                        to extract cell expression matrix;
                                        design IPR file to store image
                                        processing   record information and
                                        TIFF images produced in
register
; output exon
                                        expression matrix along with total MID
                                        count; addition of cell clustering
                                        analysis; addition of cell bin statistic
                                        result and image information in HTML
                                        report; add pipeline modules to support
                                        single-end FASTQ data; addition of
                                        option for selecting multi-mapped reads;
                                        addition of score system in image
                                        processing;
Improvement: addition of poly A
                                        filtration in
mapping
;
                                        performance improvement for
merge
,
tissueCut
and
saturation
; add data
                                        scaling and upgrade clustering analysis
                                        pipeline;
Bug fix: fix the bug of plotting scatter
                                        plot in
tissueCut
, review
                                        and modify the ambiguous metrics names
                                        and explanations in HTML report;
A3.1
V5.1.3
Dec. 2022
Bug fix: fix the typo in the manual.
A4
V5.4.0
Nov. 2022
New feature: render a more elegant way
                                        of organizing SE FASTQs input into
mapping
; addition of header
                                        for
count
output TXT file;
                                        upgrade
ipr2img
to
imageTools
which allows you
                                        to merge TIFF images to check
                                        segmentation result and plot templates
                                        on the panoramic image or registered
                                        image to check the result of stitching
                                        and registration;
Improvement: change data struct of gene
                                        index in the GEF file from uint16 to
                                        uint32 to store more genes;
Bug fix: fix the typo in the manual;
A5
V5.5.0-V5.5.2
Jan. 2023
New feature:  addition of
manualRegister
and
lasso
pipeline modules,
                                        which acquire parameters and essential
                                        files from offline visualization
                                        software StereoMap; addition of error
                                        code function in each module, and the
                                        explanation has been organized in
                                        appendix D;
Improvement: upgrade
tissueCut
pipeline module
                                        for better performance and improved
                                        accuracy of tissue recognition directly
                                        from gene expression matrix; upgrade
                                        clustering analysis pipelines; addition
                                        of image layers in HTML report which
                                        allow users to switch images displayed
                                        with gene expression distribution plot;
                                        the stitching deviation heatmap(s) and
                                        the frame of axes in the HTML report
                                        have been adjusted according to the
                                        registration parameters.
A5
V5.5.3
Mar. 2023
Improvement: upgrade
mapping
pipeline module,
                                        which performs polyA filtering after CID
                                        mapping, for improved statistical output
                                        in
report
.
A6
V6.0
Mar. 2023
New feature: addition of
rRNAremove
switch in
mapping
, off by default, to
                                        count and filter rRNA reads using the
                                        reference genome with the addition of
                                        rRNA information. rRNA count and ratio
                                        are recorded in the output file; support
                                        the scenario with the combination of
                                        DAPI and mIF (multiple
                                        immunofluorescence images),
                                        correspondingly generating registered,
                                        tissue segmentation, and cell
                                        segmentation results; support
                                        continuously processing image files
                                        output from each module of ImageStudio.
Improvement: reconstructed
tissueCut
module pipeline,
                                        with the addition of parameter
-t
which means the number
                                        of used CPUs, to greatly improve the
                                        calculation efficiency; modified
                                        parameter
-g
in
img2rpi
module to a two-layer structure,
                                        upgraded RPI file format to support
                                        storing and organizing multiple stained
                                        microscopy images in groups; displayed
                                        pseudo colors (up to 7 colors) on the
                                        bottom layer of clustering results in
                                        HTML report, when handling the scenario
                                        of mIF in
report
module.
Bug fix: fix the bug caused by version
                                        compatibility when generating CGEF file.
A7
A6.2
Jul. 2023
New feature:
supported
                                    outputs of Valid ClD Reads and un-mapped
                                    reads in FASTQ format; supported QC-failed
                                    but manually processed images as inputs for
                                    subsequent workflow; addition of tissue area
                                    (nm²) in corresponding GEF file; supported
                                    generating GEF file of labeled region;
                                    addition of quality control alerts and
                                    tissue segmentation display in
report
.
Improvement:
updated
mapping
module to improve
                                    computational efficiency; updated the error
                                    alerts on checking the length of the gene
                                    name, in
checkGTF
and
count
modules.
A8
V7.0
Oct. 2023
New feature:
supported H&E image in pipeline;
                                          addition of
cellCorrect
module for
                                          expanding cell boundaries; addition of
cellChunk
module for
                                          displaying cell expression heatmap in
StereoMap
; addition
                                          of a new parameter in
spatialCluster
for
                                          adjusting Leiden clustering
                                          resolution; addition of output GEF
                                          file in
lasso
module;
Improvement:
performance
                                          improvement in
count
and
register
modules; updated
tissue and cell segmentation module
                                          for nuclei-stained image; supported
                                          for using GPU in
register
module to accelerate
                                              computing.
Note: Please download the latest
                    version of the manual and use it with the software specific
                    to this manual.
©2023 Beijing Genomics Institute at Shenzhen. All rights
                    reserved.
1. The products shall be for research use only, not for
                      use in diagnostic.
2. The Content on this manual may be protected in whole or
                      in part by applicable intellectual property laws. Beijing
                      Genomics Institute and / or corresponding right subjects
                      own their intellectual property rights according to law,
                      including but not limited to trademark rights, copyrights,
                      etc.
3. Beijing Genomics Institute do not grant or imply the
                      right or license to use any copyrighted content or
                      trademark (registered or unregistered) of us or any third
                      party. Without our written consent, no one shall use,
                      modify, copy, publicly disseminate, change, distribute, or
                      publish the program or Content of this manual without
                      authorization, and shall not use the design or use the
                      design skills to use or take possession of the trademarks,
                      the logo or other proprietary information (including
                      images, text, web design or form) of us or our affiliates.
4. Nothing contained herein is intended to or shall be
                      construed as any warranty, expression or implication of
                      the performance of any products listed or described
                      herein. Any and all warranties applicable to any products
                      listed herein are set forth in the applicable terms and
                      conditions of sale accompanying the purchase of such
                      product. Beijing Genomics Institute, Shenzhen makes no
                      warranty and hereby disclaims any and all warranties as to
                      the use of any third-party products or protocols described
                      herein.
Versions:
Click here for older versions
Reach out to Us
Discover the power of Stereo-seq
Contact
时空组学英文紫
SOCIAL
Twitter
Linkedin
Youtube
LINKS
Complete genomics
MGI
SOCIAL
Twitter
Linkedin
Youtube
SUBSCRIBE FOR PRODUCT AND EVENT UPDATES
Submit
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
Copyright © 2024 STOmics Tech. All Rights Reserved.
Privacy Policy
·
Term of Service
·
Website Map
The website uses cookies
We use cookies to make sure that the website works well for you.
              By clicking on the "I accept recommended cookies" button you agree
              to our use of cookies. Read more about our
cookie policy
.
I accept the recommended cookiesVersion Description - STOmics
STOmics
STOmics
STOmics
Why Stereo-seq
Products
STOmics Solutions
Stereo-seq Solutions
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-CITE Solution
Stereo-seq OMNI Solution
STOmics Software
Stereo-seq Analysis Workflow
StereoMap
Help Center
Applications
Research Areas
Development Research
Organ Research
Evolution Research
Disease Research
Publications
STOmics Grant
Resources
Resources
Documents
Videos
Publications
STOmics Validated Tissue List
Demo Data
FAQ
STOmics Datasets
Software Archives
Certified Service Provider
About CSP program
STOmics CSP
News
STOmics Events
Conference
Webinar
Seminar
STOmics News
About
About STOmics
STOmics introduction
Milestones
Contact Us
Login
Sign up
Mission
Mission
zhangjiaqi@genomics.cn
Personal information
Change password
Log out
EN
CN
All
Products
Resources
News
FAQ
Search
StereoMap Operation Manual
搜 索
StereoMap operation manual
7.0
7.0
6.0
5.5.3
Version Description
Background
Downloadable materials
SAW installation and startup
Display of test data results
SAW process operation introduction
Appendices and References
Version Description
Revision History
Manual Version
Software Version
Date
Description
A0
V1.0.0
Nov. 2021
Initial release.
A1
V2.1.0
Dec. 2021
New feature: addition of manual
                                        registration function, some fine-tuning
                                        will be automatically performed after
                                        manually registering;
Improvement: performance improvement for
mapping
; the order of
                                        sequencing saturation calculation has
                                        switched, in v2.1.0 we only compute the
                                        saturation of tissue-covered region;
Bug fix: fix the bug of indexing at
mapping
step; fix the bug
                                        of long waiting time at
register
step.
A1.1
V2.1.0
Jan. 2022
Add error handling;
Update demo output
A2
V4.1.0
Apr. 2022
New feature: support to process fused
                                        microscopic images; employ Stereopy in
                                        clustering; new gene expression matrix
                                        file format; including a file format
                                        convertor and a mapping memory
                                        estimator;
Improvement: performance improvement for
mapping
; update gene
                                        annotation approach in
count
; update image
                                        stitching and tissue segmentation model
                                        for better performance on image
                                        stitching and segmentation for tissue
                                        with voids.
A3
V5.1.3
Aug. 2022
New   feature: addition of cell
                                        segmentation on microscopic image in
register
pipeline module
                                        and
cellCut
pipeline module
                                        to extract cell expression matrix;
                                        design IPR file to store image
                                        processing   record information and
                                        TIFF images produced in
register
; output exon
                                        expression matrix along with total MID
                                        count; addition of cell clustering
                                        analysis; addition of cell bin statistic
                                        result and image information in HTML
                                        report; add pipeline modules to support
                                        single-end FASTQ data; addition of
                                        option for selecting multi-mapped reads;
                                        addition of score system in image
                                        processing;
Improvement: addition of poly A
                                        filtration in
mapping
;
                                        performance improvement for
merge
,
tissueCut
and
saturation
; add data
                                        scaling and upgrade clustering analysis
                                        pipeline;
Bug fix: fix the bug of plotting scatter
                                        plot in
tissueCut
, review
                                        and modify the ambiguous metrics names
                                        and explanations in HTML report;
A3.1
V5.1.3
Dec. 2022
Bug fix: fix the typo in the manual.
A4
V5.4.0
Nov. 2022
New feature: render a more elegant way
                                        of organizing SE FASTQs input into
mapping
; addition of header
                                        for
count
output TXT file;
                                        upgrade
ipr2img
to
imageTools
which allows you
                                        to merge TIFF images to check
                                        segmentation result and plot templates
                                        on the panoramic image or registered
                                        image to check the result of stitching
                                        and registration;
Improvement: change data struct of gene
                                        index in the GEF file from uint16 to
                                        uint32 to store more genes;
Bug fix: fix the typo in the manual;
A5
V5.5.0-V5.5.2
Jan. 2023
New feature:  addition of
manualRegister
and
lasso
pipeline modules,
                                        which acquire parameters and essential
                                        files from offline visualization
                                        software StereoMap; addition of error
                                        code function in each module, and the
                                        explanation has been organized in
                                        appendix D;
Improvement: upgrade
tissueCut
pipeline module
                                        for better performance and improved
                                        accuracy of tissue recognition directly
                                        from gene expression matrix; upgrade
                                        clustering analysis pipelines; addition
                                        of image layers in HTML report which
                                        allow users to switch images displayed
                                        with gene expression distribution plot;
                                        the stitching deviation heatmap(s) and
                                        the frame of axes in the HTML report
                                        have been adjusted according to the
                                        registration parameters.
A5
V5.5.3
Mar. 2023
Improvement: upgrade
mapping
pipeline module,
                                        which performs polyA filtering after CID
                                        mapping, for improved statistical output
                                        in
report
.
A6
V6.0
Mar. 2023
New feature: addition of
rRNAremove
switch in
mapping
, off by default, to
                                        count and filter rRNA reads using the
                                        reference genome with the addition of
                                        rRNA information. rRNA count and ratio
                                        are recorded in the output file; support
                                        the scenario with the combination of
                                        DAPI and mIF (multiple
                                        immunofluorescence images),
                                        correspondingly generating registered,
                                        tissue segmentation, and cell
                                        segmentation results; support
                                        continuously processing image files
                                        output from each module of ImageStudio.
Improvement: reconstructed
tissueCut
module pipeline,
                                        with the addition of parameter
-t
which means the number
                                        of used CPUs, to greatly improve the
                                        calculation efficiency; modified
                                        parameter
-g
in
img2rpi
module to a two-layer structure,
                                        upgraded RPI file format to support
                                        storing and organizing multiple stained
                                        microscopy images in groups; displayed
                                        pseudo colors (up to 7 colors) on the
                                        bottom layer of clustering results in
                                        HTML report, when handling the scenario
                                        of mIF in
report
module.
Bug fix: fix the bug caused by version
                                        compatibility when generating CGEF file.
A7
A6.2
Jul. 2023
New feature:
supported
                                    outputs of Valid ClD Reads and un-mapped
                                    reads in FASTQ format; supported QC-failed
                                    but manually processed images as inputs for
                                    subsequent workflow; addition of tissue area
                                    (nm²) in corresponding GEF file; supported
                                    generating GEF file of labeled region;
                                    addition of quality control alerts and
                                    tissue segmentation display in
report
.
Improvement:
updated
mapping
module to improve
                                    computational efficiency; updated the error
                                    alerts on checking the length of the gene
                                    name, in
checkGTF
and
count
modules.
A8
V7.0
Oct. 2023
New feature:
supported H&E image in pipeline;
                                          addition of
cellCorrect
module for
                                          expanding cell boundaries; addition of
cellChunk
module for
                                          displaying cell expression heatmap in
StereoMap
; addition
                                          of a new parameter in
spatialCluster
for
                                          adjusting Leiden clustering
                                          resolution; addition of output GEF
                                          file in
lasso
module;
Improvement:
performance
                                          improvement in
count
and
register
modules; updated
tissue and cell segmentation module
                                          for nuclei-stained image; supported
                                          for using GPU in
register
module to accelerate
                                              computing.
Note: Please download the latest
                    version of the manual and use it with the software specific
                    to this manual.
©2023 Beijing Genomics Institute at Shenzhen. All rights
                    reserved.
1. The products shall be for research use only, not for
                      use in diagnostic.
2. The Content on this manual may be protected in whole or
                      in part by applicable intellectual property laws. Beijing
                      Genomics Institute and / or corresponding right subjects
                      own their intellectual property rights according to law,
                      including but not limited to trademark rights, copyrights,
                      etc.
3. Beijing Genomics Institute do not grant or imply the
                      right or license to use any copyrighted content or
                      trademark (registered or unregistered) of us or any third
                      party. Without our written consent, no one shall use,
                      modify, copy, publicly disseminate, change, distribute, or
                      publish the program or Content of this manual without
                      authorization, and shall not use the design or use the
                      design skills to use or take possession of the trademarks,
                      the logo or other proprietary information (including
                      images, text, web design or form) of us or our affiliates.
4. Nothing contained herein is intended to or shall be
                      construed as any warranty, expression or implication of
                      the performance of any products listed or described
                      herein. Any and all warranties applicable to any products
                      listed herein are set forth in the applicable terms and
                      conditions of sale accompanying the purchase of such
                      product. Beijing Genomics Institute, Shenzhen makes no
                      warranty and hereby disclaims any and all warranties as to
                      the use of any third-party products or protocols described
                      herein.
Reach out to Us
Discover the power of Stereo-seq
Contact
时空组学英文紫
SOCIAL
Twitter
Linkedin
Youtube
LINKS
Complete genomics
MGI
SOCIAL
Twitter
Linkedin
Youtube
SUBSCRIBE FOR PRODUCT AND EVENT UPDATES
Submit
Copyright © All Rights Reserved 2023 GCATbio Co., Ltd.
Privacy Policy
·
Term of Service
·
Website Map
Copyright © All Rights Reserved 2023 GCATbio Co., Ltd.
Privacy Policy
·
Term of Service
·
Website Map
The website uses cookies
We use cookies to make sure that the website works well for you.
              By clicking on the "I accept recommended cookies" button you agree
              to our use of cookies. Read more about our
cookie policy
.
I accept the recommended cookiesVersion Description - STOmics
STOmics
STOmics
STOmics
Why Stereo-seq
Products
STOmics Solutions
Stereo-seq Solutions
Stereo-seq Transcriptomics Solution
Stereo-seq Transcriptomics mIF Solution
Stereo-seq Large Chip Designs
Stereo-CITE Solution
Stereo-seq OMNI Solution
STOmics Software
Stereo-seq Analysis Workflow
StereoMap
Help Center
Applications
Research Areas
Development Research
Organ Research
Evolution Research
Disease Research
Publications
STOmics Grant
Resources
Resources
Documents
Videos
Publications
STOmics Validated Tissue List
Demo Data
FAQ
STOmics Datasets
Software Archives
Certified Service Provider
About CSP program
STOmics CSP
News
STOmics Events
Conference
Webinar
Seminar
STOmics News
About
About STOmics
STOmics introduction
Milestones
Contact Us
Login
Sign up
Mission
Mission
zhangjiaqi@genomics.cn
Personal information
Change password
Log out
EN
CN
All
Products
Resources
News
FAQ
Search
StereoMap Operation Manual
搜 索
StereoMap operation manual
7.0
7.0
6.0
5.5.3
Version Description
Background
Downloadable materials
SAW installation and startup
Display of test data results
SAW process operation introduction
Appendices and References
Version Description
Revision History
Manual Version
Software Version
Date
Description
A0
V1.0.0
Nov. 2021
Initial release.
A1
V2.1.0
Dec. 2021
New feature: addition of manual
                                        registration function, some fine-tuning
                                        will be automatically performed after
                                        manually registering;
Improvement: performance improvement for
mapping
; the order of
                                        sequencing saturation calculation has
                                        switched, in v2.1.0 we only compute the
                                        saturation of tissue-covered region;
Bug fix: fix the bug of indexing at
mapping
step; fix the bug
                                        of long waiting time at
register
step.
A1.1
V2.1.0
Jan. 2022
Add error handling;
Update demo output
A2
V4.1.0
Apr. 2022
New feature: support to process fused
                                        microscopic images; employ Stereopy in
                                        clustering; new gene expression matrix
                                        file format; including a file format
                                        convertor and a mapping memory
                                        estimator;
Improvement: performance improvement for
mapping
; update gene
                                        annotation approach in
count
; update image
                                        stitching and tissue segmentation model
                                        for better performance on image
                                        stitching and segmentation for tissue
                                        with voids.
A3
V5.1.3
Aug. 2022
New   feature: addition of cell
                                        segmentation on microscopic image in
register
pipeline module
                                        and
cellCut
pipeline module
                                        to extract cell expression matrix;
                                        design IPR file to store image
                                        processing   record information and
                                        TIFF images produced in
register
; output exon
                                        expression matrix along with total MID
                                        count; addition of cell clustering
                                        analysis; addition of cell bin statistic
                                        result and image information in HTML
                                        report; add pipeline modules to support
                                        single-end FASTQ data; addition of
                                        option for selecting multi-mapped reads;
                                        addition of score system in image
                                        processing;
Improvement: addition of poly A
                                        filtration in
mapping
;
                                        performance improvement for
merge
,
tissueCut
and
saturation
; add data
                                        scaling and upgrade clustering analysis
                                        pipeline;
Bug fix: fix the bug of plotting scatter
                                        plot in
tissueCut
, review
                                        and modify the ambiguous metrics names
                                        and explanations in HTML report;
A3.1
V5.1.3
Dec. 2022
Bug fix: fix the typo in the manual.
A4
V5.4.0
Nov. 2022
New feature: render a more elegant way
                                        of organizing SE FASTQs input into
mapping
; addition of header
                                        for
count
output TXT file;
                                        upgrade
ipr2img
to
imageTools
which allows you
                                        to merge TIFF images to check
                                        segmentation result and plot templates
                                        on the panoramic image or registered
                                        image to check the result of stitching
                                        and registration;
Improvement: change data struct of gene
                                        index in the GEF file from uint16 to
                                        uint32 to store more genes;
Bug fix: fix the typo in the manual;
A5
V5.5.0-V5.5.2
Jan. 2023
New feature:  addition of
manualRegister
and
lasso
pipeline modules,
                                        which acquire parameters and essential
                                        files from offline visualization
                                        software StereoMap; addition of error
                                        code function in each module, and the
                                        explanation has been organized in
                                        appendix D;
Improvement: upgrade
tissueCut
pipeline module
                                        for better performance and improved
                                        accuracy of tissue recognition directly
                                        from gene expression matrix; upgrade
                                        clustering analysis pipelines; addition
                                        of image layers in HTML report which
                                        allow users to switch images displayed
                                        with gene expression distribution plot;
                                        the stitching deviation heatmap(s) and
                                        the frame of axes in the HTML report
                                        have been adjusted according to the
                                        registration parameters.
A5
V5.5.3
Mar. 2023
Improvement: upgrade
mapping
pipeline module,
                                        which performs polyA filtering after CID
                                        mapping, for improved statistical output
                                        in
report
.
A6
V6.0
Mar. 2023
New feature: addition of
rRNAremove
switch in
mapping
, off by default, to
                                        count and filter rRNA reads using the
                                        reference genome with the addition of
                                        rRNA information. rRNA count and ratio
                                        are recorded in the output file; support
                                        the scenario with the combination of
                                        DAPI and mIF (multiple
                                        immunofluorescence images),
                                        correspondingly generating registered,
                                        tissue segmentation, and cell
                                        segmentation results; support
                                        continuously processing image files
                                        output from each module of ImageStudio.
Improvement: reconstructed
tissueCut
module pipeline,
                                        with the addition of parameter
-t
which means the number
                                        of used CPUs, to greatly improve the
                                        calculation efficiency; modified
                                        parameter
-g
in
img2rpi
module to a two-layer structure,
                                        upgraded RPI file format to support
                                        storing and organizing multiple stained
                                        microscopy images in groups; displayed
                                        pseudo colors (up to 7 colors) on the
                                        bottom layer of clustering results in
                                        HTML report, when handling the scenario
                                        of mIF in
report
module.
Bug fix: fix the bug caused by version
                                        compatibility when generating CGEF file.
A7
A6.2
Jul. 2023
New feature:
supported
                                    outputs of Valid ClD Reads and un-mapped
                                    reads in FASTQ format; supported QC-failed
                                    but manually processed images as inputs for
                                    subsequent workflow; addition of tissue area
                                    (nm²) in corresponding GEF file; supported
                                    generating GEF file of labeled region;
                                    addition of quality control alerts and
                                    tissue segmentation display in
report
.
Improvement:
updated
mapping
module to improve
                                    computational efficiency; updated the error
                                    alerts on checking the length of the gene
                                    name, in
checkGTF
and
count
modules.
A8
V7.0
Oct. 2023
New feature:
supported H&E image in pipeline;
                                          addition of
cellCorrect
module for
                                          expanding cell boundaries; addition of
cellChunk
module for
                                          displaying cell expression heatmap in
StereoMap
; addition
                                          of a new parameter in
spatialCluster
for
                                          adjusting Leiden clustering
                                          resolution; addition of output GEF
                                          file in
lasso
module;
Improvement:
performance
                                          improvement in
count
and
register
modules; updated
tissue and cell segmentation module
                                          for nuclei-stained image; supported
                                          for using GPU in
register
module to accelerate
                                              computing.
Note: Please download the latest
                    version of the manual and use it with the software specific
                    to this manual.
©2023 Beijing Genomics Institute at Shenzhen. All rights
                    reserved.
1. The products shall be for research use only, not for
                      use in diagnostic.
2. The Content on this manual may be protected in whole or
                      in part by applicable intellectual property laws. Beijing
                      Genomics Institute and / or corresponding right subjects
                      own their intellectual property rights according to law,
                      including but not limited to trademark rights, copyrights,
                      etc.
3. Beijing Genomics Institute do not grant or imply the
                      right or license to use any copyrighted content or
                      trademark (registered or unregistered) of us or any third
                      party. Without our written consent, no one shall use,
                      modify, copy, publicly disseminate, change, distribute, or
                      publish the program or Content of this manual without
                      authorization, and shall not use the design or use the
                      design skills to use or take possession of the trademarks,
                      the logo or other proprietary information (including
                      images, text, web design or form) of us or our affiliates.
4. Nothing contained herein is intended to or shall be
                      construed as any warranty, expression or implication of
                      the performance of any products listed or described
                      herein. Any and all warranties applicable to any products
                      listed herein are set forth in the applicable terms and
                      conditions of sale accompanying the purchase of such
                      product. Beijing Genomics Institute, Shenzhen makes no
                      warranty and hereby disclaims any and all warranties as to
                      the use of any third-party products or protocols described
                      herein.
Versions:
Reach out to Us
Discover the power of Stereo-seq
Contact
时空组学英文紫
SOCIAL
Twitter
Linkedin
Youtube
LINKS
Complete genomics
MGI
SOCIAL
Twitter
Linkedin
Youtube
SUBSCRIBE FOR PRODUCT AND EVENT UPDATES
Submit
Copyright © All Rights Reserved 2023 GCATbio Co., Ltd.
Privacy Policy
·
Term of Service
·
Website Map
Copyright © All Rights Reserved 2023 GCATbio Co., Ltd.
Privacy Policy
·
Term of Service
·
Website Map
The website uses cookies
We use cookies to make sure that the website works well for you.
              By clicking on the "I accept recommended cookies" button you agree
              to our use of cookies. Read more about our
cookie policy
.
I accept the recommended cookies